{"slots":{"0":{"name":"screen","type":{"events":[],"methods":[]}},"1":{"name":"receiver","type":{"events":[],"methods":[]}},"2":{"name":"databank","type":{"events":[],"methods":[]}},"3":{"name":"emitter","type":{"events":[],"methods":[]}},"4":{"name":"slot5","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-2":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"sgui:process(x,y)\nsystem.print(x..\" \"..y)\nbutton_press(x, y)","filter":{"args":[{"variable":"*"},{"variable":"*"}],"signature":"mouseUp(x,y)","slotKey":"0"},"key":"0"},{"code":"--CH ShipData\nmsg_counter = msg_counter + 1\n\nsystem.print(\"RECEIVED \"..msg_counter)\n\nmsg_received = true\n\nrcv_msg = message:gsub(\"@@@\",\"\\\"\")\nrcv_msg = json.decode(rcv_msg)\n\nscreen_html()","filter":{"args":[{"value":"ShipData"},{"variable":"*"}],"signature":"receive(channel,message)","slotKey":"1"},"key":"1"},{"code":"wp_synced = 0\nindex_sync = 1\nsync_data()","filter":{"args":[{"value":"ShipRqst"},{"variable":"*"}],"signature":"receive(channel,message)","slotKey":"1"},"key":"2"},{"code":"--STARTING SCREEN\n    screen.activate()\n    screen.clear()\n\n--STARTING VARIABLES\n\n    msg_received = false\n    msg_counter = 0\n    wp_rceived = 0\n    scrool_y = 0\n    rcv_msg_html = \"\"\n    sent_msg_html = \"\"\n    databank_keys = databank.getNbKeys()\n    if databank_keys > 0 then\n        local stored_wp = json.decode(databank.getKeys())\n        for i, databank_keys in pairs(stored_wp) do\n            local wp_name = stored_wp[i]\n            local wp_coord = databank.getStringValue(wp_name)\n            rcv_msg_html = rcv_msg_html..[[<tr><td width=\"50vw\" class=\"cyan\">]]..i..[[</td><td width=\"250vw\" class=\"cyan\">]]..wp_name..[[</td><td class=\"cyan\">]]..wp_coord..[[</td></tr>]]\n        end\n    else\n        rcv_msg_html = [[<tr><td colspan=\"2\"> ... </td><td width=\"600vw\"> ... </td></tr>]]\n    end\n\n--ADD LINES TO HTML AND STORE DATAS\n    function add_tr()\n\n        if rcv_msg_html == [[<tr><td colspan=\"2\"> ... </td><td width=\"600vw\"> ... </td></tr>]] then\n            rcv_msg_html = \"\"\n        else\n            rcv_msg_html = rcv_msg_html\n        end\n\n        local index = rcv_msg.wp_n\n        local key = rcv_msg.wp_c\n        databank.setStringValue(index, key)\n\n        rcv_msg_td_index = index\n        rcv_msg_td_key = key\n        rcv_msg_html = rcv_msg_html..[[<tr><td width=\"50vw\">]]..msg_counter..[[</td><td width=\"250vw\">]]..rcv_msg_td_index..[[</td><td>]]..rcv_msg_td_key..[[</td></tr>]]\n\n        databank_keys = databank.getNbKeys()\n        return rcv_msg_html\n    end\n\n--HTML BUTTONS\n    function buttons_html()\n        local html = [[\n            <style>\n            td {\n                border:2px solid yellow;\n                color:yellow;\n                font-size:30px;\n                text-align:center;\n            }\n            .none {\n                border:0px solid black;\n            }\n            .send {\n                border:2px solid green;\n                color:green;\n                font-size:20px;\n                text-align:center;\n            }\n            .clr {\n                border:2px solid red;\n                color:red;\n                font-size:20px;\n                text-align:center;\n            }\n            </style>\n            <table width=\"50vw\">\n                <tr height=\"50vh\"><td>UP</td></tr>\n                <tr height=\"150vh\"><td></td></tr>\n                <tr height=\"50vh\"><td>TOP</td></tr>\n                <tr height=\"150vh\"><td></td></tr>\n                <tr height=\"50vh\"><td>DWN</td></tr>\n                <tr height=\"25vh\"><td class=\"none\"></td></tr>\n                <tr height=\"50vh\"><td class=\"send\">SEND</td></tr>\n                <tr height=\"25vh\"><td class=\"none\"></td></tr>\n                <tr height=\"50vh\"><td class=\"clr\">CLR DB</td></tr>\n            </table>]]\n            html_buttons = screen.addContent(90,0,html)\n        return html_html_buttons\n    end\n\n--HTML DATA TABLE\n    function screen_html()\n        screen.clear()\n        buttons_html()\n\n        if msg_received == true then\n            add_table_lines = add_tr()\n        else\n            add_table_lines = rcv_msg_html\n        end\n\n        local html = [[\n        <style>\n        td {\n            border:2px solid yellow;\n            color:yellow;\n            font-size:30px;\n            text-align:center;\n        }\n        .left {\n            text-align:left;\n        }\n        .mid {\n            vertical-align:middle;\n        }\n        .green {\n            color: green;\n        }\n        .cyan {\n            color: aqua;\n        }\n        </style>\n        <table width=\"900vw\">\n            <tr><td colspan=\"2\">WP Received</td><td class=\"center\">]]..msg_counter..[[</td></tr>\n            ]]..add_table_lines..[[\n            ]]..sent_msg_html..[[\n            <tr><td colspan=\"2\">WP Stored</td><td class=\"center\">]]..databank_keys..[[</td></tr>\n        </table>]]\n        msg_received = false\n        html_table = screen.addContent(0,scrool_y,html)\n        return html_table\n    end\n    screen_html()\n\n--SENDING DATA\n    function sync_data()\n        local total_key_number = databank.getNbKeys()\n\n        if total_key_number > 0 then\n            local counter = 1\n        \n            wp_list_table = {}\n            wp_list_table = json.decode(databank.getKeys())\n            table.sort(wp_list_table)\n        \n            index_sync = index_sync\n\n            for i = index_sync, total_key_number do\n                local extract_name = wp_list_table[i]\n            \n                local extract_coord = databank.getStringValue(extract_name)\n                \n                --system.print(\"TRANSMITTING \"..index_sync..\" : \"..extract_name..\", \"..extract_coord)\n\n                waypoint = {\n                wp_n = extract_name,\n                wp_c = extract_coord\n                }\n                json_string = json.encode(waypoint, { indent = false })\n            \n                if counter <= 3 then\n                    counter = counter + 1\n                    wp_synced = wp_synced + 1\n                    emitter.send(\"BaseData\", json_string:gsub(\"\\\"\",\"@@@\"))\n                else\n                    break\n                end\n                sync_result = \"Synced \"..wp_synced..\" WP\"\n                prog_bar = (wp_synced * 595)/total_key_number\n                sent_msg_html = [[\n                    <tr><td colspan=\"2\">]]..sync_result..[[</td><td width=\"600vw\" class=\"left mid\">\n                        <svg width=\"]]..prog_bar..[[\" height=\"10\"><rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" style=\" fill: yellow\"/></svg>\n                    </td></tr>]]\n\n                if index_sync <= total_key_number then\n                    delay_sync = 2\n                    index_sync = index_sync + 1\n                    unit.setTimer(\"delay\", 1)\n                end\n            end\n            screen_html()\n        end\n    end\n\n--BUTTON PRESS\n    function button_press(x, y)\n        if (x > 0.9 and x < 0.97 and y > 0 and y < 0.07) then --UP\n        if scrool_y < 0 then\n                scrool_y = scrool_y + 10\n            end\n        elseif (x > 0.9 and x < 0.97 and y > 0.32 and y < 0.40) then --TOP\n            scrool_y = 0\n        elseif (x > 0.9 and x < 0.97 and y > 0.65 and y < 0.73) then --DWN\n            scrool_y = scrool_y - 10\n        elseif (x > 0.9 and x < 0.97 and y > 0.77 and y < 0.85) then --SEND\n            wp_synced = 0\n            index_sync = 1\n            sync_data()\n        elseif (x > 0.9 and x < 0.97 and y > 0.89 and y < 0.97) then --CLR\n            databank.clear()\n            msg_counter = 0\n            databank_keys = 0\n            scrool_y = 0\n            sent_msg_html = \"\"\n            rcv_msg_html = [[<tr><td colspan=\"2\"> ... </td><td width=\"600vw\"> ... </td></tr>]]\n        end\n    screen_html()\n    end","filter":{"args":[],"signature":"start()","slotKey":"-1"},"key":"3"},{"code":"screen.clear()\nscreen.deactivate()","filter":{"args":[],"signature":"stop()","slotKey":"-1"},"key":"4"},{"code":"delay_sync = delay_sync - 1\n\nif delay_sync == 0 then\n    unit.stopTimer(\"delay\")\n    sync_data()\nend","filter":{"args":[{"value":"delay"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"5"}],"methods":[],"events":[]}