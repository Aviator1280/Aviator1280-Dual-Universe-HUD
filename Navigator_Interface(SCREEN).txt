{"slots":{"0":{"name":"screen","type":{"events":[],"methods":[]}},"1":{"name":"databank","type":{"events":[],"methods":[]}},"2":{"name":"core","type":{"events":[],"methods":[]}},"3":{"name":"receiver","type":{"events":[],"methods":[]}},"4":{"name":"emitter","type":{"events":[],"methods":[]}},"5":{"name":"antigrav","type":{"events":[],"methods":[]}},"6":{"name":"shield","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-2":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"--screen.mouseUp(*,*)\n KeyLabel=screen.getScriptOutput()\n function Key_Check(x)\n  local Menu=true\n  local Pad=true\n  local Key1=true\n  local Key2=true\n\n  if Menu then\n   local MenuList={\"Time Calculator\",\"From\",\"Destination\",\"Shield\",\"AD/RN WP\",\"CLR WP\",\"Settings\",\"PE Target Altitude\",\"AGG\",\"WP/ATLAS\",\"INV Route\"}\n   for i=1, #MenuList do\n    local k=MenuList[i]\n    if k==x then menu(x) Menu=true break else Menu=false end\n   end\n  end\n\n  if (screenState==0 and x~=\"arrowUP\" and x~=\"arrowDN\") then Menu=true Key2=false end\n  if (screenState==11 and x~=\"arrowup\" and x~=\"arrowdn\") then Menu=true Key2=false end\n  if (screenState==15 and x~=\"arrowUP\" and x~=\"arrowDN\" and x~=\"ENT\" and x~=\"CLR\") then Menu=true Key2=false end\n  if not Menu then\n   local KeyPad={\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"0\",\".\",\"-\",\"arrowUP\",\"arrowDN\",\"arrowup\",\"arrowdn\",\"CAPS\",\"CLR\",\"ENT\"}\n   for i=1, #KeyPad do\n    local k=KeyPad[i]\n    if k==x then keypad_numbers() Pad=true break else Pad=false end\n   end   \n  end\n\n  if not Pad then\n   local KeyList1={\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\",\"J\",\"K\",\"L\",\"M\",\"N\",\"O\",\"P\",\"Q\",\"R\",\"S\",\"T\",\"U\",\"V\",\"W\",\"X\",\"Y\",\"Z\",\"_\",\"moon\"}\n   for i=1, #KeyList1 do\n    local k=KeyList1[i]\n    if k==x then keypad_letters() Key1=true break else Key1=false end\n   end   \n  end\n\n  if not Key1 then\n   local KeyList2={\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\",\"s\",\"t\",\"u\",\"v\",\"w\",\"x\",\"y\",\"z\"}\n   for i=1, #KeyList2 do\n    local k=KeyList2[i]\n    if k==x then keypad_letters() Key2=true break else Key2=false end\n   end  \n  end\n\n  if not Key2 then\n   ScreenSelection=KeyLabel\n   if (screenState==9 and ScreenSelection~=\"\") then ent_button() LuaScreen()\n   elseif (screenState==11 and ScreenSelection~=\"\") then DMGReportClick(ScreenSelection) LuaScreen()\n   elseif (screenState==13 and ScreenSelection~=\"\") then ent_button() LuaScreen()\n   elseif (screenState==17 and ScreenSelection~=\"\") then shieldFunction()\n   end\n  end\n\n end\n if KeyLabel~=\"\" then Key_Check(KeyLabel) end","filter":{"args":[{"variable":"*"},{"variable":"*"}],"signature":"mouseUp(x,y)","slotKey":"0"},"key":"0"},{"code":"--receiver.receiver(*,*)\n local DownlinkApproved=string.find(message, \"<DownlinkApproved>\")\n local ConstructIDRqst=string.find(message, \"<ConstructIDRqst>\")\n local BaseShipId=string.find(message, \"<BaseShipId>\")\n local WPBaseData=string.find(message, \"<WPBaseData>\")\n local FleetBaseData=string.find(message, \"<FleetBaseData>\")\n local BaseData_n=string.find(message, \"<BaseData_n>\")\n local SendDataTo=string.find(message, \"<SendDataTo>\")\n\n if SendDataTo then\n  SendDataTo=string.gsub(message, \"<SendDataTo>\", \"\")\n  if (SendDataTo==ship_id or SendDataTo==\"ALL\") then WP_request=true end\n end\n\n if DownlinkApproved then\n  local CheckShipID=string.gsub(message, \"<DownlinkApproved>\", \"\")\n  if CheckShipID==ship_id then sync_data() end\n end\n\n if ConstructIDRqst then\n  local CheckShipID=string.gsub(message, \"<ConstructIDRqst>\", \"\")\n  if CheckShipID==ship_id then\n   local ConstructID=core.getConstructId()\n   emitter.send(\"AviatorHUD\", \"<\"..ship_id..\">\"..ConstructID)\n  end\n end\n\n if BaseShipId then\n  base_ship_id=string.gsub(message, \"<BaseShipId>\", \"\")\n  ship_id_verified=false\n  if base_ship_id==ship_id then\n   ship_id_verified=true\n   reqst_waypoints()\n  end\n end\n\n if WPBaseData and (ship_id_verified==true or WP_request==true) then\n  msg_counter=msg_counter+1\n  system.print(ship_id..\" RECEIVED WP:\"..msg_counter..\" of \"..receiving_wp)\n  sync_result='>> WP Uplink << '..msg_counter ..'/'..receiving_wp\n  prog_bar=(msg_counter * 100)/receiving_wp\n  msg_received=true\n  rcv_msg=message:gsub(\"@@@\",\"\\\"\")\n  rcv_msg=string.gsub(rcv_msg, \"<WPBaseData>\", \"\")\n  rcv_msg=json.decode(rcv_msg)\n  receiving_data()\n  unit.setTimer(\"Ship_Id\", 5)\n end\n\n if FleetBaseData and (ship_id_verified==true or WP_request==true) then\n  fleet_msg_counter=fleet_msg_counter+1\n  system.print(ship_id..\" RECEIVED Ship Data:\"..fleet_msg_counter..\" of \"..receiving_wp)\n  sync_result='>> Fleet Data Uplink << '..fleet_msg_counter ..'/'..receiving_wp\n  prog_bar=(fleet_msg_counter * 100)/receiving_wp\n  msg_received=true\n  rcv_msg=message:gsub(\"@@@\",\"\\\"\")\n  rcv_msg=string.gsub(rcv_msg, \"<FleetBaseData>\", \"\")\n  rcv_msg=json.decode(rcv_msg)\n  receiving_FleetData()\n  unit.setTimer(\"Ship_Id\", 5)\n end\n\n if BaseData_n then receiving_wp=string.gsub(message, \"<BaseData_n>\", \"\") end","filter":{"args":[{"variable":"*"},{"variable":"*"}],"signature":"receive(channel,message)","slotKey":"3"},"key":"1"},{"code":"screen.activate()\n--DATABANK INITIALIZATION\n local SoftwareVersion=\"v4.0.0\"\n databank.setStringValue(\"Navigator Interface ver\", SoftwareVersion)\n Databank_Soft_Reset=false --export\n Databank_Hard_Reset=false --export\n function databank_initialization()\n  databank.setStringValue(\"databank_verification\", \"Verified\")\n  databank.setStringValue(\"Ship ID\", \"n/a\")\n  databank.setFloatValue(\"navigator_speed\", \"n/a\")\n  databank.setFloatValue(\"navigator_distance\", \"n/a\")\n  databank.setStringValue(\"navigator_target_destination\", \"no Dest.\")\n  databank.setStringValue(\"navigator_coordinates\", \"n/a\")\n  databank.setFloatValue(\"navigator_eta_h\", 0)\n  databank.setFloatValue(\"navigator_eta_m\", 0)\n  databank.setFloatValue(\"navigator_eta_s\", 0)\n  databank.setStringValue(\"navigator_from_coordinates\", \"n/a\")\n  databank.setStringValue(\"navigator_from\", \"no From\")\n  databank.setFloatValue(\"navigator_pe_target_altitude\", factory_PE_target_altitude)\n  databank.setFloatValue(\"navigator_from_planet_radius\", 0)\n  databank.setFloatValue(\"navigator_target_planet_radius\", 0)\n  factory_autobrake=2.3\n  databank.setFloatValue(\"navigator_autobrake\", factory_autobrake)\n  factory_MTOW=730000\n  databank.setFloatValue(\"navigator_MTOW\", factory_MTOW)\n  wp_sequencing_distance=0.5\n  databank.setFloatValue(\"navigator_wpdist\", wp_sequencing_distance)\n  databank.setStringValue(\"SCRFontColor\", \"{217,217,217}\")\n  databank.setStringValue(\"SCRButtonColor\", \"{0,0,255}\")\n  databank.setStringValue(\"SCRTableColor\", \"{0,0,255}\")\n  databank.setStringValue(\"SCRFontTitle\", \"{255,255,0}\")\n  databank.setStringValue(\"SCRButtonPressed\", \"{255,0,0}\")\n  databank.setStringValue(\"FontColor\", \"{217,217,217}\")\n  databank.setStringValue(\"Background\", \"{0,0,100}\")\n  databank.setStringValue(\"TableColor\", \"{0,0,255}\")\n  databank.setStringValue(\"FontTitle\", \"{255,255,0}\")\n  databank.setStringValue(\"Selection\", \"{0,100,200}\")\n  databank.setFloatValue(\"Alpha1\", 0.4)\n  databank.setFloatValue(\"Alpha2\", 0.8)\n  databank.setStringValue(\"wp_color\", \"none\")\n  databank.setStringValue(\"agg eng/stby\", \"STBY\")\n  databank.setStringValue(\"agg off/stby\", \"OFF\")\n  databank.setIntValue(\"agg_base\", 1000)\n  databank.setIntValue(\"agg_t_alt\", 1000)\n  databank.setStringValue(\"nav agg\", \"OFF\")\n  databank.setFloatValue(\"DMG Scale\", 3)\n  databank.setFloatValue(\"DMG TV U/D\", -20)\n  databank.setFloatValue(\"DMG TV L/R\", 30)\n  databank.setFloatValue(\"DMG SV U/D\", 40)\n  databank.setFloatValue(\"DMG SV L/R\", 100)\n  databank.setIntValue(\"holding_speed\", 300)\n  databank.setIntValue(\"Holding\", 0)\n  local check=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n  if check==\"\" then\n   local data={}\n   data=json.encode(data)\n   databank.setStringValue(\"wp_settings\", data:gsub(\"\\\"\",\"@@@\"))\n  end\n end\n if (Databank_Soft_Reset or databank.getStringValue(\"databank_verification\")~=\"Verified\") then databank_initialization() end\n if Databank_Hard_Reset then databank.clear() databank_initialization() end\n\n--PARAMETERS\n if (databank.getFloatValue(\"navigator_MTOW\")~=0) then\n  factory_MTOW=databank.getFloatValue(\"navigator_MTOW\")\n  new_MTOW=factory_MTOW/1000\n else\n  factory_MTOW=730000 --export\n  new_MTOW=factory_MTOW/1000\n end\n\n if (databank.getFloatValue(\"navigator_autobrake\")~=0) then\n  factory_autobrake=databank.getFloatValue(\"navigator_autobrake\")\n else\n  factory_autobrake=2.3 --export\n end\n factory_PE_target_altitude=20000 --export\n\n if (databank.getFloatValue(\"navigator_wpdist\")~=\"\") then\n  wp_sequencing_distance=databank.getFloatValue(\"navigator_wpdist\")\n else\n  wp_sequencing_distance=0.5 --export\n end\n\n if (databank.getIntValue(\"holding_speed\")~=0) then\n  holding_speed=databank.getIntValue(\"holding_speed\")\n else\n  holding_speed=300 --export\n end\n\n local Menu_First_Page=\"WP/ATLAS\" --export\n local FontName=\"Montserrat-Light\"--export\n FontName=[[\"]].. FontName ..[[\"]]\n local FontSize=25--export\n\n function ColorConvert(x)\n  local y=tonumber(x)/255\n  return y\n end\n\n local FontColor=databank.getStringValue(\"SCRFontColor\")\n FontColor=json.decode(FontColor)\n Font_R=ColorConvert(FontColor[1])\n Font_G=ColorConvert(FontColor[2])\n Font_B=ColorConvert(FontColor[3])\n local ButtonColor=databank.getStringValue(\"SCRButtonColor\")\n ButtonColor=json.decode(ButtonColor)\n Button_R=ColorConvert(ButtonColor[1])\n Button_G=ColorConvert(ButtonColor[2])\n Button_B=ColorConvert(ButtonColor[3])\n local TableColor=databank.getStringValue(\"SCRTableColor\")\n TableColor=json.decode(TableColor)\n Table_R=ColorConvert(TableColor[1])\n Table_G=ColorConvert(TableColor[2])\n Table_B=ColorConvert(TableColor[3])\n local FontTitle=databank.getStringValue(\"SCRFontTitle\")\n FontTitle=json.decode(FontTitle)\n Title_R=ColorConvert(FontTitle[1])\n Title_G=ColorConvert(FontTitle[2])\n Title_B=ColorConvert(FontTitle[3])\n local ButtonPressed=databank.getStringValue(\"SCRButtonPressed\")\n ButtonPressed=json.decode(ButtonPressed)\n Button_Pressed_R=ColorConvert(ButtonPressed[1])\n Button_Pressed_G=ColorConvert(ButtonPressed[2])\n Button_Pressed_B=ColorConvert(ButtonPressed[3])\n local Alpha1=databank.getFloatValue(\"Alpha1\")\n \n local MenuButtonWidth=280\n local MenuButtonHeight=40\n local MenuKeyWidth=60\n local MenuKeyHeight=40\n\n local ButtonSep=10\n\n local Menu_Line1=ButtonSep\n local Menu_Line2=ButtonSep+Menu_Line1+MenuKeyHeight\n local Menu_Line3=ButtonSep+Menu_Line2+MenuKeyHeight\n local Menu_Line4=ButtonSep+Menu_Line3+MenuKeyHeight\n local Menu_Line5=ButtonSep+Menu_Line4+MenuKeyHeight\n local Menu_Line6=ButtonSep+Menu_Line5+MenuKeyHeight\n local Menu_Line7=ButtonSep+Menu_Line6+MenuKeyHeight\n local Menu_Line8=ButtonSep+Menu_Line7+MenuKeyHeight\n local Menu_Line9=ButtonSep+Menu_Line8+MenuKeyHeight\n local Menu_Line10=ButtonSep+Menu_Line9+MenuKeyHeight\n local Menu_Line11=ButtonSep+Menu_Line10+MenuKeyHeight\n\n PVPStationIsON=false\n if shield then unit.setTimer(\"PVPStation\", 1) end\n if receiver then receiver.setChannels(\"AviatorWPBaseSync\") end\n\n atlas=require('atlas')\n\n--STRING CONVERTER TO VEC3\n function vec3FromStr(vStr) --to convert string to vec3\n  local v3={};\n  for num in string.gmatch(vStr, \"[-%d%.]+\") do\n   local vN=string.gsub(num, \"%+\", \"\")\n   table.insert(v3, tonumber(vN))\n  end\n  return vec3(table.unpack(v3))\n end\n\n--SET COORDINATES FROM ATLAS\n function set_coordinates(body)\n  planet_lat=body.center[1]\n  planet_lon=body.center[2]\n  planet_alt=body.center[3]\n\n  local world_coord=\"::pos{0,0,\"..planet_lat..\",\"..planet_lon..\",\"..planet_alt..\"}\"\n  system.setWaypoint(world_coord)\n end\n\n--SET COORDINATES FROM WP\n function set_wp_coordinates(body)\n  system.setWaypoint(\"::pos{0,0,\"..body:gsub(\"[()]\",\"\")..\"}\")\n end\n\n--WORLD TO VEC3 COORDINATES\n function coord_converter()\n  for i, v in pairs(atlas[0]) do\n   if atlas[0][i].name[1]==wp_selected_planet then\n    planet_center=vec3(atlas[0][i].center)\n    planet_radius=atlas[0][i].radius\n    planet_system=0\n   end\n  end\n\n  local wp_pos={system=planet_system, lat=tonumber(keypad_input_wp_lat), lon=tonumber(keypad_input_wp_lon), alt=tonumber(keypad_input_wp_alt)}\n  local deg2rad=math.pi/180\n  local lat_rad=wp_pos.lat * deg2rad\n  local lon_rad=wp_pos.lon * deg2rad\n  local xproj=math.cos(lat_rad)\n\n  return planet_center + (planet_radius + wp_pos.alt) * vec3(xproj*math.cos(lon_rad), xproj*math.sin(lon_rad), math.sin(lat_rad))\n end\n\n--GENERATING WP LIST PAGES\n function generating_wp_pages(option)\n  local dbKeys=databank.getNbKeys()\n  if option==0 then\n   if dbKeys>0 then\n    local counter=0\n    local wp_id=\"\"\n    for i=1, dbKeys do\n     wp_id=tostring(\"wp\"..i)\n     local name=databank.getStringValue(wp_id)\n     if (tostring(name)~=nil and tostring(name)~=\"\") then counter=counter + 1 end\n    end\n    pages=math.ceil(counter/10)\n    if pages==0 then pages=1 end\n   else\n    pages=1\n   end\n  end\n  if option==14 then\n   if dbKeys>0 then\n    local counter=1\n    local route_id=\"\"\n    for i=1, dbKeys do\n     route_id=tostring(\"Route\"..i)\n     local name=databank.getStringValue(route_id)\n     if (tostring(name)~=nil and tostring(name)~=\"\") then counter=counter + 1 end\n    end\n    pages=math.ceil(counter/5)\n    if (counter/pages*5)==1 then pages=pages+1\n    elseif pages==0 then pages=1 end\n   end\n  end\n  if option==\"14routes\" then\n   if dbKeys>0 then\n    local counter=1\n    local route_id=\"\"\n    for i=1, dbKeys do\n     route_id=tostring(\"Route\"..i)\n     local name=databank.getStringValue(route_id)\n     if (tostring(name)~=nil and tostring(name)~=\"\") then counter=counter + 1 end\n    end\n    pages=math.ceil(counter/5)*5\n    if pages==0 then pages=1 end\n   end\n  end\n  if option==\"14wp\" then\n   local route_id=\"\"\n   for i=1, #route_tick_ do\n    if (route_tick_[i]==\">\" or route_tick_[i]==\"*\") then\n     RouteTickList=json.encode(route_tick_)\n     route_id=routes_list[i]\n     if route_id~=nil and route_id~=\"\" then route_id=routes_list[i].id end\n     break\n    end\n   end\n   if route_id and route_id~=\"\" then\n    local data=databank.getStringValue(route_id):gsub(\"@@@\",\"\\\"\")\n    data=json.decode(data)\n    if data~=nil then\n     local counter=0\n     for i,v in pairs(data) do counter=counter +1 end\n     pages=math.ceil(counter/5)\n    else\n     pages=1\n     routes_wp_page_index=1\n    end\n   else\n    pages=1\n    routes_wp_page_index=1\n   end\n  end\n  return pages\n end\n wp_pages=generating_wp_pages(0)\n\n--WP CHECK\n function wp_check()\n  local dbn=databank.getNbKeys()\n  stored=\"\"\n  for i=1, dbn+1 do\n   local wp_id=tostring(\"wp\"..i)\n   local wp_checking=databank.getStringValue(wp_id)\n   if keypad_input_wpname==wp_checking then stored=\"WP Name Already Exist\" break end\n  end\n  if stored~=\"WP Name Already Exist\" then\n   for i=1, dbn+1 do\n    local wp_id=tostring(\"wp\"..i)\n    local wp_checking=databank.getStringValue(wp_id)\n    if wp_checking==\"\" then\n     local name=databank.setStringValue(wp_id, keypad_input_wpname)\n     local coord=databank.setStringValue(wp_id..\"_coord\", tostring(from_coordinates))\n     stored=\"STORED\"\n     break\n    end\n   end\n  end\n  wp_settings_init()\n end\n\n--ROUTING\n function routing(id, name)\n  local route={[\"name\"]=name}\n  route=json.encode(route)\n  databank.setStringValue(id, route:gsub(\"\\\"\",\"@@@\"))\n end\n\n function add_wp_to_route(id, wp)\n  local route_id=route_id_selected\n  local data=databank.getStringValue(route_id):gsub(\"@@@\",\"\\\"\")\n  data=json.decode(data)\n  data[id]=wp\n  data=json.encode(data)\n  databank.setStringValue(route_id, data:gsub(\"\\\"\",\"@@@\"))\n end\n\n--INVERT ROUTE\n function invert_route()\n  local dest=databank.getStringValue(\"from\")\n  local from=databank.getStringValue(\"to\")\n\n  if dest~=\"\" and from~=\"\" then\n   keypad_input_from=from\n   for i=1, #wp_list do\n    local from_check=databank.getStringValue(wp_list[i].wp)\n    if from_check==from then\n     keypad_input_from=wp_list[i].id\n     break\n    end\n   end\n   databank.setStringValue(\"from\", keypad_input_from)\n\n   keypad_input_dest=dest\n   if (dest==\"\" or dest==\"PPOS\") then keypad_input_dest=\"No Previous Point\"\n   else\n    for i=1, #wp_list do\n     local dest_check=databank.getStringValue(wp_list[i].wp)\n     if dest_check==dest then\n      keypad_input_dest=wp_list[i].id\n      break\n     end\n    end\n   end\n   databank.setStringValue(\"to\", keypad_input_dest)\n\n   from_coordinates=\"\"\n   from_inserted=false\n   status_FM=\"\"\n   status_TO=\"\"\n   FROM_tick=\">\"\n   keypad_input_wpname=\"\"\n   wpname_inserted=false\n   WPADD_tick=\"\"\n   stored=\"\"\n   destination_inserted=false\n   destination_coord=\"\"\n   distance_to_go=\"\"\n   distance_to_go_warp=0\n  end\n end\n\n--ENT DESTINATION WP\n function ent_to_wp(dest)\n  ScreenSelection=\"\"\n  if ((screenState==0 or screenState==15) and dest~=\"\") then\n   for i=1, #wp_list do\n    if dest==wp_list[i].name then\n     dest=wp_list[i].id\n     if screenState==0 then screenState=3 end\n     keypad_input_dest=dest\n     databank.setStringValue(\"to\", keypad_input_dest)\n     status_TO=\"\"\n     destination_inserted=false\n     destination_coord=\"\"\n     distance_to_go=\"\"\n     distance_to_go_warp=0\n     ent_button()\n     break\n    end\n   end\n  elseif (screenState==6 and dest~=\"\") then\n   for i, v in pairs(atlas[0]) do\n    if dest==atlas[0][i].name[1] then\n     screenState=3\n     keypad_input_dest=dest\n     databank.setStringValue(\"to\", keypad_input_dest)\n     status_TO=\"\"\n     destination_inserted=false\n     destination_coord=\"\"\n     distance_to_go=\"\"\n     distance_to_go_warp=0\n     ent_button()\n     break\n    end\n   end\n  end\n end\n\n--ENT FROM WP\n function ent_from_wp(from)\n  if (screenState==0 and from~=\"\") then\n   for i=1, #wp_list do\n    if from==wp_list[i].name then\n     from=wp_list[i].id\n     screenState=2\n     keypad_input_from=from\n     databank.setStringValue(\"from\", keypad_input_from)\n     from_coordinates=\"\"\n     from_inserted=false\n     status_FM=\"\"\n     FROM_tick=\">\"\n     keypad_input_wpname=\"\"\n     wpname_inserted=false\n     WPADD_tick=\"\"\n     stored=\"\"\n     ent_button()\n     break\n    else\n     screenState=2\n    end\n   end\n  elseif (screenState==6 and from~=\"\") then\n   for i, v in pairs(atlas[0]) do\n    if from==atlas[0][i].name[1] then\n     screenState=2\n     keypad_input_from=from\n     databank.setStringValue(\"from\", keypad_input_from)\n     from_coordinates=\"\"\n     from_inserted=false\n     status_FM=\"\"\n     FROM_tick=\">\"\n     keypad_input_wpname=\"\"\n     wpname_inserted=false\n     WPADD_tick=\"\"\n     stored=\"\"\n     ent_button()\n     break\n    end\n   end\n  else\n   screenState=2\n  end\n end\n\n--WP SETTINGS INIT\n function wp_settings_init()\n  local dbKeys=databank.getNbKeys()\n\n  local check=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n  if check==\"\" then\n   local data={}\n   data=json.encode(data)\n   databank.setStringValue(\"wp_settings\", data:gsub(\"\\\"\",\"@@@\"))\n  else\n   check=json.decode(check)\n   for i, v in pairs(check) do\n    if (check[i].alt==\"\" and check[i].s==\"\") then check[i]=nil end\n   end\n   check=json.encode(check)\n   databank.setStringValue(\"wp_settings\", check:gsub(\"\\\"\",\"@@@\"))\n  end\n end\n wp_settings_init()\n\n--MAIN MENU\n if not screenState then screenState=0 end\n --MENU FUNCTIONS\n  function menu_time_calculator()\n   ScreenSelection=\"\"\n   time_to_go=[[\"\"]]\n   screenState=1\n  end\n\n  function menu_from(from)\n   ScreenSelection=\"\"\n   if (screenState==0 or screenState==6) then\n    if from then ent_from_wp(from) else screenState=2 end\n   else screenState=2 end\n  end\n\n  function menu_destination(dest)\n   if dest==nil then dest=\"\" end\n   ScreenSelection=\"\"\n   if (screenState==0 or screenState==6 or screenState==15) and dest~=\"\" then\n    if dest~=\"\" then ent_to_wp(dest) end\n   elseif (screenState==14 and dest~=\"\") then\n    local DbKeys=databank.getNbKeys()\n    for i=1, DbKeys do\n     local key=\"Route\"..i\n     local data=databank.getStringValue(key):gsub(\"@@@\",\"\\\"\")\n     if data~=\"\" then\n      data=json.decode(data)\n      if data.name==dest then\n       for i=1, #routes_list do\n        if routes_list[i].route==dest then\n         selected_route_id=routes_list[i].id\n         break\n        end\n       end\n       selected_route_name=dest\n       selected_route_page_index=1\n       wp_tick_={}\n       wp_tick_n=1\n       wp_tick_[1]=\">\"\n       WpTickList=json.encode(wp_tick_)\n       first_wp_selected=false\n       next_wp_selected=false\n       screenState=15\n       break\n      end\n     end\n    end\n   else\n    screenState=3\n   end\n  end\n\n  function menu_PE_targe_alt()\n   target_alt_warning=\"\"\n   screenState=4\n  end\n\n  function menu_settings()\n   if screenState==0 then ScreenOrigin=0 end\n   if (screenState==0 or screenState==15) then\n    edit_wp=nil\n\n    if (screenState==15 and status_TO==\"TO\") then\n     for i, v in pairs(WpRouteList) do\n      if string.find(v, \"To \") then UserSelectedWp=\"WpID \"..i end\n     end\n     local WpID=ScreenSelection:gsub(\"WpID \", \"\")\n     WpID=tonumber(WpID)\n     if WpID==nil then edit_wp=nil\n     else ScreenSelection=WpRouteList[WpID]:gsub(\"To \", \"\") end\n    end\n\n    for i=1, #wp_list do\n     if wp_list[i].name==ScreenSelection then edit_wp=wp_list[i].id break end\n    end\n\n    if edit_wp~=nil then\n     screenState=16\n     wp_altitude_tick=\">\"\n     wp_speed_tick=\"\"\n     wp_altitude_inserted=true\n     wp_speed_inserted=true\n     for x=1, #wp_list do\n      if wp_list[x].id==edit_wp then\n       local wp_id=wp_list[x].wp\n       edit_wp=databank.getStringValue(wp_id)\n       break\n      end\n     end\n     local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n     ext=json.decode(ext)\n     if ext[edit_wp] then\n      keypad_input_wp_altitude=ext[edit_wp].alt\n      keypad_input_wp_speed=ext[edit_wp].s\n     else\n      keypad_input_wp_altitude=\"\"\n      keypad_input_wp_speed=\"\"\n     end\n    elseif (ScreenSelection==\"HOLD\" or ScreenSelection==\"hold\") then\n     screenState=5\n     MTOW_tick=\"\"\n     autobrake_tick=\"\"\n     wp_dist_tick=\"\"\n     holding_tick=\">\"\n    else \n     if (routing_timer and screenState==15) then\n      for i=1, #WpRouteList do\n       if string.find(WpRouteList[i], \"To \") then UserSelectedWp=\"WpID \"..i end\n      end\n     end\n     screenState=9\n     ScreenSelection=\"\"\n    end\n\n   elseif (routing_timer and screenState==16) then screenState=15\n   elseif (routing_timer and screenState==9) then screenState=15\n   elseif (routing_timer and screenState==5) then screenState=15\n   elseif (ScreenOrigin==0 and screenState==16) then screenState=0\n    ScreenOrigin=\"\"\n    ScreenSelection=\"\"\n    screenState=0\n   else screenState=9 end\n  end\n\n  function menu_wp_atlas()\n   ScreenSelection=\"\"\n   if screenState==6 then\n    screenState=0\n    wp_atlas=\"wp\"\n    wp_page_index=1\n   elseif screenState==0 then\n    screenState=6\n    wp_atlas=\"atlas\"\n    atlas_page_index=1\n   elseif wp_atlas==\"wp\" then\n    screenState=0\n   elseif wp_atlas==\"atlas\" then\n    screenState=6\n   end\n  end\n\n --MENU BUTTONS\n  function menu(x)\n   if x==nil then KeyLabel=\"WP/ATLAS\" screenState=6 else KeyLabel=x end\n   if KeyLabel==\"Time Calculator\" then menu_time_calculator()\n   elseif KeyLabel==\"From\" then menu_from(ScreenSelection)\n   elseif KeyLabel==\"Destination\" then menu_destination(ScreenSelection)\n   elseif KeyLabel==\"AD/RN WP\" then add_wp()\n   elseif KeyLabel==\"CLR WP\" then clr_wp(ScreenSelection)\n   elseif KeyLabel==\"WP/ATLAS\" then menu_wp_atlas()\n   elseif KeyLabel==\"INV Route\" then invert_route()\n   elseif KeyLabel==\"Settings\" then menu_settings()\n   elseif KeyLabel==\"PE Target Altitude\" then menu_PE_targe_alt()\n   elseif KeyLabel==\"Shield\" then\n    if shield then\n     screenState=17\n     local ResistanceTable=shield.getResistances()\n     Ran=tonumber(string.format(\"%.0f\", (ResistanceTable[1]*100)+10))\n     Rel=tonumber(string.format(\"%.0f\", (ResistanceTable[2]*100)+10))\n     Rki=tonumber(string.format(\"%.0f\", (ResistanceTable[3]*100)+10))\n     Rth=tonumber(string.format(\"%.0f\", (ResistanceTable[4]*100)+10))\n     unit.setTimer(\"shield\", 1)\n     shieldFunction()\n    end\n   elseif KeyLabel==\"AGG\" then\n    screenState=13\n    agg_tick_1=\"\"   \n    agg_tick_input=\"\"\n    agg_tick_3=\"\"\n    keypad_input_agg_target_alt=databank.getIntValue(\"agg_t_alt\")\n    agg_target_altitude=true\n    unit.setTimer(\"agg\", 1)\n   end\n   if init_menu then LuaScreen() else init_menu=true end\n  end\n  menu(Menu_First_Page)\n\n--DATABANK CLEANING\n function databank_clean(wp, settings, id, colors, dmg)\n  local store_db_wp={}\n  local stored_db_route={}\n  local stored_db_wpsettings={}\n  local settings_list={}\n  local id_list={}\n  local colors_list={}\n  local dmg_list={}\n  local item_cleared=\"\"\n\n  if wp==true then\n   local dbn=databank.getNbKeys()\n   local counter=0\n   for i=1, dbn do\n    local key=\"wp\"..i\n    local value=databank.getStringValue(key)\n    local key_coord=\"wp\"..i..\"_coord\"\n    local value_coord=databank.getStringValue(key_coord)\n    if (value~=\"\" and value_coord~=\"\") then\n     counter=counter +1\n     local new_key=\"wp\"..counter\n     local new_key_coord=\"wp\"..counter..\"_coord\"\n     store_db_wp[counter]={[\"key\"]=new_key, [\"value\"]=value, [\"key_coord\"]=new_key_coord, [\"value_coord\"]=value_coord}\n    end\n   end\n\n   stored_db_route={}\n   local counter=0\n   for x=1, dbn do\n    local route_id=\"Route\"..x\n    local data=databank.getStringValue(route_id):gsub(\"@@@\",\"\\\"\")\n    data=json.decode(data)\n    if data then\n     if (data.wp1~=nil or data.wp1~=\"\") then\n      counter=counter +1\n      local name=data.name\n      stored_db_route[name]={}\n      local x=-1\n      for i, v in pairs(data) do x=x +1 end\n      for y=1, x do\n       local wp_id=\"wp\"..y\n       local wp=data[wp_id]\n       if wp~=nil then\n        table.insert(stored_db_route[name], y, wp)\n       end\n      end\n     end\n    end\n   end\n\n   stored_db_wpsettings={}\n   local counter=0\n   local data=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n   data=json.decode(data)\n   if data then\n    for i, v in pairs(data) do\n     if (data[i].alt~=nil or data[i].alt~=\"\" or data[i].s~=nil or data[i].s~=\"\") then\n      counter=counter +1\n      local name=i\n      local alt=data[i].alt\n      local s=data[i].s\n      stored_db_wpsettings[counter]={[\"name\"]=name,[\"alt\"]=alt,[\"s\"]=s}\n     end\n    end\n   end\n  else\n   item_cleared=item_cleared..\"(1)\"\n  end\n\n  if settings==true then\n   local name=\"navigator_MTOW\"\n   local value=databank.getFloatValue(\"navigator_MTOW\")\n   settings_list[1]={[\"name\"]=name, [\"value\"]=value}\n   name=\"navigator_autobrake\"\n   value=databank.getFloatValue(\"navigator_autobrake\")\n   settings_list[2]={[\"name\"]=name, [\"value\"]=value}\n   name=\"navigator_wpdist\"\n   value=databank.getFloatValue(\"navigator_wpdist\")\n   settings_list[3]={[\"name\"]=name, [\"value\"]=value}\n   name=\"holding_speed\"\n   value=databank.getFloatValue(\"holding_speed\")\n   settings_list[4]={[\"name\"]=name, [\"value\"]=value}\n  else\n   keypad_input_MTOW=factory_MTOW/1000\n   keypad_input_autobrake=factory_autobrake\n   keypad_input_wpdist=wp_sequencing_distance\n   keypad_input_holding=holding_speed\n   item_cleared=item_cleared..\"(2)\"\n  end\n\n  if id==true then\n   local name=\"Ship ID\"\n   local value=databank.getStringValue(\"Ship ID\")\n   id_list[1]={[\"name\"]=name, [\"value\"]=value}\n  else\n   keypad_input_shipid=\"\"\n   item_cleared=item_cleared..\"(3)\"\n  end\n\n  if colors==true then\n   local name=\"SCRTableColor\"\n   local value=databank.getStringValue(\"SCRTableColor\")\n   colors_list[1]={[\"name\"]=name, [\"value\"]=value}\n   name=\"SCRFontTitle\"\n   value=databank.getStringValue(\"SCRFontTitle\")\n   colors_list[2]={[\"name\"]=name, [\"value\"]=value}\n   name=\"SCRFontColor\"\n   value=databank.getStringValue(\"SCRFontColor\")\n   colors_list[3]={[\"name\"]=name, [\"value\"]=value}\n   name=\"SCRButtonPressed\"\n   value=databank.getStringValue(\"SCRButtonPressed\")\n   colors_list[4]={[\"name\"]=name, [\"value\"]=value}\n   name=\"SCRButtonColor\"\n   value=databank.getStringValue(\"SCRButtonColor\")\n   colors_list[5]={[\"name\"]=name, [\"value\"]=value}\n  else\n   Table_RGB=\"0,0,255\"\n   databank.setStringValue(\"SCRTableColor\", \"{0,0,255}\")\n   Title_RGB=\"255,255,0\"\n   databank.setStringValue(\"SCRFontTitle\", \"{255,255,0}\")\n   Font_RGB=\"217,217,217\"\n   databank.setStringValue(\"SCRFontColor\", \"{217,217,217}\")\n   Button_Pressed_RGB=\"0,0,255\"\n   databank.setStringValue(\"SCRButtonColor\", \"{0,0,255}\")\n   Button_RGB=\"255,0,0\"\n   databank.setStringValue(\"SCRButtonPressed\", \"{255,0,0}\")\n   item_cleared=item_cleared..\"(4)\"\n  end\n\n  if dmg==true then\n   local name=\"DMG Scale\"\n   local value=databank.getFloatValue(\"DMG Scale\")\n   dmg_list[1]={[\"name\"]=name, [\"value\"]=value}\n   name=\"DMG TV U/D\"\n   value=databank.getFloatValue(\"DMG TV U/D\")\n   dmg_list[2]={[\"name\"]=name, [\"value\"]=value}\n   name=\"DMG TV L/R\"\n   value=databank.getFloatValue(\"DMG TV L/R\")\n   dmg_list[3]={[\"name\"]=name, [\"value\"]=value}\n   name=\"DMG SV U/D\"\n   value=databank.getFloatValue(\"DMG SV U/D\")\n   dmg_list[4]={[\"name\"]=name, [\"value\"]=value}\n   name=\"DMG SV L/R\"\n   value=databank.getFloatValue(\"DMG SV L/R\")\n   dmg_list[5]={[\"name\"]=name, [\"value\"]=value}\n  else\n   keypad_input_dmg1=3\n   DMG_REP_TOP_VIEW_Up_Down=-20\n   DMG_REP_TOP_VIEW_LH_RH=30\n   DMG_REP_SIDE_VIEW_Up_Down=40\n   DMG_REP_SIDE_VIEW_LH_RH=100\n   item_cleared=item_cleared..\"(5)\"\n  end\n\n  databank.clear()\n  system.print(\"CLEARING DATABANK\")\n  databank_initialization()\n  system.print(\"REGENERATING DATABANK, KEYS: \"..databank.getNbKeys())\n\n  if wp==true then\n   local id=0\n   local restore_data={}\n   local route_id=\"\"\n   for i=1, #store_db_wp do\n    databank.setStringValue(store_db_wp[i].key, store_db_wp[i].value)\n    databank.setStringValue(store_db_wp[i].key_coord, store_db_wp[i].value_coord)\n   end\n   table.sort(stored_db_route)\n   for i, v in pairs(stored_db_route) do\n    id=id +1\n    route_id=\"Route\"..id\n    restore_data={[\"name\"]=i}\n    for k, f in pairs(stored_db_route[i]) do\n     local wp_id=\"wp\"..k\n     restore_data[wp_id]=f\n    end\n    restore_data=json.encode(restore_data)\n    databank.setStringValue(route_id, restore_data:gsub(\"\\\"\",\"@@@\"))\n   end\n\n   if stored_db_wpsettings then\n    restore_data={}\n    for i=1, #stored_db_wpsettings do\n     local name=stored_db_wpsettings[i].name\n     local alt=stored_db_wpsettings[i].alt\n     local s=stored_db_wpsettings[i].s\n     restore_data[name]={[\"alt\"]=alt,[\"s\"]=s}\n    end\n    restore_data=json.encode(restore_data)\n    databank.setStringValue(\"wp_settings\", restore_data:gsub(\"\\\"\",\"@@@\"))\n   end\n  end\n\n  if settings==true then\n   for i=1, #settings_list do\n    databank.setFloatValue(settings_list[i].name, settings_list[i].value)\n   end\n  end\n\n  if id==true then\n   for i=1, #id_list do\n    databank.setStringValue(id_list[i].name, id_list[i].value)\n   end\n  end\n\n  if colors==true then\n   for i=1, #colors_list do\n    databank.setStringValue(colors_list[i].name, colors_list[i].value)\n   end\n  end\n\n  if dmg==true then\n   for i=1, #dmg_list do\n    databank.setFloatValue(dmg_list[i].name, dmg_list[i].value)\n   end\n  end\n\n  wp_settings_init()\n\n  reset_db_status=\"CLEARED: \"..item_cleared\n  reset_db_status2=\"Restart The Interface\"\n  system.print(\"DATABANK REGENERATED, KEYS: \"..databank.getNbKeys())\n\n  screenState=12\n  LuaScreen()\n end\n\n--DATA STATUS\n ship_id=\"\"\n status_FM=\"\"\n status_TO=\"\"\n status_TA=\"\"\n local ship_id_verified=false\n \n if (databank.getStringValue(\"databank_verification\")==\"Verified\") then\n  databank.setStringValue(\"\", nil)\n  ship_id=databank.getStringValue(\"Ship ID\")\n end\n if (ship_id==\"n/a\" or ship_id==\"\") then ShipIdCheck=false else ShipIdCheck=true end\n\n--KEYPAD ADD DIGITS\n function insert_keys(new_digit) --set rules\n  --TIME CALCULATOR PAGE\n   if (screenState==1 and (tonumber(new_digit)~=nil or new_digit==\".\")) then\n    if keypad_input_su==[[\"\"]] then\n     keypad_input_su=nil\n     databank.setFloatValue(\"navigator_distance\", \"n/a\")\n     su_distance_inserted=false\n    end\n\n    if time_to_go==[[\"Speed Is Invalid\"]] then\n     keypad_input_speed=nil\n     databank.setFloatValue(\"navigator_speed\", \"0\")\n     time_to_go=[[\"\"]]\n     databank.setFloatValue(\"navigator_eta_h\", 0)\n     databank.setFloatValue(\"navigator_eta_m\", 0)\n     databank.setFloatValue(\"navigator_eta_s\", 0)\n    end\n\n    if (su_distance_inserted==true and speed_inserted==true) or (keypad_input_speed==[[\"\"]]) then\n     keypad_input_speed=nil\n     databank.setFloatValue(\"navigator_speed\", \"0\")\n     speed_inserted=false\n     time_to_go=[[\"\"]]\n     databank.setFloatValue(\"navigator_eta_h\", 0)\n     databank.setFloatValue(\"navigator_eta_m\", 0)\n     databank.setFloatValue(\"navigator_eta_s\", 0)\n    end\n\n    if su_distance_inserted==false then\n     keypad_input=keypad_input_su\n     keypad_input_su=add_digit(new_digit, keypad_input)\n    elseif speed_inserted==false then\n     keypad_input=keypad_input_speed\n     keypad_input_speed=add_digit(new_digit, keypad_input)\n    end\n   end\n\n  --FROM PAGE\n   if screenState==2 then\n    if (FROM_tick==\">\" and from_inserted==true or keypad_input_from==\"No Previous Point\") then\n     keypad_input_from=nil\n     databank.setStringValue(\"navigator_from\", \"no From\")\n     from_inserted=false\n     status_FM=\"\"\n     from_coordinates=\"\"\n     databank.setStringValue(\"navigator_from_coordinates\", \"n/a\")\n    end\n\n    if from_inserted==false then\n     keypad_input=keypad_input_from\n     keypad_input_from=add_digit(new_digit, keypad_input)\n    elseif (from_inserted==true and WPADD_tick==\">\"   ) then\n     keypad_input=keypad_input_wpname\n     keypad_input_wpname=add_digit(new_digit, keypad_input)\n    end\n   end\n\n  --DESTINATION PAGE\n   if screenState==3 then\n    if (destination_coord==\"Not Present In Databank\" or destination_inserted==true or keypad_input_dest==\"No Previous Point\") then\n     keypad_input_dest=nil\n     databank.setStringValue(\"navigator_target_destination\", \"no Dest.\")\n     destination_inserted=false\n     status_TO=\"\"\n     distance_to_go=\"\"\n     destination_coord=\"\"\n     databank.setStringValue(\"navigator_coordinates\", \"n/a\")\n    end\n    keypad_input=keypad_input_dest\n    keypad_input_dest=add_digit(new_digit, keypad_input)\n   end\n\n  --TARGET PE ALTITUDE PAGE\n   if screenState==4 then\n    if (target_alt_warning==\"Warning Altitude Too Low\" or target_pe_altitude_inserted==true or target_alt_warning==\"Invalid Input\") then\n     keypad_input_pe_target_alt=nil\n     target_pe_altitude_inserted=false\n     status_TA=\"\"\n     target_alt_warning=\"\"\n    else\n     keypad_input_pe_target_alt=keypad_input_pe_target_alt\n    end\n\n    if tonumber(new_digit)~=nil then\n     keypad_input=keypad_input_pe_target_alt\n     keypad_input_pe_target_alt=add_digit(new_digit, keypad_input)\n    end\n   end\n\n  --AGG\n   if (screenState==13 and agg_tick_input==\">\") then\n    if (agg_target_altitude==true and tonumber(new_digit)~=nil) then\n     keypad_input_agg_target_alt=\"\"\n     agg_target_altitude=false\n    end\n\n    if tonumber(new_digit)~=nil then\n     keypad_input=keypad_input_agg_target_alt\n     keypad_input_agg_target_alt=add_digit(new_digit, keypad_input)\n    end\n   end\n\n  --SETTINGS PAGE\n   if (screenState==5 and (tonumber(new_digit)~=nil or new_digit==\".\")) then  --(Ship Settings)\n    if (MTOW_inserted==true and MTOW_tick==\">\") then\n     keypad_input_MTOW=\"\"\n     MTOW_inserted=false\n    elseif (autobrake_stops_at_inserted==true and autobrake_tick==\">\") then\n     keypad_input_autobrake=\"\"\n     autobrake_stops_at_inserted=false\n    elseif (wp_dist_inserted==true and wp_dist_tick==\">\") then\n     keypad_input_wpdist=\"\"\n     wp_dist_inserted=false\n    elseif (holding_speed_inserted==true and holding_tick==\">\") then\n     keypad_input_holding=\"\"\n     holding_speed_inserted=false\n    end\n    if MTOW_inserted==false then\n     keypad_input=keypad_input_MTOW\n     keypad_input_MTOW=add_digit(new_digit, keypad_input)\n    elseif autobrake_stops_at_inserted==false then\n     keypad_input=keypad_input_autobrake\n     keypad_input_autobrake=add_digit(new_digit, keypad_input)\n    elseif wp_dist_inserted==false then\n     keypad_input=keypad_input_wpdist\n     keypad_input_wpdist=add_digit(new_digit, keypad_input)\n    elseif holding_speed_inserted==false then\n     keypad_input=keypad_input_holding\n     keypad_input_holding=add_digit(new_digit, keypad_input)\n    end\n   elseif screenState==7 then --(WP Store)\n    if wp_name_tick==\">\" then\n     keypad_input=keypad_input_wp_name\n     keypad_input_wp_name=add_digit(new_digit, keypad_input)\n    elseif wp_lat_tick==\">\" then\n     keypad_input=keypad_input_wp_lat\n     keypad_input_wp_lat=add_digit(new_digit, keypad_input)\n    elseif wp_lon_tick==\">\" then\n     keypad_input=keypad_input_wp_lon\n     keypad_input_wp_lon=add_digit(new_digit, keypad_input)\n    elseif wp_alt_tick==\">\" then\n     keypad_input=keypad_input_wp_alt\n     keypad_input_wp_alt=add_digit(new_digit, keypad_input)\n    end\n   elseif screenState==8 then --(WP Sync)\n    if shipid_tick==\">\" then\n     keypad_input=keypad_input_shipid\n     keypad_input_shipid=add_digit(new_digit, keypad_input)\n    end\n   elseif screenState==10 then --(Screen Colors)\n    if (tick_color_1==\">\" and (keypad_input_color1==\"Insert RGB\" or RGBColor1==true)) then\n     keypad_input_color1=\"\"\n     RGBColor1=false\n    elseif (tick_color_2==\">\" and (keypad_input_color2==\"Insert RGB\" or RGBColor2==true)) then\n     keypad_input_color2=\"\"\n     RGBColor2=false\n    elseif (tick_color_3==\">\" and (keypad_input_color3==\"Insert RGB\" or RGBColor3==true)) then\n     keypad_input_color3=\"\"\n     RGBColor3=false\n    elseif (tick_color_4==\">\" and (keypad_input_color4==\"Insert RGB\" or RGBColor4==true)) then\n     keypad_input_color4=\"\"\n     RGBColor4=false\n    elseif (tick_color_5==\">\" and (keypad_input_color5==\"Insert RGB\" or RGBColor5==true)) then\n     keypad_input_color5=\"\"\n     RGBColor5=false\n    end\n    if tick_color_1==\">\" then\n     RGBColor1=false\n     keypad_input=keypad_input_color1\n     keypad_input_color1=add_digit(new_digit, keypad_input)\n    elseif tick_color_2==\">\" then\n     RGBColor2=false\n     keypad_input=keypad_input_color2\n     keypad_input_color2=add_digit(new_digit, keypad_input)\n    elseif tick_color_3==\">\" then\n     RGBColor3=false\n     keypad_input=keypad_input_color3\n     keypad_input_color3=add_digit(new_digit, keypad_input)\n    elseif tick_color_4==\">\" then\n     RGBColor4=false\n     keypad_input=keypad_input_color4\n     keypad_input_color4=add_digit(new_digit, keypad_input)\n    elseif tick_color_5==\">\" then\n     RGBColor5=false\n     keypad_input=keypad_input_color5\n     keypad_input_color5=add_digit(new_digit, keypad_input)\n    end\n   elseif screenState==16 then --(WP Setting)\n    if (wp_altitude_inserted==true and wp_altitude_tick==\">\") then\n     keypad_input_wp_altitude=\"\"\n     wp_altitude_inserted=false\n    elseif (wp_speed_inserted==true and wp_speed_tick==\">\") then\n     keypad_input_wp_speed=\"\"\n     wp_speed_inserted=false\n    end\n    if (wp_altitude_inserted==false and wp_altitude_tick==\">\") then\n     keypad_input=keypad_input_wp_altitude\n     keypad_input_wp_altitude=add_digit(new_digit, keypad_input)\n    elseif (wp_speed_inserted==false and wp_speed_tick==\">\") then\n     keypad_input=keypad_input_wp_speed\n     keypad_input_wp_speed=add_digit(new_digit, keypad_input)\n    end\n   end\n end\n\n function add_digit(new_digit, keypad_input) --concatenate digits\n  if keypad_input then\n   return tostring(keypad_input) .. tostring(new_digit)\n  else\n   return new_digit\n  end\n end\n\n--KEYPAD NUMBERS\n if CAPS==nil then CAPS=true end\n function keypad_numbers()\n  local new_digit=\"\"\n  if KeyLabel==\"1\" then new_digit=1\n  elseif KeyLabel==\"2\" then new_digit=2\n  elseif KeyLabel==\"3\" then new_digit=3\n  elseif KeyLabel==\"4\" then new_digit=4\n  elseif KeyLabel==\"5\" then new_digit=5\n  elseif KeyLabel==\"6\" then new_digit=6\n  elseif KeyLabel==\"7\" then new_digit=7\n  elseif KeyLabel==\"8\" then new_digit=8\n  elseif KeyLabel==\"9\" then new_digit=9\n  elseif KeyLabel==\"0\" then new_digit=0\n  elseif KeyLabel==\"CLR\" then clr_button()\n  elseif KeyLabel==\"ENT\" then ent_button()\n  elseif KeyLabel==\".\" then\n   if screenState==10 then new_digit=\",\" else new_digit=\".\" end\n  elseif KeyLabel==\"-\" then new_digit=\"-0\"\n  elseif KeyLabel==\"arrowup\" then small_arrow_up()\n  elseif KeyLabel==\"arrowdn\" then small_arrow_down()\n  elseif KeyLabel==\"arrowUP\" then big_arrow_up()\n  elseif KeyLabel==\"arrowDN\" then big_arrow_down()\n  elseif KeyLabel==\"CAPS\" then\n   if CAPS then CAPS=false else CAPS=true end\n  end\n  if new_digit~=\"\" then insert_keys(new_digit) end\n  LuaScreen()\n end\n\n--KEYPAD LETTERS\n function keypad_letters()\n  local new_digit=\"\"\n  if KeyLabel==\"A\" then new_digit=\"A\"\n  elseif KeyLabel==\"B\" then new_digit=\"B\"\n  elseif KeyLabel==\"C\" then new_digit=\"C\"\n  elseif KeyLabel==\"D\" then new_digit=\"D\"\n  elseif KeyLabel==\"E\" then new_digit=\"E\"\n  elseif KeyLabel==\"F\" then new_digit=\"F\"\n  elseif KeyLabel==\"G\" then new_digit=\"G\"\n  elseif KeyLabel==\"H\" then new_digit=\"H\"\n  elseif KeyLabel==\"I\" then new_digit=\"I\"\n  elseif KeyLabel==\"J\" then new_digit=\"J\"\n  elseif KeyLabel==\"K\" then new_digit=\"K\"\n  elseif KeyLabel==\"L\" then new_digit=\"L\"\n  elseif KeyLabel==\"M\" then new_digit=\"M\"\n  elseif KeyLabel==\"N\" then new_digit=\"N\"\n  elseif KeyLabel==\"O\" then new_digit=\"O\"\n  elseif KeyLabel==\"P\" then new_digit=\"P\"\n  elseif KeyLabel==\"Q\" then new_digit=\"Q\"\n  elseif KeyLabel==\"R\" then new_digit=\"R\"\n  elseif KeyLabel==\"S\" then new_digit=\"S\"\n  elseif KeyLabel==\"T\" then new_digit=\"T\"\n  elseif KeyLabel==\"U\" then new_digit=\"U\"\n  elseif KeyLabel==\"V\" then new_digit=\"V\"\n  elseif KeyLabel==\"W\" then new_digit=\"W\"\n  elseif KeyLabel==\"X\" then new_digit=\"X\"\n  elseif KeyLabel==\"Y\" then new_digit=\"Y\"\n  elseif KeyLabel==\"Z\" then new_digit=\"Z\"\n  elseif KeyLabel==\"_\" then new_digit=\"_\"\n  elseif KeyLabel==\"moon\" then new_digit=\"_moon_\"\n  elseif KeyLabel==\"a\" then new_digit=\"a\"\n  elseif KeyLabel==\"b\" then new_digit=\"b\"\n  elseif KeyLabel==\"c\" then new_digit=\"c\"\n  elseif KeyLabel==\"d\" then new_digit=\"d\"\n  elseif KeyLabel==\"e\" then new_digit=\"e\"\n  elseif KeyLabel==\"f\" then new_digit=\"f\"\n  elseif KeyLabel==\"G\" then new_digit=\"g\"\n  elseif KeyLabel==\"h\" then new_digit=\"h\"\n  elseif KeyLabel==\"i\" then new_digit=\"i\"\n  elseif KeyLabel==\"j\" then new_digit=\"j\"\n  elseif KeyLabel==\"k\" then new_digit=\"k\"\n  elseif KeyLabel==\"l\" then new_digit=\"l\"\n  elseif KeyLabel==\"m\" then new_digit=\"m\"\n  elseif KeyLabel==\"n\" then new_digit=\"n\"\n  elseif KeyLabel==\"o\" then new_digit=\"o\"\n  elseif KeyLabel==\"p\" then new_digit=\"p\"\n  elseif KeyLabel==\"q\" then new_digit=\"q\"\n  elseif KeyLabel==\"r\" then new_digit=\"r\"\n  elseif KeyLabel==\"s\" then new_digit=\"s\"\n  elseif KeyLabel==\"t\" then new_digit=\"t\"\n  elseif KeyLabel==\"u\" then new_digit=\"u\"\n  elseif KeyLabel==\"v\" then new_digit=\"v\"\n  elseif KeyLabel==\"w\" then new_digit=\"w\"\n  elseif KeyLabel==\"x\" then new_digit=\"x\"\n  elseif KeyLabel==\"y\" then new_digit=\"y\"\n  elseif KeyLabel==\"z\" then new_digit=\"z\"\n  end\n  insert_keys(new_digit)\n  LuaScreen()\n end\n\n--BUTTON FUNCTIONS\n --ADD/RENAME WP BUTTON\n  function add_wp()\n   ScreenSelection=\"\"\n   if (screenState==2 and keypad_input_from==\"PPOS\" and keypad_input_wpname~=\"\") then\n    wp_check()\n    screenState=2\n   elseif (screenState==2 and keypad_input_from~=\"\" and keypad_input_wpname~=\"\") then\n    databank.setStringValue(wp_id_rename, keypad_input_wpname)\n    stored=\"WP RENAMED\"\n    local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n    ext=json.decode(ext)\n    if ext[keypad_input_from] then\n     ext[keypad_input_wpname]={[\"alt\"]=ext[keypad_input_from].alt,[\"s\"]=ext[keypad_input_from].s}\n     ext=json.encode(ext)\n     databank.setStringValue(\"wp_settings\", ext:gsub(\"\\\"\",\"@@@\"))\n    end\n    screenState=2\n   elseif (screenState==7 and wp_name_inserted==true and wp_lat_inserted==true and wp_lon_inserted==true and wp_alt_inserted==true and (wp_name_tick==\">\" or wp_lat_tick==\">\" or wp_lon_tick==\">\" or wp_alt_tick==\">\")) then\n    keypad_input_wpname=keypad_input_wp_name\n    if (wp_selected_planet~=\"Invalid Entry\" and wp_selected_planet~=\"World Coordinates\" and wp_coordinated_stored~=\"\") then from_coordinates=coord_converter()\n    else from_coordinates=vec3(tonumber(keypad_input_wp_lat),tonumber(keypad_input_wp_lon),tonumber(keypad_input_wp_alt)) end\n    wp_check()\n    if stored==\"WP Name Already Exist\" then screenState=7\n    else screenState=0 end\n   end\n  end\n\n --CLR WP BUTTON\n  function clr_wp(clr)\n   ScreenSelection=\"\"\n   if (clr~=\"\" and screenState==0) then\n    local wp_name=clr\n    for x=1, #wp_list do\n     if wp_list[x].name==wp_name then\n      local wp_del=wp_list[x].wp\n      databank.setStringValue(wp_del, nil)\n      databank.setStringValue(wp_del..\"_coord\", nil)\n      local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n      ext=json.decode(ext)\n      ext[wp_name]=nil\n      ext=json.encode(ext)\n      databank.setStringValue(\"wp_settings\", ext:gsub(\"\\\"\",\"@@@\"))\n      break\n     end\n    end\n   elseif screenState==14 then\n    if route_tick_[route_tick_n]==\">\" then\n     local RouteName=clr\n     local dbn=databank.getNbKeys()\n     for i=1, dbn do\n      local RouteID=\"Route\"..i\n      local data=databank.getStringValue(RouteID):gsub(\"@@@\",\"\\\"\")\n      if data~=\"\" then\n       data=json.decode(data)\n       if data.name==RouteName then databank.setStringValue(RouteID, \"\") break end\n      end\n     end\n    elseif route_tick_[route_tick_n]==\"*\" then\n     local route_id=routes_list[route_tick_n]\n     if (route_id~=nil and route_id~=\"\") then\n      route_id=routes_list[route_tick_n].id\n      local data=databank.getStringValue(route_id):gsub(\"@@@\",\"\\\"\")\n      data=json.decode(data)\n      local wp_id=\"wp\"..wp_tick_n\n      data[wp_id]=\"\"\n\n      local RefreshList={}\n      for i, v in pairs(data) do\n       if (v~=nil and v~=\"\") then RefreshList[i]=v end\n      end\n\n      local RebuildList={}\n      RebuildList[\"name\"]=RefreshList[\"name\"]\n      local WpNb=0\n      for i, v in pairs(RefreshList) do\n       local WpNb2=0\n       if string.find(i, \"wp\") then\n        local x=i:gsub(\"wp\", \"\")\n        WpNb2=tonumber(x)\n       end\n       if WpNb2>WpNb then WpNb=WpNb2 end\n      end\n\n      for i=1, WpNb do\n       local WpID=\"wp\"..i\n       if RefreshList[WpID]==nil then RebuildList[WpID]=\"\"\n       else RebuildList[WpID]=RefreshList[WpID] end\n      end\n\n      data=RebuildList\n      data=json.encode(data)\n      databank.setStringValue(route_id, data:gsub(\"\\\"\",\"@@@\"))\n     end\n    end\n   end\n  end\n\n --BIG ARROW UP\n  function big_arrow_up()\n   if screenState==0  then      --wp page up\n    if wp_page_index>1 then\n     wp_page_index=wp_page_index -1\n    end\n   elseif screenState==6 then    --atlas page up\n    if atlas_page_index>1 then\n     atlas_page_index=atlas_page_index -1\n    end\n   end\n\n   if screenState==14 then   --settings7\n    if route_tick_[route_tick_n]~=\"*\" then\n     if routes_page_index>1 then\n      routes_page_index=routes_page_index -1\n      route_tick_n=(routes_page_index*5)-4\n      local x=generating_wp_pages(\"14routes\")\n      for i=1, x do route_tick_[i]=\"\" end\n      route_tick_[route_tick_n]=\">\"\n      RouteTickList=json.encode(route_tick_)\n     else\n      routes_page_index=1\n     end\n    else\n     if routes_wp_page_index>1 then\n      routes_wp_page_index=routes_wp_page_index -1\n      wp_tick_n=(routes_wp_page_index*5)-4\n      local x=generating_wp_pages(\"14wp\")*5\n      for i=1, x do wp_tick_[i]=\"\" end\n      wp_tick_[wp_tick_n]=\">\"\n      WpTickList=json.encode(wp_tick_)\n     else\n      routes_wp_page_index=1\n     end\n    end\n   elseif screenState==15 then   --Routing\n    if UserSelectedWp==\"\" then\n     unit.stopTimer(\"routing\")\n     for i, v in pairs(FullWpList) do\n      if string.find(FullWpList[i], \"To \") then UserSelectedWp=\"WpID \"..i end\n     end\n    end\n    if selected_route_page_index >=1 then\n     if selected_route_page_index==1 then selected_route_page_index=1\n     else selected_route_page_index=selected_route_page_index -1 end\n     wp_tick_n=(selected_route_page_index*5)-4\n     for i=wp_tick_n, wp_tick_n+4 do wp_tick_[i]=\"\" end\n     wp_tick_[wp_tick_n]=\">\"\n    end\n   end\n  end\n\n --BIG ARROW DOWN\n  function big_arrow_down()\n   if screenState==0 then       --wp page down\n    if wp_page_index<wp_pages then\n     wp_page_index=wp_page_index +1\n    end\n   elseif screenState==6 then    --atlas page down\n    if atlas_page_index<atlas_pages then\n     atlas_page_index=atlas_page_index +1\n    end\n   end\n\n   if screenState==14 then     --settings7\n    if route_tick_[route_tick_n]~=\"*\" then\n     if routes_page_index<routes_pages then\n      routes_page_index=routes_page_index +1\n      route_tick_n=(routes_page_index*5)-4\n      local x=generating_wp_pages(\"14routes\")\n      for i=1, x do route_tick_[i]=\"\" end\n      route_tick_[route_tick_n]=\">\"\n      RouteTickList=json.encode(route_tick_)\n     else routes_page_index=routes_pages end\n    else\n     if routes_wp_page_index<routes_wp_pages then\n      routes_wp_page_index=routes_wp_page_index +1\n      wp_tick_n=(routes_wp_page_index*5)-4\n      local x=generating_wp_pages(\"14wp\")*5\n      for i=1, x do wp_tick_[i]=\"\" end\n      wp_tick_[wp_tick_n]=\">\"   \n     else routes_wp_page_index=routes_wp_pages end\n    end\n   elseif screenState==15 then --Routing\n    if UserSelectedWp==\"\" then\n     for i, v in pairs(FullWpList) do\n      if string.find(FullWpList[i], \"To \") then UserSelectedWp=\"WpID \"..i end\n     end\n    end\n    if selected_route_page_index<selected_route_pages then\n     selected_route_page_index=selected_route_page_index +1\n     wp_tick_n=(selected_route_page_index*5)-4\n     for i=wp_tick_n, wp_tick_n+4 do wp_tick_[i]=\"\" end\n     wp_tick_[wp_tick_n]=\">\"\n     unit.stopTimer(\"routing\")\n    else selected_route_page_index=selected_route_pages end\n   end\n  end\n\n --SMALL ARROW UP\n  function small_arrow_up()\n   if screenState==5 then      --(Ship Settings)\n    if holding_tick==\">\" then holding_tick=\"\" wp_dist_tick=\">\"\n    elseif wp_dist_tick==\">\" then wp_dist_tick=\"\" autobrake_tick=\">\"\n    elseif autobrake_tick==\">\" then autobrake_tick=\"\" MTOW_tick=\">\"\n    end\n   elseif screenState==7 then  --(WP Store)\n    if wp_lat_tick==\">\" then wp_name_tick=\">\" wp_lat_tick=\"\"\n    elseif wp_lon_tick==\">\" then wp_lat_tick=\">\" wp_lon_tick=\"\"\n    elseif wp_alt_tick==\">\" then wp_lon_tick=\">\" wp_alt_tick=\"\"\n    end\n   elseif screenState==8 then  --(WP Sync)\n    if up_sync_tick==\">\" then up_sync_tick=\"\" dwn_sync_tick=\">\"\n    elseif dwn_sync_tick==\">\" then dwn_sync_tick=\"\" shipid_tick=\">\"\n    end\n   elseif screenState==10 then --(Screen Colors)\n    if tick_color_5==\">\" then tick_color_5=\"\" tick_color_4=\">\"\n    elseif tick_color_4==\">\" then tick_color_4=\"\" tick_color_3=\">\"\n    elseif tick_color_3==\">\" then tick_color_3=\"\" tick_color_2=\">\"\n    elseif tick_color_2==\">\" then tick_color_2=\"\" tick_color_1=\">\"\n    end\n   elseif screenState==11 then --(DMG Rep.)\n    if tick_dmg_2==\">\" then tick_dmg_2=\"\" tick_dmg_1=\">\" end\n   elseif screenState==12 then --(DB Reset)\n    if tick_[5]==\">\" then tick_[5]=\"\" tick_[4]=\">\"\n    elseif tick_[4]==\">\" then tick_[4]=\"\" tick_[3]=\">\"\n    elseif tick_[3]==\">\" then tick_[3]=\"\" tick_[2]=\">\"\n    elseif tick_[2]==\">\" then tick_[2]=\"\" tick_[1]=\">\"\n    end\n   elseif screenState==14 then --(Routes)\n    if route_tick_[route_tick_n]~=\"*\" then\n     route_tick_n=route_tick_n -1\n     if route_tick_n<route_tick_index then route_tick_n=route_tick_index end\n     route_tick_[route_tick_n+1]=\"\"\n     route_tick_[route_tick_n]=\">\"\n    else\n     wp_tick_n=wp_tick_n -1\n     if wp_tick_n<wp_tick_index then wp_tick_n=wp_tick_index end\n     wp_tick_[wp_tick_n +1]=\"\"\n     wp_tick_[wp_tick_n]=\">\"\n     WpTickList=json.encode(wp_tick_)\n    end\n    RouteTickList=json.encode(route_tick_)\n   elseif screenState==16 then --(WP Setting)\n    if wp_speed_tick==\">\" then wp_speed_tick=\"\" wp_altitude_tick=\">\" end\n   end\n  end\n\n --SMALL ARROW DOWN\n  function small_arrow_down()\n   if screenState==5 then      --(Ship Settings)\n    if MTOW_tick==\">\" then MTOW_tick=\"\" autobrake_tick=\">\"\n    elseif autobrake_tick==\">\" then autobrake_tick=\"\" wp_dist_tick=\">\"\n    elseif wp_dist_tick==\">\" then wp_dist_tick=\"\" holding_tick=\">\"\n    end\n   elseif screenState==7 then  --(WP Store)\n    if wp_name_tick==\">\" then wp_name_tick=\"\" wp_lat_tick=\">\"\n    elseif wp_lat_tick==\">\" then wp_lat_tick=\"\" wp_lon_tick=\">\"\n    elseif wp_lon_tick==\">\" then wp_lon_tick=\"\" wp_alt_tick=\">\"\n    end\n   elseif screenState==8 then  --(WP Sync)\n    if shipid_tick==\">\" then shipid_tick=\"\" dwn_sync_tick=\">\"\n    elseif dwn_sync_tick==\">\" then dwn_sync_tick=\"\" up_sync_tick=\">\"\n    end\n   elseif screenState==10 then --(Screen Colors)\n    if tick_color_1==\">\" then tick_color_1=\"\" tick_color_2=\">\"\n    elseif tick_color_2==\">\" then tick_color_2=\"\" tick_color_3=\">\"\n    elseif tick_color_3==\">\" then tick_color_3=\"\" tick_color_4=\">\"\n    elseif tick_color_4==\">\" then tick_color_4=\"\" tick_color_5=\">\"\n    end\n   elseif screenState==11 then --(DMG Rep.)\n    if tick_dmg_1==\">\" then tick_dmg_1=\"\" tick_dmg_2=\">\" end\n   elseif screenState==12 then --(DB Reset)\n    if tick_[1]==\">\" then tick_[1]=\"\" tick_[2]=\">\"\n    elseif tick_[2]==\">\" then tick_[2]=\"\" tick_[3]=\">\"\n    elseif tick_[3]==\">\" then tick_[3]=\"\" tick_[4]=\">\"\n    elseif tick_[4]==\">\" then tick_[4]=\"\" tick_[5]=\">\"\n    end\n   elseif screenState==14 then --(Routes)\n    if route_tick_[route_tick_n]~=\"*\" then\n     route_tick_n=route_tick_n +1\n     if route_tick_n>(route_tick_index +4) then route_tick_n=(route_tick_index +4) end\n     route_tick_[route_tick_n-1]=\"\"\n     route_tick_[route_tick_n]=\">\"\n    else\n     wp_tick_n=wp_tick_n +1\n     if wp_tick_n>(wp_tick_index +4) then wp_tick_n=(wp_tick_index +4) end\n     wp_tick_[wp_tick_n -1]=\"\"\n     wp_tick_[wp_tick_n]=\">\"\n     WpTickList=json.encode(wp_tick_)\n    end\n    RouteTickList=json.encode(route_tick_)\n   elseif screenState==16 then --(WP Setting)\n    if wp_altitude_tick==\">\" then wp_altitude_tick=\"\" wp_speed_tick=\">\" end\n   end\n  end\n\n --ENT BUTTON\n  function ent_button()\n   --ENT Time Calculator\n    if screenState==1 then\n     if (su_distance_inserted==true and (keypad_input_speed~=[[\"\"]] or keypad_input_speed==[[\"\"]] or tonumber(keypad_input_speed)>0)) then\n      local su_num=tonumber(keypad_input_su)\n      local speed_num=tonumber(keypad_input_speed)\n      if (keypad_input_speed==[[\"\"]] or speed_num >=30000) then\n       if math.floor((vec3(core.getVelocity()):len())*3.6)==0 then\n        keypad_input_speed=0\n        databank.setFloatValue(\"navigator_speed\", 0)\n        speed_num=0\n        databank.setFloatValue(\"navigator_eta_h\", 0)\n        databank.setFloatValue(\"navigator_eta_m\", 0)\n        databank.setFloatValue(\"navigator_eta_s\", 0)\n        speed_inserted=false\n       else\n        keypad_input_speed=tostring(math.floor((vec3(core.getVelocity()):len())*3.6))\n        speed_num=math.floor((vec3(core.getVelocity()):len())*3.6)\n        databank.setFloatValue(\"navigator_speed\", speed_num)\n        speed_inserted=true\n       end\n      else\n       speed_num=tonumber(keypad_input_speed)\n       databank.setFloatValue(\"navigator_speed\", speed_num)\n      end\n      if speed_num==0 then\n       time_to_go=[[\"Speed Is Invalid\"]]\n       databank.setFloatValue(\"navigator_eta_h\", 0)\n       databank.setFloatValue(\"navigator_eta_m\", 0)\n       databank.setFloatValue(\"navigator_eta_s\", 0)\n       speed_inserted=false\n      else\n       local time_min=(su_num*200/speed_num*60)\n       local time_h  =(time_min/60)\n       local time_m  =(time_h - math.floor(time_h))*60\n       local time_s  =(time_m - math.floor(time_m))*60\n       time_to_go=math.floor(time_h) ..[[ ..\" h \"..]].. math.floor(time_m) ..[[ ..\" m \"..]].. math.floor(time_s) ..[[ ..\" s\"]]\n       databank.setFloatValue(\"navigator_eta_h\", math.floor(time_h))\n       databank.setFloatValue(\"navigator_eta_m\", math.floor(time_m))\n       databank.setFloatValue(\"navigator_eta_s\", math.floor(time_s))\n       speed_inserted=true\n      end\n     elseif (su_distance_inserted==false and keypad_input_su==[[\"\"]] and keypad_input_speed==[[\"\"]]) then\n      databank.setFloatValue(\"navigator_distance\", \"n/a\")\n     elseif (su_distance_inserted==false and keypad_input_su~=[[\"\"]] and keypad_input_speed==[[\"\"]]) then\n      databank.setFloatValue(\"navigator_distance\", keypad_input_su)\n      su_distance_inserted=true\n      su_tick=\"\"\n      speed_tick=\">\"\n     end\n    end\n\n   --ENT From\n    if screenState==2 then\n     if (from_inserted==false and keypad_input_from==\"\") then\n      local myPos=vec3(core.getConstructWorldPos())\n      keypad_input_from=\"PPOS\"\n      databank.setStringValue(\"navigator_from\", \"PPOS\")\n      databank.setStringValue(\"from\", \"PPOS\")\n      from_coordinates=tostring(myPos)\n      databank.setStringValue(\"navigator_from_coordinates\", tostring(myPos))\n      from_inserted=true\n      status_FM=\"FM\"\n      FROM_tick=\"\"\n      WPADD_tick=\">\"   \n     elseif (from_inserted==false and keypad_input_from~=\"\") then\n      from_coordinates_check=false\n      for i, v in pairs(atlas[0]) do\n       if atlas[0][i].name[1]==keypad_input_from then\n        databank.setStringValue(\"navigator_from\", atlas[0][i].name[1])\n        databank.setFloatValue(\"navigator_from_planet_radius\", atlas[0][i].radius)\n        databank.setStringValue(\"from\", keypad_input_from)\n        from_inserted=true\n        status_FM=\"FM\"\n        from_coordinates=vec3(atlas[0][i].center)\n        databank.setStringValue(\"navigator_from_coordinates\", tostring(from_coordinates))\n        from_coordinates_check=true\n        break\n       elseif databank.hasKey(keypad_input_from)==1 then\n        local wp_check=keypad_input_from\n        for x=1, #wp_list do \n         if wp_list[x].id==wp_check then\n          local wp_id=wp_list[x].wp\n          wp_id_rename=wp_id\n          keypad_input_from=databank.getStringValue(wp_id)\n          keypad_input_from_coord=wp_id ..\"_coord\"\n          databank.setStringValue(\"navigator_from\", keypad_input_from)\n          databank.setStringValue(\"from\", keypad_input_from)\n          databank.setFloatValue(\"navigator_from_planet_radius\", 1)\n          from_inserted=true\n          status_FM=\"FM\"\n          from_coordinates=vec3FromStr(databank.getStringValue(keypad_input_from_coord))\n          databank.setStringValue(\"navigator_from_coordinates\", tostring(from_coordinates))\n          from_coordinates_check=true\n          FROM_tick=\"\"\n          WPADD_tick=\">\"   \n          break\n         end\n        end\n       elseif from_coordinates_check==false then\n        databank.setStringValue(\"navigator_from\", \"no From\")\n        from_inserted=false\n        status_FM=\"\"\n        from_coordinates=\"Not Present In Databank\"\n        databank.setStringValue(\"navigator_from_coordinates\", \"n/a\")\n        FROM_tick=\">\"\n        WPADD_tick=\"\"\n       end\n      end\n     end\n    end\n\n   --ENT Destination\n    if (screenState==3 or screenState==15) then\n     if (destination_inserted==false and keypad_input_dest~=\"\") then\n      destination_check=false\n      for i, v in pairs(atlas[0]) do\n       if atlas[0][i].name[1]==keypad_input_dest then\n        databank.setStringValue(\"navigator_target_destination\", atlas[0][i].name[1])\n        databank.setStringValue(\"to\", keypad_input_dest)\n        databank.setFloatValue(\"navigator_target_planet_radius\", atlas[0][i].radius)\n        destination_inserted=true\n        status_TO=\"TO\"\n        local myPos=vec3(core.getConstructWorldPos())\n        destination_coord=vec3(atlas[0][i].center)\n        databank.setStringValue(\"navigator_coordinates\", tostring(destination_coord))\n        set_coordinates(atlas[0][i])\n        distance_to_go=math.floor(((vec3(atlas[0][i].center) - myPos):len())/1000/200*100)/100\n        distance_to_go_warp=distance_to_go\n        databank.setFloatValue(\"navigator_distance\", distance_to_go)\n        databank.setFloatValue(\"navigator_eta_h\", 0)\n        databank.setFloatValue(\"navigator_eta_m\", 0)\n        databank.setFloatValue(\"navigator_eta_s\", 0)\n        destination_check=true\n        break\n       elseif databank.hasKey(keypad_input_dest)==1 then\n        local wp_check=keypad_input_dest\n        for x=1, #wp_list do \n         if wp_list[x].id==wp_check then\n          local wp_id=wp_list[x].wp\n          keypad_input_dest=databank.getStringValue(wp_id)\n          keypad_input_dest_coord=wp_id ..\"_coord\"\n          databank.setStringValue(\"navigator_target_destination\", keypad_input_dest)\n          databank.setStringValue(\"to\", keypad_input_dest)\n          databank.setFloatValue(\"navigator_target_planet_radius\", 1)\n          destination_inserted=true\n          status_TO=\"TO\"\n          local myPos=vec3(core.getConstructWorldPos())\n          destination_coord=vec3FromStr(databank.getStringValue(keypad_input_dest_coord))\n          databank.setStringValue(\"navigator_coordinates\", tostring(destination_coord))\n          set_wp_coordinates(databank.getStringValue(keypad_input_dest_coord))\n          distance_to_go=math.floor(((destination_coord - myPos):len())/1000/200*100)/100\n          distance_to_go_warp=distance_to_go\n          databank.setFloatValue(\"navigator_distance\", distance_to_go)\n          databank.setFloatValue(\"navigator_eta_h\", 0)\n          databank.setFloatValue(\"navigator_eta_m\", 0)\n          databank.setFloatValue(\"navigator_eta_s\", 0)\n          destination_check=true\n          break\n         else\n          databank.setStringValue(\"navigator_target_destination\", \"no Dest.\")\n          destination_inserted=false\n          status_TO=\"\"\n          destination_coord=\"Not Present In Databank\"\n          databank.setStringValue(\"navigator_coordinates\", \"n/a\")\n         end\n        end\n       elseif (destination_check==false) then\n        databank.setStringValue(\"navigator_target_destination\", \"no Dest.\")\n        destination_inserted=false\n        status_TO=\"\"\n        destination_coord=\"Not Present In Databank\"\n        databank.setStringValue(\"navigator_coordinates\", \"n/a\")\n       end\n      end\n     elseif (routing_timer and screenState==15) then\n      for i=1, #WpRouteList do\n       if string.find(WpRouteList[i], \"To \") then UserSelectedWp=\"WpID \"..i end\n      end\n     end\n    end\n\n   --ENT Target Pe Altitude\n    if screenState==4 then\n     local Destination=\"\"\n     local MinimumABSAltitude=10000\n     local MinimumAltitude=0\n     local SelectabledAltitude=0\n     if (keypad_input_dest==nil or keypad_input_dest==\"\") then Destination=core.getCurrentPlanetId()\n     else Destination=keypad_input_dest end\n     if (tonumber(Destination)~=nil and Destination~=0) then MinimumAltitude=atlas[0][Destination].atmosphereThickness\n     elseif Destination==0 then MinimumAltitude=10000\n     else\n      for i, v in pairs(atlas[0]) do\n       if atlas[0][i].name[1]==Destination then MinimumAltitude=atlas[0][i].atmosphereThickness break end\n      end\n     end\n\n     if (target_pe_altitude_inserted==false and keypad_input_pe_target_alt~=\"\") then\n      if tonumber(keypad_input_pe_target_alt)==nil then\n       target_alt_warning=\"Invalid Input\"\n       target_pe_altitude_inserted=true\n       status_TA=\"TA\"\n      elseif (tonumber(keypad_input_pe_target_alt)<MinimumABSAltitude and MinimumABSAltitude>=MinimumAltitude) then\n       target_alt_warning=\"Warning Altitude below 10.000 m\"\n       target_pe_altitude_inserted=true\n       status_TA=\"TA\"\n      elseif (tonumber(keypad_input_pe_target_alt)<MinimumAltitude) then\n       target_alt_warning=\"Warning Destination Atmosphere Altitude is \"..MinimumAltitude\n       target_pe_altitude_inserted=true\n       status_TA=\"TA\"\n      elseif (tonumber(keypad_input_pe_target_alt)>=MinimumABSAltitude and tonumber(keypad_input_pe_target_alt)>=MinimumAltitude) then\n       databank.setFloatValue(\"navigator_pe_target_altitude\", tonumber(keypad_input_pe_target_alt))\n       target_pe_altitude_inserted=true\n       status_TA=\"TA\"\n       stored_pe_target_alt=keypad_input_pe_target_alt\n       databank.setFloatValue(\"PE_altitude\", math.floor(stored_pe_target_alt))\n      elseif target_alt_warning==\"Invalid Input\" then\n       target_alt_warning=\"Invalid Input\"\n       target_pe_altitude_inserted=true\n       status_TA=\"TA\"\n      end\n     else\n      target_alt_warning=\"Invalid Input\"\n      target_pe_altitude_inserted=true\n      status_TA=\"TA\"\n     end\n    end\n\n   --ENT Settings\n    if screenState==9 then        --(Settings Menu)\n     local x=ScreenSelection\n     if x==\"Ship Settings\" then     --SELECT Ship Settings\n      screenState=5\n      MTOW_tick=\">\"\n      autobrake_tick=\"\"\n      wp_dist_tick=\"\"\n      holding_tick=\"\"\n     elseif x==\"WP Store\" then      --SELECT WP Store\n      screenState=7\n      wp_name_tick=\">\"   \n      wp_lat_tick=\"\"\n      wp_lon_tick=\"\"\n      wp_alt_tick=\"\"\n      wp_selected_planet=\"\"\n      keypad_input_wp_name=\"\"\n      keypad_input_wp_lat=\"\"\n      keypad_input_wp_lon=\"\"\n      keypad_input_wp_alt=\"\"\n     elseif x==\"WP Sync\" then       --SELECT WP Sync\n      screenState=8\n      dwn_sync_tick=\">\"   \n      up_sync_tick=\"\"\n      sync_result=\"\"\n      receiving_wp=0\n      wp_synced=0\n      index_sync=1\n      prog_bar=0\n      keypad_input_shipid=databank.getStringValue(\"Ship ID\")\n      shipid_tick=\"\"\n     elseif x==\"Screen Colors\" then --SELECT Screen Colors\n      screenState=10\n      tick_color_1=\">\"   \n      tick_color_2=\"\"\n      tick_color_3=\"\"\n      tick_color_4=\"\"\n      tick_color_5=\"\"\n      local TableColor=databank.getStringValue(\"SCRTableColor\")\n      TableColor=json.decode(TableColor)\n      keypad_input_color1=TableColor[1] ..\",\".. TableColor[2] ..\",\".. TableColor[3]\n      local FontTitle=databank.getStringValue(\"SCRFontTitle\")\n      FontTitle=json.decode(FontTitle)\n      keypad_input_color2=FontTitle[1] ..\",\".. FontTitle[2] ..\",\".. FontTitle[3]\n      local FontColor=databank.getStringValue(\"SCRFontColor\")\n      FontColor=json.decode(FontColor)\n      keypad_input_color3=FontColor[1] ..\",\".. FontColor[2] ..\",\".. FontColor[3]\n      local ButtonPressed=databank.getStringValue(\"SCRButtonPressed\")\n      ButtonPressed=json.decode(ButtonPressed)\n      keypad_input_color4=ButtonPressed[1] ..\",\".. ButtonPressed[2] ..\",\".. ButtonPressed[3]\n      local ButtonColor=databank.getStringValue(\"SCRButtonColor\")\n      ButtonColor=json.decode(ButtonColor)\n      keypad_input_color5=ButtonColor[1] ..\",\".. ButtonColor[2] ..\",\".. ButtonColor[3]\n      RGBColor1, RGBColor2, RGBColor3, RGBColor4, RGBColor5=true, true, true, true, true\n     elseif x==\"DMG Report\" then    --SELECT DMG Rep.\n      screenState=11  \n      tick_dmg_1=\">\"\n      tick_dmg_2=\"\"\n      keypad_input_dmg1=databank.getFloatValue(\"DMG Scale\")\n      DMG_REP_TOP_VIEW_Up_Down=databank.getFloatValue(\"DMG TV U/D\")\n      DMG_REP_TOP_VIEW_LH_RH=databank.getFloatValue(\"DMG TV L/R\")\n      DMG_REP_SIDE_VIEW_Up_Down=databank.getFloatValue(\"DMG SV U/D\")\n      DMG_REP_SIDE_VIEW_LH_RH=databank.getFloatValue(\"DMG SV L/R\")\n      keypad_input_dmg2=1\n      dmg_factor=keypad_input_dmg2\n     elseif x==\"DB Reset\" then      --SELECT DB Reset\n      screenState=12\n      tick_={}\n      tick_[1]=\">\"   \n      tick_[2]=\"\"\n      tick_[3]=\"\"\n      tick_[4]=\"\"\n      tick_[5]=\"\"\n      db_mark_1=\"X\"\n      db_mark_1_TF=true\n      db_mark_2=\"X\"\n      db_mark_2_TF=true\n      db_mark_3=\"X\"\n      db_mark_3_TF=true\n      db_mark_4=\"X\"\n      db_mark_4_TF=true\n      db_mark_5=\"X\"\n      db_mark_5_TF=true\n      reset_db_status=databank.getNbKeys()..\" Keys\"\n      reset_db_status2=\"\"\n      LuaScreen()\n     elseif x==\"Routes\" then        --SELECT Routes\n      screenState=14\n      routes_page_index=1\n      routes_wp_page_index=1\n      route_tick_n=1\n      order_routes_list={}\n      routes_list={}\n      route_tick_={}\n      local x=(routes_page_index*5)-4\n      local y=generating_wp_pages(\"14routes\")\n      for i=1, y do route_tick_[i]=\"\" end\n      route_tick_[x]=\">\"\n      RouteTickList=json.encode(route_tick_)\n      wp_tick_={}\n      WpTickList=json.encode(wp_tick_)\n     end\n    elseif screenState==5 then    --(Ship Settings)\n     if MTOW_tick==\">\" then\n      if (keypad_input_MTOW==\"\") then\n       keypad_input_MTOW=factory_MTOW/1000\n       new_MTOW=keypad_input_MTOW\n       MTOW_inserted=true\n       databank.setFloatValue(\"navigator_MTOW\", new_MTOW*1000)\n      else\n       new_MTOW=tonumber(keypad_input_MTOW)\n       MTOW_inserted=true\n       databank.setFloatValue(\"navigator_MTOW\", new_MTOW*1000)\n      end\n     elseif autobrake_tick==\">\" then\n      if keypad_input_autobrake==\"\" then\n       keypad_input_autobrake=factory_autobrake\n       autobrake_stops_at_inserted=true\n       databank.setFloatValue(\"navigator_autobrake\", keypad_input_autobrake)\n      else\n       keypad_input_autobrake=tonumber(keypad_input_autobrake)\n       autobrake_stops_at_inserted=true\n       databank.setFloatValue(\"navigator_autobrake\", keypad_input_autobrake)\n      end\n     elseif wp_dist_tick==\">\" then\n      if keypad_input_wpdist==\"\" then\n       keypad_input_wpdist=wp_sequencing_distance\n       wp_dist_inserted=true\n       databank.setFloatValue(\"navigator_wpdist\", keypad_input_wpdist)\n      else\n       keypad_input_wpdist=tonumber(keypad_input_wpdist)\n       wp_sequencing_distance=keypad_input_wpdist\n       wp_dist_inserted=true\n       databank.setFloatValue(\"navigator_wpdist\", keypad_input_wpdist)\n      end\n     elseif holding_tick==\">\" then\n      if keypad_input_holding==\"\" then\n       keypad_input_holding=databank.getIntValue(\"holding_speed\")\n       holding_speed=keypad_input_holding\n       holding_speed_inserted=true\n      else\n       keypad_input_holding=tonumber(keypad_input_holding)\n       holding_speed=keypad_input_holding\n       holding_speed_inserted=true\n       databank.setIntValue(\"holding_speed\", holding_speed)\n      end\n     end\n    elseif screenState==8 then    --(WP Sync)\n     msg_counter=0\n     if (shipid_tick==\">\" and keypad_input_shipid~=\"\") then\n      ship_id=keypad_input_shipid\n      databank.setStringValue(\"Ship ID\", ship_id)\n      ShipIdCheck=true\n     end\n     if (dwn_sync_tick==\">\" and keys_number>0 and up_sync_tick==\"\" and emitter) then\n      emitter.send(\"AviatorHUD\", \"<SendDataToBase>\"..ship_id)\n      sync_result=\"Downlink Requested\"\n      delay_timer=5\n      delay_id=\"ShipIDResponse\"\n      unit.setTimer(\"delay\", 1)\n     elseif (keys_number==0) then\n      prog_bar=0\n      sync_result=\"No Data To Sync\"\n     end\n     if (up_sync_tick==\">\" ) then ship_id=databank.getStringValue(\"Ship ID\")\n      if (ship_id~=\"\" and ship_id~=\"No ID\" and emitter) then\n       emitter.send(\"AviatorHUD\", \"<SendShipID>\"..ship_id)\n       sync_result=\"Ship ID Sent\"\n       delay_timer=5\n       delay_id=\"ShipIDResponse\"\n       unit.setTimer(\"delay\", 1)\n      else\n        if emitter then sync_result=\"No Ship ID\" else sync_result=\"No Emitter/Receiver\" end\n      end\n     end\n    elseif screenState==10 then   --(Screen Colors)\n     if tick_color_1==\">\" then\n      if (keypad_input_color1:find(\"%a\")~=nil or keypad_input_color1:find(\"(%d+),(%d+),(%d+)\")==nil) then\n       keypad_input_color1=\"Insert RGB\"\n      elseif keypad_input_color1~=\"\" then\n       Table_RGB=\"{\".. keypad_input_color1 ..\"}\"\n       databank.setStringValue(\"SCRTableColor\", Table_RGB)\n       local TableColor=json.decode(Table_RGB)\n       Table_R=ColorConvert(TableColor[1])\n       Table_G=ColorConvert(TableColor[2])\n       Table_B=ColorConvert(TableColor[3])\n       RGBColor1=true\n      end\n     elseif tick_color_2==\">\" then\n      if (keypad_input_color2:find(\"%a\")~=nil or keypad_input_color2:find(\"(%d+),(%d+),(%d+)\")==nil) then\n       keypad_input_color2=\"Insert RGB\"\n      elseif keypad_input_color2~=\"\" then\n       Title_RGB=\"{\".. keypad_input_color2 ..\"}\"\n       databank.setStringValue(\"SCRFontTitle\", Title_RGB)\n       local FontTitle=json.decode(Title_RGB)\n       Title_R=ColorConvert(FontTitle[1])\n       Title_G=ColorConvert(FontTitle[2])\n       Title_B=ColorConvert(FontTitle[3])\n       RGBColor2=true\n      end\n     elseif tick_color_3==\">\" then\n      if (keypad_input_color3:find(\"%a\")~=nil or keypad_input_color3:find(\"(%d+),(%d+),(%d+)\")==nil) then\n       keypad_input_color3=\"Insert RGB\"\n      elseif keypad_input_color3~=\"\" then\n       Font_RGB=\"{\".. keypad_input_color3 ..\"}\"\n       databank.setStringValue(\"SCRFontColor\", Font_RGB)\n       local FontColor=json.decode(Font_RGB)\n       Font_R=ColorConvert(FontColor[1])\n       Font_G=ColorConvert(FontColor[2])\n       Font_B=ColorConvert(FontColor[3])\n       RGBColor3=true\n      end\n     elseif tick_color_4==\">\" then\n      if (keypad_input_color4:find(\"%a\")~=nil or keypad_input_color4:find(\"(%d+),(%d+),(%d+)\")==nil) then\n       keypad_input_color4=\"Insert RGB\"\n      elseif keypad_input_color4~=\"\" then\n       Button_Pressed_RGB=\"{\".. keypad_input_color4 ..\"}\"\n       databank.setStringValue(\"SCRButtonPressed\", Button_Pressed_RGB)\n       local ButtonPressed=json.decode(Button_Pressed_RGB)\n       Button_Pressed_R=ColorConvert(ButtonPressed[1])\n       Button_Pressed_G=ColorConvert(ButtonPressed[2])\n       Button_Pressed_B=ColorConvert(ButtonPressed[3])\n       RGBColor4=true\n      end\n     elseif tick_color_5==\">\" then\n      if (keypad_input_color5:find(\"%a\")~=nil or keypad_input_color5:find(\"(%d+),(%d+),(%d+)\")==nil) then\n       keypad_input_color5=\"Insert RGB\"\n      elseif keypad_input_color5~=\"\" then\n       Button_RGB=\"{\".. keypad_input_color5 ..\"}\"\n       databank.setStringValue(\"SCRButtonColor\", Button_RGB)\n       local ButtonColor=json.decode(Button_RGB)\n       Button_R=ColorConvert(ButtonColor[1])\n       Button_G=ColorConvert(ButtonColor[2])\n       Button_B=ColorConvert(ButtonColor[3])\n       RGBColor5=true\n      end\n     end\n    elseif screenState==12 then   --(DB reset)\n     if tick_[1]==\">\" then\n      if db_mark_1==\"X\" then db_mark_1=\"\" db_mark_1_TF=false\n      else db_mark_1=\"X\" db_mark_1_TF=true end\n     elseif tick_[2]==\">\" then\n      if db_mark_2==\"X\" then db_mark_2=\"\" db_mark_2_TF=false\n      else db_mark_2=\"X\" db_mark_2_TF=true end\n     elseif tick_[3]==\">\" then\n      if db_mark_3==\"X\" then db_mark_3=\"\" db_mark_3_TF=false\n      else db_mark_3=\"X\" db_mark_3_TF=true end\n     elseif tick_[4]==\">\" then\n      if db_mark_4==\"X\" then db_mark_4=\"\" db_mark_4_TF=false\n      else db_mark_4=\"X\" db_mark_4_TF=true end\n     elseif tick_[5]==\">\" then\n      if db_mark_5==\"X\" then db_mark_5=\"\" db_mark_5_TF=false\n      else db_mark_5=\"X\" db_mark_5_TF=true end\n     end\n    elseif screenState==14 then   --(Routes)\n     for i=0, #routes_list do\n      if route_tick_[i]==\">\" then\n       local route_id=routes_list[i]\n       if (route_id~=nil and route_id~=\"\") then\n        route_tick_[i]=\"*\"\n        RouteTickList=json.encode(route_tick_)\n        route_id=routes_list[i].id\n        route_id_selected=route_id\n        local data=databank.getStringValue(route_id):gsub(\"@@@\",\"\\\"\")\n        data=json.decode(data)\n        wp_tick_={}\n        local counter=0\n        for i,v in pairs(data) do\n         counter=counter +1\n         wp_tick_[counter]=\"\"\n        end\n        wp_tick_[1]=\">\"\n        WpTickList=json.encode(wp_tick_)\n        wp_tick_n=1\n       end\n       break\n      end\n     end\n    elseif screenState==16 then   --(WP Setting)\n     if wp_altitude_tick==\">\" then\n      if (tonumber(keypad_input_wp_altitude)~=nil) then\n       wp_altitude_inserted=true\n      end\n     elseif wp_speed_tick==\">\" then\n      if (tonumber(keypad_input_wp_speed)~=nil) then\n       wp_speed_inserted=true\n      end\n     end\n\n     local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n     ext=json.decode(ext)\n     ext[edit_wp]={[\"alt\"]=keypad_input_wp_altitude,[\"s\"]=keypad_input_wp_speed}\n     ext=json.encode(ext)\n     databank.setStringValue(\"wp_settings\", ext:gsub(\"\\\"\",\"@@@\"))\n    end\n\n   --ENT ROUTING\n    if (screenState==15 and ScreenSelection~=\"\") then UserSelectedWp=ScreenSelection end\n\n   --ENT AGG\n    if screenState==13 then\n     if ScreenSelection==\"ENGAGE\" then\n      local status=databank.getStringValue(\"nav agg\")\n      if status==\"STBY\" then databank.setStringValue(\"nav agg\", \"ENG\") end\n     elseif (ScreenSelection==\"OFF\" or ScreenSelection==\"STBY\") then\n      local status=databank.getStringValue(\"nav agg\")\n      if (status==\"OFF\" or status==\"ENG\") then databank.setStringValue(\"nav agg\", \"STBY\")\n      elseif status==\"STBY\" then databank.setStringValue(\"nav agg\", \"OFF\") end\n     elseif (agg_tick_input==\">\" and agg_target_altitude==false and keypad_input_agg_target_alt~=\"\") then\n      if tonumber(keypad_input_agg_target_alt)<1000 then keypad_input_agg_target_alt=1000 end\n      databank.setIntValue(\"agg_t_alt\", keypad_input_agg_target_alt)\n      if antigrav then antigrav.setBaseAltitude(keypad_input_agg_target_alt) end\n      agg_target_altitude=true\n     end\n    end\n\n  end\n\n --CLR BUTTON\n  function clr_button()\n   --CLR Time Calculator\n    if screenState==1 then\n     if (su_distance_inserted==true and keypad_input_su~=[[\"\"]] and keypad_input_speed~=[[\"\"]]) then\n      keypad_input_speed=nil\n      databank.setFloatValue(\"navigator_speed\", \"0\")\n      speed_inserted=false\n      time_to_go=[[\"\"]]\n      databank.setFloatValue(\"navigator_eta_h\", 0)\n      databank.setFloatValue(\"navigator_eta_m\", 0)\n      databank.setFloatValue(\"navigator_eta_s\", 0)\n     elseif ( su_distance_inserted==true and keypad_input_su~=[[\"\"]] and keypad_input_speed==[[\"\"]]) then\n      keypad_input_su=nil\n      databank.setStringValue(\"navigator_distance\", \"n/a\")\n      su_distance_inserted=false\n      speed_inserted=false\n      databank.setStringValue(\"navigator_speed\", \"0\")\n      databank.setFloatValue(\"navigator_eta_h\", 0)\n      databank.setFloatValue(\"navigator_eta_m\", 0)\n      databank.setFloatValue(\"navigator_eta_s\", 0)\n     elseif ( su_distance_inserted==false and keypad_input_su~=[[\"\"]] and keypad_input_speed==[[\"\"]]) then\n      keypad_input_su=nil\n      databank.setStringValue(\"navigator_distance\", \"n/a\")\n      databank.setFloatValue(\"navigator_eta_h\", 0)\n      databank.setFloatValue(\"navigator_eta_m\", 0)\n      databank.setFloatValue(\"navigator_eta_s\", 0)\n     end\n    end\n\n   --CLR From\n    if screenState==2 then\n     if (keypad_input_from~=\"\" or WPADD_tick==\">\"   )then\n      keypad_input_from=nil\n      databank.setStringValue(\"navigator_from\", \"no From\")\n      from_coordinates=\"\"\n      databank.setStringValue(\"navigator_from_coordinates\", \"n/a\")\n      from_inserted=false\n      status_FM=\"\"\n      databank.setFloatValue(\"navigator_from_planet_radius\", 0)\n      wpname_inserted=false\n      FROM_tick=\">\"\n      WPADD_tick=\"\"\n      stored=\"\"\n     end\n    end\n\n   --CLR Distance To Coordinates\n    if (screenState==3 or screenState==15) then\n     if (keypad_input_dest~=\"\") then\n      if routing_timer then unit.stopTimer(\"routing\") end\n      keypad_input_dest=nil\n      databank.setStringValue(\"navigator_target_destination\", \"no Dest.\")\n      destination_inserted=false\n      status_TO=\"\"\n      destination_coord=nil\n      databank.setStringValue(\"navigator_coordinates\", \"n/a\")\n      distance_to_go=\"\"\n      databank.setFloatValue(\"navigator_target_planet_radius\", 0)\n     end\n    end\n\n   --CLR Target Pe Altitude\n    if screenState==4 then\n     if (keypad_input_pe_target_alt~=\"\") then\n      keypad_input_pe_target_alt=nil\n      target_pe_altitude_inserted=false\n      status_TA=\"\"\n      target_alt_warning=\"\"\n     end\n    end\n\n   --CLR Settings\n    if screenState==5 then    --(Ship Settings)\n     if ((MTOW_inserted==true or keypad_input_MTOW~=\"\") and MTOW_tick==\">\") then\n      keypad_input_MTOW=\"\"\n      new_MTOW=factory_MTOW/1000\n      MTOW_inserted=false\n      databank.setFloatValue(\"navigator_MTOW\", factory_MTOW)\n     elseif ((autobrake_stops_at_inserted==true or keypad_input_autobrake~=\"\") and autobrake_tick==\">\") then\n      keypad_input_autobrake=\"\"\n      autobrake_stops_at_inserted=false\n      databank.setFloatValue(\"navigator_autobrake\", factory_autobrake)\n     elseif ((wp_dist_inserted==true or keypad_input_wpdist~=\"\") and wp_dist_tick==\">\") then\n      keypad_input_wpdist=\"\"\n      wp_dist_inserted=false\n      databank.setFloatValue(\"navigator_wpdist\", wp_sequencing_distance)\n     elseif ((holding_speed_inserted==true or keypad_input_holding~=\"\") and holding_tick==\">\") then\n      keypad_input_holding=\"\"\n      holding_speed_inserted=false\n      databank.setIntValue(\"holding_speed\", \"\")\n     end\n    elseif screenState==7 then  --(WP Store)\n     if wp_name_tick==\">\" then keypad_input_wp_name=\"\"\n     elseif wp_lat_tick==\">\" then keypad_input_wp_lat=\"\"\n     elseif wp_lon_tick==\">\" then keypad_input_wp_lon=\"\"\n     elseif wp_alt_tick==\">\" then keypad_input_wp_alt=\"\"\n     end\n    elseif screenState==8 then  --(WP Sync)\n     if shipid_tick==\">\" then\n      keypad_input_shipid=\"\"\n      ship_id=keypad_input_shipid\n      databank.setStringValue(\"Ship ID\", ship_id)\n      ShipIdCheck=false\n     end\n    elseif screenState==10 then --(Screen Colors)\n     if tick_color_1==\">\" then keypad_input_color1=\"\" RGBColor1=false\n     elseif tick_color_2==\">\" then keypad_input_color2=\"\" RGBColor2=false\n     elseif tick_color_3==\">\" then keypad_input_color3=\"\" RGBColor3=false\n     elseif tick_color_4==\">\" then keypad_input_color4=\"\" RGBColor4=false\n     elseif tick_color_5==\">\" then keypad_input_color5=\"\" RGBColor5=false\n     end\n    elseif screenState==12 then --(DB reset)\n     databank_clean(db_mark_1_TF, db_mark_2_TF, db_mark_3_TF, db_mark_4_TF, db_mark_5_TF)\n    elseif screenState==14 then --(Routes)\n     for i=1, #route_tick_ do\n      if route_tick_[i]==\"*\" then\n       route_tick_[i]=\">\"\n       RouteTickList=json.encode(route_tick_)  \n       for x=1, #wp_tick_ do\n        wp_tick_[x]=\"\"\n       end\n       WpTickList=json.encode(wp_tick_)\n       routes_wp_page_index=1\n      end\n     end\n    elseif screenState==16 then --(WP Setting)\n     if wp_altitude_tick==\">\" then\n      keypad_input_wp_altitude=\"\"\n      wp_altitude_inserted=false\n     elseif wp_speed_tick==\">\" then\n      keypad_input_wp_speed=\"\"\n      wp_speed_inserted=false\n     end\n     ent_button()\n    end\n\n   --CLR AGG\n    if screenState==13 then    --(AGG)\n     if keypad_input_agg_target_alt~=\"\" then\n      keypad_input_agg_target_alt=\"\"\n      agg_target_altitude=false\n     end\n    end\n  end\n \n--SCREEN GENERATOR\n --STORED WAYPOINTS        (screenState=0)\n  function stored_waypoints_1()\n   local dbKeys=databank.getNbKeys()\n   local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n   ext=json.decode(ext)\n\n   order_list={}\n   for i=1, dbKeys do\n    local dbkey=\"wp\"..i\n    local value=databank.getStringValue(dbkey)\n    if value~=\"\" then\n     table.insert(order_list, value)\n     table.sort(order_list)\n    end\n   end\n\n   wp_list={}\n   wp_counter=0\n   for i=1, #order_list do\n    local dbkeysort=order_list[i]\n    for x=1, dbKeys do\n     local key=\"wp\"..x\n     local v=databank.getStringValue(key)\n     if dbkeysort==v then\n      wp_counter=wp_counter + 1\n      local id=\"wp\"..wp_counter\n      if ext[v]~=nil then\n       if (ext[v].alt~=\"\" or ext[v].s~=\"\") then s=\"*\" else s=\"\" end\n      else s=\"\" end\n      wp_list[wp_counter]={[\"id\"]=id,[\"wp\"]=key,[\"name\"]=v,[\"settings\"]=s}\n      break\n     end\n    end\n   end\n   wp_pages=generating_wp_pages(0)\n   if wp_page_index==nil then wp_page_index=1 else wp_page_index=wp_page_index end\n\n   local wp_list_index={}\n   local index=wp_page_index*10-9\n   for i=index, index+9 do\n    if wp_list[i]~=nil then table.insert(wp_list_index, wp_list[i]) end\n   end\n   screen.setScriptInput(json.encode(wp_list_index))\n  end\n  if wp_list==nil then stored_waypoints_1() end\n\n --ATLAS LIST              (screenState=6)\n  function atlas_list_page()\n   atlas_list={}\n   atlas_pages=0\n   atlas_counter=0\n   for i, v in pairs(atlas[0]) do\n    atlas_counter=atlas_counter + 1\n    local name=atlas[0][i].name[1]\n    table.insert(atlas_list, name)\n    table.sort(atlas_list)\n   end\n   atlas_pages=math.ceil(atlas_counter/10)\n   atlas_page_index=atlas_page_index\n   \n   screen.setScriptInput(json.encode(atlas_list))\n  end\n\n --SU DISTANCE TIME PAGE   (screenState=1)\n  function su_distance_time()\n\n   if su_distance_inserted==nil then su_distance_inserted=false end\n   if speed_inserted==nil then speed_inserted=false end\n   if distance_to_go~=nil then\n    if distance_to_go~=\"\" then\n    keypad_input_su=distance_to_go\n    databank.setFloatValue(\"navigator_distance\", keypad_input_su)\n    su_distance_inserted=true\n    su_tick=\"\"\n    speed_tick=\">\"\n    end\n   end\n\n   if (tonumber(keypad_input_su)==nil or keypad_input_su==\".\") then\n    keypad_input_su=[[\"\"]]\n    su_tick=\">\"\n    speed_tick=\"\"\n   end\n   if (tonumber(keypad_input_speed)==nil or keypad_input_speed==\".\") then keypad_input_speed=[[\"\"]] end\n   if time_to_go==nil then time_to_go=[[\"\"]] end\n\n   if (keypad_input_su==nil or keypad_input_su==[[\"\"]]) then warp_distance=0\n   else warp_distance=keypad_input_su end\n\n   if tonumber(warp_distance)==nil then warp_distance=0 end\n   MinWpCells=math.floor((core.getConstructMass()/1000) * warp_distance * 0.00025)\n   MaxWpCells=math.floor((new_MTOW) * warp_distance * 0.00025)\n\n  end\n\n --FROM PAGE               (screenState=2)\n  function from()\n   if (databank.getStringValue(\"navigator_from\")~=\"no From\" and databank.getStringValue(\"navigator_from\")~=\"PPOS\") then\n    keypad_input_from=databank.getStringValue(\"from\")\n   end\n\n   if from_inserted==nil then\n    from_inserted=false\n    status_FM=\"\"\n    FROM_tick=\">\"\n    keypad_input_wpname=\"\"\n    wpname_inserted=false\n    WPADD_tick=\"\"\n    stored=\"\"\n   end\n\n   if keypad_input_from==nil then\n    keypad_input_from=\"\"\n    from_coordinates=\"\"\n    from_inserted=false\n    status_FM=\"\"\n    FROM_tick=\">\"\n    keypad_input_wpname=\"\"\n    wpname_inserted=false\n    WPADD_tick=\"\"\n    stored=\"\"\n   end\n\n  end\n\n --DESTINATION PAGE        (screenState=3)\n  function distance_to_wp()\n   if (databank.getStringValue(\"navigator_target_destination\")~=\"no Dest.\") then\n    keypad_input_dest=databank.getStringValue(\"to\")\n    distance_to_go=databank.getFloatValue(\"navigator_distance\")\n    distance_to_go_warp=databank.getFloatValue(\"navigator_distance\")\n   end\n\n   if destination_inserted==nil then\n    destination_inserted=false\n    status_TO=\"\"\n   end\n\n   if keypad_input_dest==nil then\n    keypad_input_dest=\"\"\n    destination_coord=\"\"\n    distance_to_go=\"\"\n    distance_to_go_warp=0\n   else\n    keypad_input_dest=keypad_input_dest\n   end\n\n   MinWpCells=math.floor((core.getConstructMass()/1000) * distance_to_go_warp * 0.00025)\n   MaxWpCells=math.floor((new_MTOW) * distance_to_go_warp * 0.00025)\n\n  end\n\n --TARGET PE ALTITUDE PAGE (screenState=4)\n  function target_pe_altitude()\n   if target_pe_altitude_inserted==nil then\n    target_pe_altitude_inserted=false\n    status_TA=\"\"\n   end\n\n   if (databank.getFloatValue(\"PE_altitude\")~=0) then stored_pe_target_alt=math.floor(databank.getFloatValue(\"PE_altitude\"))\n   else stored_pe_target_alt=factory_PE_target_altitude end\n\n   if keypad_input_pe_target_alt==nil then\n    keypad_input_pe_target_alt=\"\"\n    target_pe_altitude_inserted=false\n    status_TA=\"\"\n   else keypad_input_pe_target_alt=keypad_input_pe_target_alt end\n  end\n\n --AGG                     (screenState=13)\n  function agg()\n\n   if antigrav then agg_base_altitude=antigrav.getBaseAltitude() else agg_base_altitude=databank.getIntValue(\"agg_b_alt\") end\n   if not antigrav then agg_base_altitude=\"PB Not Linked to AGG\" agg_tick_input=\"X\" else agg_tick_input=\">\" end\n\n   agg_eng_stby=databank.getStringValue(\"agg eng/stby\")\n   if (agg_eng_stby==\"\" or agg_eng_stby==\"STBY\") then  AGG_Eng_Dis=\"\" agg_eng_stby=\"RED\"\n   elseif agg_eng_stby==\"ENG\" then AGG_Eng_Dis=\"\" agg_eng_stby=\"GREEN\" end\n\n   agg_off_stby=databank.getStringValue(\"agg off/stby\")\n   if agg_off_stby==\"\" then AGG_Off_Stby=\"STBY\" agg_off_stby=\"OFF\" AGG_Eng_Dis=\"\"\n   elseif agg_off_stby==\"STBY\" then AGG_Off_Stby=\"OFF\" AGG_Eng_Dis=\"ENGAGE\"\n   elseif (agg_off_stby==\"OFF\" or agg_off_stby==\"ACTIVE\") then AGG_Eng_Dis=\"\" AGG_Off_Stby=\"STBY\" end\n\n   if keypad_input_agg_target_alt==nil then\n    keypad_input_agg_target_alt=1000\n    databank.setIntValue(\"agg_t_alt\", 1000)\n    agg_target_altitude=true\n   end\n\n   ship_altitude=math.floor(core.getAltitude())\n   local AntiG=0\n   if antigrav then\n    AntiG=json.decode(antigrav.getData())\n    AntiG=AntiG.antiGPower\n    if (((ship_altitude-agg_base_altitude)*-1<=300) and AntiG>=0.8) then ALTDiffCheck=\"GREEN\" else ALTDiffCheck=\"\" end\n   end\n   if ALTDiffCheck==nil then ALTDiffCheck=\"\" end\n  end\n\n --SHIELD                  (screenState=17)\n  function shieldFunction()\n   if EnergyDistribution==nil then EnergyDistribution=false end\n   local EnergyPool=(shield.getResistancesPool())*100\n   if EnergyDistribution==false then  EneryLeft=(shield.getResistancesRemaining())*100 end\n   local ShieldEnergyPool=string.format(\"%.0f / %.0f\", EneryLeft, EnergyPool)\n\n   local shieldHp=shield.getShieldHitpoints()\n   local shieldMaxHp=shield.getMaxShieldHitpoints()\n   local ShieldPercent=(shieldHp/shieldMaxHp*100)\n   \n   local ShieldStress=shield.getStressRatio()\n   local San=tonumber(string.format(\"%.0f\", (ShieldStress[1]*100)))\n   local Sel=tonumber(string.format(\"%.0f\", (ShieldStress[2]*100)))\n   local Ski=tonumber(string.format(\"%.0f\", (ShieldStress[3]*100)))\n   local Sth=tonumber(string.format(\"%.0f\", (ShieldStress[4]*100)))\n\n   local ResistanceTable=shield.getResistances()\n   local an=tonumber(string.format(\"%.0f\", (ResistanceTable[1]*100)+10))\n   local el=tonumber(string.format(\"%.0f\", (ResistanceTable[2]*100)+10))\n   local ki=tonumber(string.format(\"%.0f\", (ResistanceTable[3]*100)+10))\n   local th=tonumber(string.format(\"%.0f\", (ResistanceTable[4]*100)+10))\n   if (an==10 and el==10 and ki==10 and th==10) then ShieldBaseEnergy=true else ShieldBaseEnergy=false end\n\n   if ScreenSelection~=\"\" then\n    local x=ScreenSelection\n    ScreenSelection=\"\"\n    if (x==\"RAISE\" or x==\"DROP\") then shield.toggle()\n    elseif x==\"VENTING\" then shield.startVenting()\n    elseif x==\"RESET\" then\n     if EnergyDistribution==true then menu(\"Shield\")\n     else\n      Ran, Rel, Rki, Rth=10, 10, 10, 10\n      shield.setResistances(0,0,0,0)--setResistances(antimatter,electromagnetic,kinetic,thermic)\n      ShieldBaseEnergy=true\n     end\n    elseif x==\"A-\" then if Ran>=15 then Ran=Ran-5 EneryLeft=EneryLeft+5 end\n    elseif x==\"A+\" then if EneryLeft>=5 then Ran=Ran+5 EneryLeft=EneryLeft-5 end\n    elseif x==\"E-\" then if Rel>=15 then Rel=Rel-5 EneryLeft=EneryLeft+5 end\n    elseif x==\"E+\" then if EneryLeft>=5 then Rel=Rel+5 EneryLeft=EneryLeft-5 end\n    elseif x==\"K-\" then if Rki>=15 then Rki=Rki-5 EneryLeft=EneryLeft+5 end\n    elseif x==\"K+\" then if EneryLeft>=5 then Rki=Rki+5 EneryLeft=EneryLeft-5 end\n    elseif x==\"T-\" then if Rth>=15 then Rth=Rth-5 EneryLeft=EneryLeft+5 end\n    elseif x==\"T+\" then if EneryLeft>=5 then Rth=Rth+5 EneryLeft=EneryLeft-5 end\n    elseif x==\"SET\" then\n     shield.setResistances((Ran-10)/100,(Rel-10)/100,(Rki-10)/100,(Rth-10)/100)\n     EnergyDistribution=false\n    end\n   end\n   if (Ran~=an or Rel~=el or Rki~=ki or Rth~=th) then EnergyDistribution=true else EnergyDistribution=false end\n  \n   local ShieldOnOff=\"RAISE\"\n   local isActive=shield.getState()\n   if isActive==1 then ShieldOnOff=\"DROP\" end\n\n   local ShieldVENT=\"VENTING\"\n   local ventCool=shield.getVentingCooldown()\n   if ventCool>0 then ShieldVENT=string.format(\"%.0f\", ventCool) end\n\n   local ShieldSET=\"SET\"\n   local ShieldRESET=\"RESET\"\n   local resCool=shield.getResistancesCooldown()\n   if resCool>0 then ShieldSET=string.format(\"%.0f\", resCool) end\n\n   local ShieldStressTable={San,Sel,Ski,Sth}\n   local Buttons={ShieldOnOff,ShieldVENT,ShieldSET,ShieldRESET}\n   local ShieldData={ShieldPercent,ShieldEnergyPool,an,el,ki,th,EnergyDistribution,ShieldBaseEnergy}\n   if EnergyDistribution then ShieldData={ShieldPercent,ShieldEnergyPool,Ran,Rel,Rki,Rth,EnergyDistribution,ShieldBaseEnergy} end\n   screen.setScriptInput(json.encode({Buttons,ShieldData,ShieldStressTable}))\n  end\n\n --PVP INFO\n function PVPInfoFunction()\n  local ScrW=system.getScreenWidth()\n  local ScrH=system.getScreenHeight()\n  local MenuW=ScrW/10\n  local MenuY=ScrH/30\n  local cooldown=math.floor(shield.getVentingCooldown())\n  if cooldown==0 then cooldown=\"\" end\n  HUD_HTML={}\n  HUD_HTML[#HUD_HTML+1]=[[\n   <style>\n   td {border:2px solid rgb(]].. TableColor[1] ..[[,]].. TableColor[2] ..[[,]].. TableColor[3] ..[[);\n    color:rgb(]].. FontColor[1] ..[[,]].. FontColor[2] ..[[,]].. FontColor[3] ..[[);\n    font-family:Arial;\n    font-size:15px;\n    text-align:center;\n    vertical-align:middle;}\n   .Fright {float:right}\n   .Fleft {float:left}\n   .pvp {font-size:12px;}\n   .bkgnd {background:rgba(]].. ButtonColor[1] ..[[,]].. ButtonColor[2] ..[[,]].. ButtonColor[3] ..[[,]].. Alpha1 ..[[)}\n   .Title {color:rgb(]].. FontTitle[1] ..[[,]].. FontTitle[2] ..[[,]].. FontTitle[3] ..[[) !important}\n   </style>\n   <div style=\"position:absolute;top:10px;left:]].. (ScrW/2)-(MenuW/2) ..[[px;\">\n   <table class=\"bkgnd\" width=\"]].. MenuW ..[[px\">\n   <tr height=\"]].. MenuY ..[[px\"><td class=\"Title pvp\" width=\"]].. MenuW ..[[px\">\n   <span class=\"Fleft\">SHIFT+G Start/Stop VENTING</span>\n   <span class=\"Fright\">]].. cooldown ..[[</span>\n   </td></tr>\n   </table></div>]]\n  local HTML=table.concat(HUD_HTML)\n  return HTML\n end\n\n --WP SETTINGS             (screenState=16)\n  function wp_settings()\n\n   if tonumber(keypad_input_wp_altitude)==nil then\n   keypad_input_wp_altitude=\"\"\n   end\n\n   if tonumber(keypad_input_wp_speed)==nil then\n   keypad_input_wp_speed=\"\"\n   end\n\n  end\n\n --ROUTING                 (screenState=15)\n  function route_page()\n\n   local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n   ext=json.decode(ext)\n   WpSettingsList=ext\n   databank.setIntValue(\"Holding\", 0)\n\n   FullWpList=databank.getStringValue(selected_route_id):gsub(\"@@@\",\"\\\"\")\n   FullWpList=json.decode(FullWpList)\n      \n   local counter=0\n   for i, v in pairs(FullWpList) do\n    if (i~=\"name\" and v~=\"\") then counter=counter +1 end\n   end\n   selected_route_page_index=selected_route_page_index\n   selected_route_pages=math.ceil((counter+1)/5)\n   wp_tick_index=(selected_route_page_index*5)-4\n  \n   WpRouteList={}\n   local WpSettingList_temp={}\n   for i=wp_tick_index, (wp_tick_index +4) do\n    local wp=\"wp\"..i\n    if (FullWpList[wp]~=nil) then\n     local WpName=FullWpList[wp]\n     WpRouteList[i]=WpName\n     if WpSettingsList[WpName] then WpSettingList_temp[WpName]=WpSettingsList[WpName] end\n    else WpRouteList[i]=\"\" end\n   end\n   WpSettingsList=WpSettingList_temp\n\n   DistanceList={}\n   WPCoordinates={}\n   local myPos=vec3(core.getConstructWorldPos())\n   local distance=\"\"   \n   local vec3_coord=\"\"\n   for i=wp_tick_index, (wp_tick_index +4) do\n    local wp=WpRouteList[i]\n    for x=1, #wp_list do\n     local wp_id=\"wp\"..x\n     local wpMatch=databank.getStringValue(wp_id)\n     if wpMatch==wp then\n      local wp_coord=databank.getStringValue(wp_id..\"_coord\")\n      vec3_coord=vec3FromStr(wp_coord)\n      WPCoordinates[i]=vec3_coord\n      distance=math.floor(((vec3(vec3_coord) - myPos):len())/1000*100)/100\n      if distance>200 then DistanceList[i]=math.floor((distance/200)*100)/100 ..\" Su\"\n      else DistanceList[i]=distance ..\" Km\" end\n      break\n     elseif (wp==\"HOLD\" or wp==\"hold\") then DistanceList[i]=\"Holding\"\n     elseif wp==\"\" then DistanceList[i]=\"\"\n     else DistanceList[i]=\"Wrong Wp Name\" end\n    end\n   end\n\n   local function NextWp(x)\n    menu_destination(x)\n   end\n\n   if UserSelectedWp==nil then UserSelectedWp=\"\" end\n\n   if not first_wp_selected then\n    if selected_route_page_index>1 then\n     selected_route_page_index=1\n     LuaScreen()\n    else\n     local WpN=1\n     DistToNextWp=1\n     if WpRouteList[WpN] then\n      ToWp=WpRouteList[WpN]\n      NextWp(ToWp)\n      WpRouteList[WpN]=\"To \"..ToWp\n      FullWpList[WpN]=\"To \"..ToWp\n      first_wp_selected=true\n      if DistanceList[WpN]~=\"Wrong Wp Name\" then unit.setTimer(\"routing\", 1) end\n     end\n    end\n   elseif (first_wp_selected and next_wp_selected) then\n    DistToNextWp=DistToNextWp+1\n    if DistToNextWp>(wp_tick_index +4) then\n     DistToNextWp=DistToNextWp-1\n     big_arrow_down()\n     LuaScreen()\n    elseif WpRouteList[DistToNextWp] then\n     ToWp=WpRouteList[DistToNextWp]\n     if WpRouteList[DistToNextWp]~=\"\" then\n      NextWp(ToWp)\n      WpRouteList[DistToNextWp]=\"To \"..ToWp\n      FullWpList[DistToNextWp]=\"To \"..ToWp\n     end\n     if DistanceList[ToWp]~=\"Wrong Wp Name\" then unit.setTimer(\"routing\", 1) end\n    end\n    next_wp_selected=false\n   elseif string.find(UserSelectedWp, \"WpID\") then\n    local WpID=UserSelectedWp:gsub(\"WpID \", \"\")\n    WpID=tonumber(WpID)\n    ToWp=WpRouteList[WpID]\n    if ToWp~=nil then\n     DistToNextWp=WpID\n     NextWp(ToWp)\n     WpRouteList[WpID]=\"To \"..ToWp\n     FullWpList[WpID]=\"To \"..ToWp\n     next_wp_selected=false\n     UserSelectedWp=\"\"\n     if DistanceList[ToWp]~=\"Wrong Wp Name\" then unit.setTimer(\"routing\", 1) end\n    end\n   end\n\n   screen.setScriptInput(json.encode({WpSettingsList,WpRouteList,DistanceList}))\n  end\n\n --SETTINGS MENU           (screenState=9)\n  --SETTINGS PAGE 1        (Ship Settings)(screenState=5)\n   function settings1()\n\n    if (tonumber(keypad_input_MTOW)==nil or keypad_input_MTOW==\".\") then\n     keypad_input_MTOW=factory_MTOW/1000\n     new_MTOW=factory_MTOW/1000\n     MTOW_inserted=true\n    end\n\n    if (tonumber(keypad_input_autobrake)==nil or keypad_input_autobrake==\".\") then\n     keypad_input_autobrake=factory_autobrake\n     autobrake_stops_at_inserted=true\n    end\n\n    if (tonumber(keypad_input_wpdist)==nil or keypad_input_wpdist==\".\") then\n     keypad_input_wpdist=wp_sequencing_distance\n     wp_dist_inserted=true\n    end\n\n    if (tonumber(keypad_input_holding)==nil or keypad_input_holding==\".\") then\n     keypad_input_holding=holding_speed\n     holding_speed_inserted=true\n    end\n\n   end\n\n  --SETTINGS PAGE 2        (WP Store)(screenState=7)\n   function settings2()\n\n    if databank.getStringValue(\"to\")~=nil then\n     for i, v in pairs(atlas[0]) do\n      if atlas[0][i].name[1]==keypad_input_dest then wp_selected_planet=databank.getStringValue(\"to\") end\n     end\n    else wp_selected_planet=\"\" end\n\n    if (wp_selected_planet==nil or wp_selected_planet==\"\" or wp_selected_planet==\"Insert Destination\") then\n     wp_selected_planet=\"Insert Destination\"\n     wp_name_tick=\"\"\n     wp_lat_tick=\"\"\n     wp_lon_tick=\"\"\n     wp_alt_tick=\"\"\n     stored=\"\"\n    end\n\n    if (keypad_input_wp_name==nil or keypad_input_wp_name==\"\") then\n     keypad_input_wp_name=\"\"\n     wp_name_inserted=false\n    else wp_name_inserted=true end\n\n    if (tonumber(keypad_input_wp_lat)==nil or keypad_input_wp_lat==\"\") then\n     keypad_input_wp_lat=\"\"\n     wp_lat_inserted=false\n    else wp_lat_inserted=true end\n\n    if (tonumber(keypad_input_wp_lon)==nil or keypad_input_wp_lon==\"\") then\n     keypad_input_wp_lon=\"\"\n     wp_lon_inserted=false\n    else wp_lon_inserted=true end\n\n    if (tonumber(keypad_input_wp_alt)==nil or keypad_input_wp_alt==\"\") then\n     keypad_input_wp_alt=\"\"\n     wp_alt_inserted=false\n    else wp_alt_inserted=true end\n\n    if (wp_selected_planet~=\"World Coordinates\" and wp_name_inserted==true and wp_lat_inserted==true and wp_lon_inserted==true and wp_alt_inserted==true) then\n     wp_coordinated_stored=tostring(coord_converter())\n    else wp_coordinated_stored=\"\" end\n\n    if (stored==nil or stored==\"STORED\" or stored==\"WP RENAMED\") then stored=\"\" end\n\n   end\n\n  --SETTINGS PAGE 3        (WP Sync)(screenState=8)\n   function settings3()\n    if FleetNumber==nil then FleetNumber=0 end\n    local FleetList=databank.getStringValue(\"Fleet\")\n    FleetList=json.decode(FleetList)\n    if FleetList==nil then FleetNumber=0\n    else FleetNumber=#FleetList end\n    local dbKeys=databank.getNbKeys()\n\n    if dbKeys>0 then\n     local counter=0\n     for i=1, dbKeys do\n      local wp_name=\"wp\"..i\n      local wp_name=databank.getStringValue(wp_name)\n\n      if (tostring(wp_name)~=nil and tostring(wp_name)~=\"\") then counter=counter + 1 end\n      keys_number=counter\n     end\n    else keys_number=0 end\n    if (sync_result==nil or sync_result==\"\") then sync_result=\"\" end\n\n   end\n\n  --SETTINGS PAGE 4        (Screen Colours)(screenState=10)\n  --SETTINGS PAGE 5        (DMG Rep.)(screenState=11)\n   function DMGReportClick(x)\n    if screenState==11 then\n     if x==\"UP\" then\n      if tick_dmg_1==\">\" then\n       DMG_REP_TOP_VIEW_Up_Down=DMG_REP_TOP_VIEW_Up_Down + dmg_factor\n       databank.setFloatValue(\"DMG TV U/D\", DMG_REP_TOP_VIEW_Up_Down)\n      elseif tick_dmg_2==\">\" then\n       DMG_REP_SIDE_VIEW_Up_Down=DMG_REP_SIDE_VIEW_Up_Down - dmg_factor\n       databank.setFloatValue(\"DMG SV U/D\", DMG_REP_SIDE_VIEW_Up_Down)\n      end\n     elseif x==\"DN\" then\n      if tick_dmg_1==\">\" then\n       DMG_REP_TOP_VIEW_Up_Down=DMG_REP_TOP_VIEW_Up_Down - dmg_factor\n       databank.setFloatValue(\"DMG TV U/D\", DMG_REP_TOP_VIEW_Up_Down)\n      elseif tick_dmg_2==\">\" then\n       DMG_REP_SIDE_VIEW_Up_Down=DMG_REP_SIDE_VIEW_Up_Down + dmg_factor\n       databank.setFloatValue(\"DMG SV U/D\", DMG_REP_SIDE_VIEW_Up_Down)\n      end\n     elseif x==\"LH\" then\n      if tick_dmg_1==\">\" then\n       DMG_REP_TOP_VIEW_LH_RH=DMG_REP_TOP_VIEW_LH_RH - dmg_factor\n       databank.setFloatValue(\"DMG TV L/R\", DMG_REP_TOP_VIEW_LH_RH)\n      elseif tick_dmg_2==\">\" then\n       DMG_REP_SIDE_VIEW_LH_RH=DMG_REP_SIDE_VIEW_LH_RH - dmg_factor\n       databank.setFloatValue(\"DMG SV L/R\", DMG_REP_SIDE_VIEW_LH_RH)\n      end\n     elseif x==\"RH\" then\n      if tick_dmg_1==\">\" then\n       DMG_REP_TOP_VIEW_LH_RH=DMG_REP_TOP_VIEW_LH_RH + dmg_factor\n       databank.setFloatValue(\"DMG TV L/R\", DMG_REP_TOP_VIEW_LH_RH)\n      elseif tick_dmg_2==\">\" then\n       DMG_REP_SIDE_VIEW_LH_RH=DMG_REP_SIDE_VIEW_LH_RH + dmg_factor\n       databank.setFloatValue(\"DMG SV L/R\", DMG_REP_SIDE_VIEW_LH_RH)\n      end\n     elseif x==\"+\" then\n      keypad_input_dmg1=keypad_input_dmg1 + dmg_factor\n      databank.setFloatValue(\"DMG Scale\", keypad_input_dmg1)\n     elseif x==\"-\" then\n      keypad_input_dmg1=keypad_input_dmg1 - dmg_factor\n      if keypad_input_dmg1<0.1 then keypad_input_dmg1=0.1 end \n      databank.setFloatValue(\"DMG Scale\", keypad_input_dmg1)\n     elseif x==\" + \" then\n      dmg_factor=dmg_factor + 0.1\n      keypad_input_dmg2=dmg_factor\n     elseif x==\" - \" then\n      dmg_factor=dmg_factor - 0.1\n      if dmg_factor<0.1 then dmg_factor=0.1 end\n      keypad_input_dmg2=dmg_factor\n     \n     end\n    end\n   end\n  \n  --SETTINGS PAGE 6        (DB Reset)(screenState=12)\n  --SETTINGS PAGE 7        (Routes)(screenState=14)\n   function settings7()\n\n    local stored_routes_table=\"\"\n    order_routes_list={}\n    local dbKeys=databank.getNbKeys()\n    RouteCounter=0\n    for i=1, dbKeys do\n     local dbkey=\"Route\"..i\n     local data=databank.getStringValue(dbkey):gsub(\"@@@\",\"\\\"\")\n     data=json.decode(data)\n     if data~=nil then\n      local value=data.name\n      if value~=\"\" then\n       RouteCounter=RouteCounter + 1\n       table.insert(order_routes_list, value)\n      end\n     end\n    end\n    table.sort(order_routes_list)\n\n    routes_list={}\n    RouteCounter=0\n    for i=1, #order_routes_list do\n     local dbkeysort=order_routes_list[i]\n     for x=1, dbKeys do\n      local key=\"Route\"..x\n      local data=databank.getStringValue(key):gsub(\"@@@\",\"\\\"\")\n      if data~=\"\" then\n       data=json.decode(data)\n       data=data.name\n       if dbkeysort==data then\n        RouteCounter=RouteCounter +1\n        routes_list[RouteCounter]={[\"id\"]=key,[\"route\"]=data}\n       end\n      end\n     end\n    end\n    routes_pages=generating_wp_pages(14)\n    routes_page_index=routes_page_index\n\n    route_tick_index=(routes_page_index*5)-4\n    for i=route_tick_index, (route_tick_index+4) do\n     if i<=RouteCounter then route_name=routes_list[i].route\n     else route_name=\"\" end\n     local route_tick=route_tick_[i]\n    end\n\n    routes_wp_pages=generating_wp_pages(\"14wp\")\n    routes_wp_page_index=routes_wp_page_index\n    wp_tick_index=(routes_wp_page_index*5)-4\n\n    for i=route_tick_index, (route_tick_index +4) do\n     if (route_tick_[i]==\">\" or route_tick_[i]==\"*\") then\n      local route_id=routes_list[i]\n      if (route_id~=nil and route_id~=\"\") then\n       route_id=routes_list[i].id\n       local data=databank.getStringValue(route_id):gsub(\"@@@\",\"\\\"\")\n       data=json.decode(data)\n       WpRouteList=data\n       local counter=0\n       if data~=nil then\n        for i,v in pairs(data) do counter=counter +1 end\n       else counter=5 end\n       counter=math.ceil(counter/5)*5\n       for i=1, counter do\n        if wp_tick_[i]~=\">\" then wp_tick_[i]=\"\" end\n       end\n       WpTickList=json.encode(wp_tick_)\n      else WpRouteList={} end\n     end\n    end\n\n    screen.setScriptInput(json.encode({routes_list,WpRouteList}))\n\n   end\n\n--SENDING DATA\n function sync_data()\n  if emitter then\n   local dbKeys=databank.getNbKeys()\n   if dbKeys>0 then\n    local counter=0\n    for i=index_sync, dbKeys do\n     local wp_name='wp'..i\n     local wp_name=databank.getStringValue(wp_name)\n     if (tostring(wp_name)~=nil and tostring(wp_name)~=\"\") then\n      counter=counter + 1\n      local wp_coord='wp'..i..'_coord'\n      local wp_coord=databank.getStringValue(wp_coord)\n      system.print(ship_id..\" is TRANSMITTING WP: \"..wp_name)\n\n      waypoint={wp_n=wp_name, wp_c=wp_coord}\n      json_string=json.encode(waypoint,{indent=false})\n      if counter<=1 then\n       wp_synced=wp_synced + 1\n       emitter.send(\"AviatorHUD\", \"<ShipData>\"..json_string:gsub(\"\\\"\",\"@@@\"))\n      else break end\n     end\n     sync_result=\"Synced \".. wp_synced ..\"/\".. keys_number ..\" WP\"\n     prog_bar=(wp_synced * 100)/keys_number\n     if index_sync<=dbKeys then\n      index_sync=index_sync + 1\n      delay_timer=1\n      delay_id=\"SyncData\"\n      unit.setTimer(\"delay\", 0.5)\n     end\n    end\n    LuaScreen()\n   end\n  else sync_result=\"No Emitter/Receiver\" end\n end\n\n--RECEIVING DATA\n function reqst_waypoints()\n  emitter.send(\"AviatorHUD\", \"<ShipRqst>\")\n  WP_request=true\n  sync_result=\">> Uplink << \".. msg_counter ..\"/\".. receiving_wp\n end\n\n msg_counter=0\n function receiving_data()\n  keypad_input_wpname=rcv_msg.wp_n\n  from_coordinates=rcv_msg.wp_c\n  wp_check()\n  LuaScreen()\n end\n\n fleet_msg_counter=0\n function receiving_FleetData()\n  local StoredFleetData=databank.getStringValue(\"Fleet\")\n  StoredFleetData=json.decode(StoredFleetData)\n  if StoredFleetData==nil then StoredFleetData={} end\n  local ShipName=rcv_msg.sh_n\n  local ShipID=rcv_msg.sh_id\n  local ShipExist=false\n  for i=1, #StoredFleetData do\n   if ShipName==StoredFleetData[i].n then ShipExist=true break end\n  end\n  if not ShipExist then table.insert(StoredFleetData, {[\"n\"]=ShipName,[\"id\"]=ShipID}) end\n  \n  StoredFleetData=json.encode(StoredFleetData)\n  databank.setStringValue(\"Fleet\", StoredFleetData)\n  LuaScreen()\n end\n\n--SCREEN SCRIPT BUILDIER\n atlas_list_page()\n function LuaScreen()\n\n --Parameters\n  local Parameters=[[\n  local FontName=]].. FontName ..[[\n  local FontSize=]].. FontSize ..[[\n  local FontColorR, FontColorG, FontColorB=]].. Font_R ..[[, ]].. Font_G ..[[, ]]..Font_B ..[[\n  local TitleR, TitleG, TitleB=]].. Title_R ..[[, ]].. Title_G ..[[, ]]..Title_B ..[[\n  local MenuButtonWidth=]].. MenuButtonWidth ..[[\n  local MenuButtonHeight=]].. MenuButtonHeight ..[[\n  local MenuKeyWidth=]].. MenuKeyWidth ..[[\n  local MenuKeyHeight=]].. MenuKeyHeight ..[[\n  local ButtonSep=]].. ButtonSep ..[[\n  local ButtonColorR, ButtonColorG, ButtonColorB=]].. Button_R ..[[, ]].. Button_G ..[[, ]].. Button_B ..[[\n  local TableR, TableG, TableB=]].. Table_R ..[[, ]].. Table_G ..[[, ]].. Table_B ..[[\n  local ButtonPressedR, ButtonPressedG, ButtonPressedB=]].. Button_Pressed_R ..[[, ]].. Button_Pressed_G ..[[, ]].. Button_Pressed_B ..[[\n  local ButtonEdgeR, ButtonEdgeG, ButtonEdgeB=192, 192, 192\n  local UnitsColorR, UnitsColorG, UnitsColorB=0, 255, 255\n  local SelectColorR, SelectColorG, SelectColorB=0, 255, 255\n  local SelectedColorR, SelectedColorG, SelectedColorB=]].. Title_R ..[[, ]].. Title_G ..[[, ]]..Title_B ..[[\n  ]]\n\n --Setup\n  local Setup=[[\n  local json=require('dkjson')\n\n  --Layers\n   local L_table=createLayer()\n   local L_menu=createLayer()\n   local L_text=createLayer()\n   local L_title=createLayer()\n   local L_units=createLayer()\n   local L_select=createLayer()\n   local L_selected=createLayer()\n\n  --Cursor\n   local rx, ry=getResolution()\n   local cx, cy=getCursor()\n\n  --Default\n   setDefaultFillColor(L_text, Shape_Text, FontColorR, FontColorG, FontColorB, 1)\n   setDefaultFillColor(L_title, Shape_Text, TitleR, TitleG, TitleB, 1)\n   setDefaultFillColor(L_units, Shape_Text, UnitsColorR, UnitsColorG, UnitsColorB, 1)\n   setDefaultFillColor(L_select, Shape_Text, SelectColorR, SelectColorG, SelectColorB, 1)\n   setDefaultFillColor(L_selected, Shape_Text, SelectedColorR, SelectedColorG, SelectedColorB, 1)\n   setDefaultStrokeColor(L_table, Shape_Line, TableR, TableG, TableB, 1)\n   setDefaultStrokeWidth(L_table, Shape_Line, 2)\n\n  --Fonts\n   local FontText=loadFont(FontName , FontSize)\n   local FontTitle=loadFont(FontName , FontSize+5)\n   local FontTick=loadFont(FontName , FontSize+10)\n\n\n  --Function drawTextBox\n   function drawTextBox(font, text, x, y, w, h, r)\n    local ww, hh=getTextBounds(font, text)\n    if w==0 or w<ww then w=ww end if h==0 or h<hh then h=hh end\n    setNextFillColor(L_menu, ButtonColorR, ButtonColorG, ButtonColorB, 1)\n    setNextStrokeColor(L_menu, ButtonEdgeR, ButtonEdgeG, ButtonEdgeB, 1)\n    setNextStrokeWidth(L_menu, 0.2)\n    addBoxRounded(L_menu, x, y, w, h, r)\n    setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n    addText(L_text, font, text, x+w/2, y+h/2)\n   end\n   ]]\n\n --Lists\n  local MenuLists=[[\n  local MenuLines={]].. Menu_Line1 ..[[,]].. Menu_Line2 ..[[,]].. Menu_Line3 ..[[,]].. Menu_Line4 ..[[,]].. Menu_Line5 ..[[,]].. Menu_Line6 ..[[,]].. Menu_Line7 ..[[,]].. Menu_Line8 ..[[,]].. Menu_Line9 ..[[,]].. Menu_Line10 ..[[,]].. Menu_Line11 ..[[}\n  local xMenu={10,300,590,880,10,155,300,590,880,10,155}\n  local MenuList={\"Time Calculator\",\"From\",\"Destination\",\"Shield\",\"AD/RN WP\",\"CLR WP\",\"Settings\",\"PE Target Altitude\",\"AGG\",\"WP/ATLAS\",\"INV Route\"}\n\n  local xKeypad={10,80,150,220,260,10,80,150,220,260,10,80,150,220,10,80,150,220,260}\n  local KeyPadList={\"1\",\"2\",\"3\",\"U\",\"u\",\"4\",\"5\",\"6\",\"D\",\"d\",\"7\",\"8\",\"9\",\"CAPS\",\"CLR\",\"0\",\"ENT\",\".\",\"-\"}\n\n  local xKeys={12,84,156,228,300,372,444,516,588,660,732,804,876,948,12,84,156,228,300,372,444,516,588,660,732,804,876,948}\n  local KeyList1={\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\",\"J\",\"K\",\"L\",\"M\",\"N\",\"O\",\"P\",\"Q\",\"R\",\"S\",\"T\",\"U\",\"V\",\"W\",\"X\",\"Y\",\"Z\",\"_\",\"moon\"}\n  local KeyList2={\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\",\"s\",\"t\",\"u\",\"v\",\"w\",\"x\",\"y\",\"z\",\"_\",\"moon\"}\n  \n  --Function TableNumbers\n   function TableNumbers(page)\n    local x, y, k=0, 0, 3\n    local index=(page*10)-9\n    for i=index, (index+4) do\n     xL=xKeys[5]+MenuKeyWidth/2+5\n     nL=i\n     xR=xKeys[10]+MenuKeyWidth/2+5\n     nR=i+5\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Center, AlignV_Middle)\n     addText(L_title, FontTitle, nL, xL, y)\n     setNextTextAlign(L_title, AlignH_Center, AlignV_Middle)\n     addText(L_title, FontTitle, nR, xR, y)\n    end\n   end\n  ]]\n\n --Create Menu Buttons\n  local MenuButtons=[[\n  for i=1, #MenuList do\n   local w, h=MenuButtonWidth, MenuButtonHeight\n   local line=0\n   if (i==4 or i==9) then w=MenuButtonWidth-146\n   elseif (i==5 or i==6 or i==10 or i==11) then w=MenuButtonWidth/2-5\n   end\n   if i<=4 then line=MenuLines[1]\n   elseif i<=9 then line=MenuLines[2]\n   elseif i>=10 then line=MenuLines[3]\n   end\n   drawTextBox(FontText, MenuList[i], xMenu[i], line, w, h, 5)\n  end\n  ]]\n\n --Create KeyPad Buttons\n  local KkeypadButtons=[[\n  for i=1, #KeyPadList do\n   local w, h=MenuKeyWidth, MenuKeyHeight\n   local line=0\n   if (i==4 or i==5 or i==9 or i==10 or i==18 or i==19) then w=MenuKeyWidth/2 end\n   if i<=5 then line=MenuLines[5]\n   elseif i<=10 then line=MenuLines[6]\n   elseif i<=14 then line=MenuLines[7]\n   elseif i>=15 then line=MenuLines[8]\n   end\n   drawTextBox(FontText, KeyPadList[i], xKeypad[i], line, w, h, 5)\n  end\n  ]]\n \n --Create Keys Buttons\n  local KeysButton=[[\n  CAPS=]].. tostring(CAPS) ..[[\n  for i=1, #KeyList1 do\n   local w, h=MenuKeyWidth, MenuKeyHeight\n   local line=0\n   local key=\"\"\n   if i<=14 then line=MenuLines[10]\n   elseif i>=15 then line=MenuLines[11]\n   end\n   if CAPS then key=KeyList1[i] else key=KeyList2[i] end\n   drawTextBox(FontText, key, xKeys[i], line, w, h, 5)\n  end\n  ]]\n  \n --Cursor Click\n  local CursorClick=[[\n  local label=\"\" setOutput(label)\n  if getCursorDown() then\n   local condition, xS, yS=0, 0, 0\n\n   for i=1, #MenuList do\n    local w, h=MenuButtonWidth, MenuButtonHeight\n    local line=0\n    if (i==4 or i==9) then w=MenuButtonWidth-146\n    elseif (i==5 or i==6 or i==10 or i==11) then w=MenuButtonWidth/2-5\n    end\n    if i<=4 then line=MenuLines[1]\n    elseif i<=9 then line=MenuLines[2]\n    elseif i>=10 then line=MenuLines[3]\n    end\n    local x1, x2=xMenu[i], xMenu[i]+w \n    local y1, y2=line, line+h\n    if cx>x1 and cx<x2 and cy>y1 and cy<y2 then label=MenuList[i] xS=x1 yS=y1 condition=1 end\n   end\n\n   for i=1, #KeyPadList do\n    local w, h=MenuKeyWidth, MenuKeyHeight\n    local line=0\n    if (i==4 or i==5 or i==9 or i==10 or i==18) then w=MenuKeyWidth/2 end\n    if i<=5 then line=MenuLines[5]\n    elseif i<=10 then line=MenuLines[6]\n    elseif i<=14 then line=MenuLines[7]\n    elseif i>=15 then line=MenuLines[8]\n    end\n    local x1, x2=xKeypad[i], xKeypad[i]+w\n    local y1, y2=line, line+h\n    if cx>x1 and cx<x2 and cy>y1 and cy<y2 then label=KeyPadList[i] xS=x1 yS=y1 condition=2 end\n   end\n \n   for i=1, #xKeys do\n    local h, w=MenuKeyHeight, MenuKeyWidth\n    local line=0\n    local key=\"\"\n    if i<=14 then line=MenuLines[10]\n    elseif i>=15 then line=MenuLines[11]\n    end\n    local x1, x2=xKeys[i], xKeys[i]+w\n    local y1, y2=line, line+h\n    if CAPS then key=KeyList1[i] else key=KeyList2[i] end\n    if cx>x1 and cx<x2 and cy>y1 and cy<y2 then label=key xS=x1 yS=y1 condition=3 end\n   end\n\n   if condition>0  then\n    local w, h=0, 0\n    if condition==1 then\n     w, h=MenuButtonWidth, MenuButtonHeight\n     if (label==\"Shield\" or label==\"AGG\") then w=MenuButtonWidth-146\n     elseif (label==\"AD/RN WP\" or label==\"CLR WP\" or label==\"WP/ATLAS\" or label==\"INV Route\") then w=MenuButtonWidth/2-5\n     end\n    elseif condition==2 then \n     h, w=MenuKeyHeight, MenuKeyWidth\n     if (label==\"U\" or label==\"u\" or label==\"D\" or label==\"d\" or label==\".\" or label==\"-\") then w=MenuKeyWidth/2\n     elseif label==\"CAPS\" then w=68\n     end\n    elseif condition==3 then \n     h, w=MenuKeyHeight, MenuKeyWidth\n     if label==\"moon\" then w=72 end\n    end\n\n    if condition==2 then\n     if label==\"U\" then label=\"arrowUP\"\n     elseif label==\"u\" then label=\"arrowup\"\n     elseif label==\"D\" then label=\"arrowDN\"\n     elseif label==\"d\" then label=\"arrowdn\"\n     end\n    end\n    \n    condition=0\n\n    local L_keypressed=createLayer()\n    setNextFillColor(L_keypressed, ButtonPressedR, ButtonPressedG, ButtonPressedB, 0.2)\n    setNextStrokeColor(L_keypressed, ButtonPressedR, ButtonPressedG, ButtonPressedB, 1)\n    setNextStrokeWidth(L_keypressed, 1)\n    addBoxRounded(L_keypressed, xS, yS, w, h, 5)\n    setOutput(label)\n   end\n\n  end\n  ]]\n\n --Screen Data Status\n  function DataStatus_Table_Function()\n   local Table=[[\n   local DataStatus_List={[1]=\"Ship ID\",[3]=\"]].. ship_id ..[[\",[8]=\"Stored\",[12]=\"]].. status_FM ..[[\",[13]=\"]].. status_TO ..[[\",[14]=\"]].. status_TA ..[[\"}\n   for i=1, 14 do\n    if (i==9 or i==10) then\n     local x1, y1, x2, y2=xKeys[1], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     if i==10 then\n      x1, y1, x2, y2=xKeys[1], MenuLines[i]-ButtonSep, xKeys[14]+MenuKeyWidth, MenuLines[i]-ButtonSep\n     end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==1 or i==3 or i==8 or i>=12) then\n     local x, y, x1, y1, x2, y2=xKeys[i]+ButtonSep, MenuLines[9]+MenuKeyHeight/2, xKeys[i], MenuLines[9], xKeys[i], MenuLines[10]-ButtonSep\n     local Align=AlignH_Left\n     addLine(L_table, x1, y1, x2, y2)\n     if i==14 then\n      x1=xKeys[i]+MenuKeyWidth x2=x1\n      addLine(L_table, x1, y1, x2, y2)\n     end\n     if i>=12 then\n      Align=AlignH_Center\n      x=xKeys[i]+MenuKeyWidth/2+5\n     end\n     setNextTextAlign(L_table, Align, AlignV_Middle)\n     if (i==1 or i==8) then\n      setNextFillColor(L_table, TitleR, TitleG, TitleB, 1)\n      addText(L_table, FontTitle, DataStatus_List[i], x, y)\n     else addText(L_table, FontText, DataStatus_List[i], x, y) end\n    end\n   end\n   ]]\n   return Table\n  end\n\n --Screen WP\n  function WPStore_Table_Function()\n   local Table=[[\n   local wp_page_index=]].. wp_page_index ..[[\n   local wp_pages=]].. wp_pages ..[[\n   local wp_counter=]].. wp_counter ..[[\n   local Title={\"WP\",\"Page \".. wp_page_index ..\"/\".. wp_pages}\n  \n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n  \n    if (i==5 or i==6 or i==10 or i==11 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if (i>5 and i<14) then y1=MenuLines[4] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   TableNumbers(wp_page_index)\n\n   function WP_Table_List_Function()\n    for i=1, #Title do\n     local x, y=0, 0\n     if i==1 then x=xKeys[8] else x=xKeys[13] end\n     y=MenuLines[3]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Center, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    local wp_list=json.decode(getInput()) or {}\n    local xL, xR, y, L, settingsL, settingsR=0, 0, 0, 3, \"\", \"\"\n    if Selected==nil then Selected=false end\n\n    for i=1, 5 do\n     if wp_list[i]~=nil then\n      wp_id_L=wp_list[i].name\n      settingsL=wp_list[i].settings\n      xL=xKeys[6]+ButtonSep\n     else\n      wp_id_L=\"\"\n      xL=xKeys[6]+ButtonSep\n     end\n     if wp_list[i+5]~=nil then\n      wp_id_R=wp_list[i+5].name\n      settingsR=wp_list[i+5].settings\n      xR=xKeys[11]+ButtonSep\n     else\n      wp_id_R=\"\"\n      xR=xKeys[11]+ButtonSep\n     end\n     L=L+1\n     y=MenuLines[L]+MenuKeyHeight/2+5\n     if (cx>xL and cx<xKeys[10] and cy>MenuLines[L] and cy<MenuLines[L]+MenuKeyHeight+ButtonSep) then\n      setNextTextAlign(L_select, AlignH_Left, AlignV_Middle)\n      addText(L_select, FontText, wp_id_L, xL, y)\n      if getCursorDown() then\n       Selected=true\n       SelectedID=wp_id_L\n       setOutput(wp_id_L)\n      end\n     else\n      setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n      if settingsL==\"*\" then setNextFillColor(L_text, 0, 1, 0, 1) end\n      addText(L_text, FontText, wp_id_L, xL, y)\n     end\n     if (cx>xR and cx<xKeys[14]+MenuKeyWidth+ButtonSep and cy>MenuLines[L] and cy<MenuLines[L]+MenuKeyHeight+ButtonSep) then\n      setNextTextAlign(L_select, AlignH_Left, AlignV_Middle)\n      addText(L_select, FontText, wp_id_R, xR, y)\n      if getCursorDown() then\n       Selected=true\n       SelectedID=wp_id_R\n       setOutput(wp_id_R)\n      end\n     else\n      setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n      if settingsR==\"*\" then setNextFillColor(L_text, 0, 1, 0, 1) end\n      addText(L_text, FontText, wp_id_R, xR, y)\n     end\n\n     if Selected then\n      setNextTextAlign(L_selected, AlignH_Center, AlignV_Middle)\n      addText(L_selected, FontText, SelectedID, xKeys[3], MenuLines[4]+MenuKeyHeight/2) \n     end\n\n    end\n\n   end\n   WP_Table_List_Function()\n\n   requestAnimationFrame(10)\n   ]]\n   return Table\n  end\n\n --Screen ATLAS\n  function ATLAS_Table_Function()\n   local Table=[[\n   local atlas_page_index=]].. atlas_page_index ..[[\n   local atlas_pages=]].. atlas_pages ..[[\n   local atlas_counter=]].. atlas_counter ..[[\n   local Title={\"ATLAS\",\"Page \".. atlas_page_index ..\"/\".. atlas_pages}\n   \n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==11 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if (i>5 and i<14) then y1=MenuLines[4] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   TableNumbers(atlas_page_index)\n\n   function ATLAS_Table_List_Function()\n    for i=1, #Title do\n     local x, y=0, 0\n     if i==1 then x=xKeys[8] else x=xKeys[13] end\n     y=MenuLines[3]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Center, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    local atlas_list=json.decode(getInput()) or {}\n    local xL, xR, y, L=0, 0, 0, 3\n    local index=(atlas_page_index*10)-9\n    if Selected==nil then Selected=false end\n\n    for i=index, (index+4) do\n     if i<=atlas_counter then\n      atlas_id_L=atlas_list[i]\n      xL=xKeys[6]+ButtonSep\n     else\n      atlas_id_L=\"\"\n      xL=xKeys[6]+ButtonSep\n     end\n     if (i+5)<=atlas_counter then\n      atlas_id_R=atlas_list[i+5]\n      xR=xKeys[11]+ButtonSep\n     else\n      atlas_id_R=\"\"\n      xR=xKeys[11]+ButtonSep\n     end\n     L=L+1\n     y=MenuLines[L]+MenuKeyHeight/2+5\n     if (cx>xL and cx<xKeys[10] and cy>MenuLines[L] and cy<MenuLines[L]+MenuKeyHeight+ButtonSep) then\n      setNextTextAlign(L_select, AlignH_Left, AlignV_Middle)\n      addText(L_select, FontText, atlas_id_L, xL, y)\n      if getCursorDown() then\n       Selected=true\n       SelectedID=atlas_id_L\n       setOutput(atlas_id_L)\n      end\n     else\n      setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n      addText(L_text, FontText, atlas_id_L, xL, y)\n     end\n     if (cx>xR and cx<xKeys[14]+MenuKeyWidth+ButtonSep and cy>MenuLines[L] and cy<MenuLines[L]+MenuKeyHeight+ButtonSep) then\n      setNextTextAlign(L_select, AlignH_Left, AlignV_Middle)\n      addText(L_select, FontText, atlas_id_R, xR, y)\n      if getCursorDown() then\n       Selected=true\n       SelectedID=atlas_id_R\n       setOutput(atlas_id_R)\n      end\n     else\n      setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n      addText(L_text, FontText, atlas_id_R, xR, y)\n     end\n     \n     if Selected then\n      setNextTextAlign(L_selected, AlignH_Center, AlignV_Middle)\n      addText(L_selected, FontText, SelectedID, xKeys[3], MenuLines[4]+MenuKeyHeight/2) \n     end\n\n    end\n   end\n   ATLAS_Table_List_Function()\n\n   requestAnimationFrame(10)\n   ]]\n   return Table\n  end\n\n --Screen SU Distance Time\n  function SuDistanceTime_Table_Function()\n   local Table=[[\n   local Title={\"Insert The Distance\",\"Insert Cruising Speed or press ENT:\",\"ETA After:\",\"Warp Cells:\", \"Max:\"}\n   local Units={\"Su\",\"Km/h\"}\n   local Tick={\"]].. su_tick ..[[\",]].. keypad_input_su ..[[,\"]].. speed_tick ..[[\",]].. keypad_input_speed ..[[}\n   local Results={]].. time_to_go ..[[,\"]].. MinWpCells ..[[\",\"]].. MaxWpCells ..[[\"}\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if i==10 then y1=MenuLines[7] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function SuDistanceTime_Table_List_Function()\n    local x, y, k=0, 0, 1\n    for i=1, #Title do\n     if i<=3 then x=xKeys[6]+ButtonSep\n     elseif i==4 then x=xKeys[10]+ButtonSep\n     elseif i==5 then x=xKeys[12]+ButtonSep\n     end\n     if i<=3 then k=k+2\n     elseif i==4 then k=k \n     elseif i==5 then k=k+1\n     end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Left, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    for i=1, #Units do\n     x=xKeys[6]+ButtonSep\n     if i==1 then k=4 else k=6 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Left, AlignV_Middle)\n     addText(L_units, FontText, Units[i], x, y)\n    end\n\n    for i=1, #Tick do\n     local Align=AlignH_Left\n     if i%2==1 then\n      x=xKeys[5]+MenuKeyWidth/2+5\n      Align=AlignH_Center\n     else x=xKeys[7]+ButtonSep end\n     if i<=2 then k=4 else k=6 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, Align, AlignV_Middle)\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n    for i=1, #Results do\n     if i==1 then x=xKeys[6]+ButtonSep\n     elseif i==2 then x=xKeys[10]+ButtonSep\n     elseif i==3 then x=xKeys[13]+ButtonSep\n     end\n     y=MenuLines[8]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n     addText(L_text, FontText, Results[i], x, y)\n    end\n\n   end\n   SuDistanceTime_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen From\n  function from_Table_Function()\n   local Table=[[\n   local Title={\"Insert Departure or press ENT\",\"Coordinates:\",\"Add/Rename WP\"}\n   local Tick={\"]].. FROM_tick ..[[\",\"]].. keypad_input_from ..[[\",\"]].. WPADD_tick ..[[\",\"]].. keypad_input_wpname ..[[\"}\n   local Results={\"]].. tostring(from_coordinates) ..[[\",\"]].. stored ..[[\"}\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   \n    if (i==5 or i==6 or i==10 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if i==6 then y2=MenuLines[6] y3=MenuLines[7] y4=MenuLines[9] end\n     if i==10 then y1=MenuLines[8] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n     if i==6 then addLine(L_table, x1, y3, x2, y4) end\n    end\n   end\n\n   function from_Table_List_Function()\n    local x, y , k=0, 0, 3\n    for i=1, #Title do\n     x=xKeys[6]+ButtonSep\n     if i>1 then k=k+2 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Left, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    for i=1, #Tick do\n     local Align=AlignH_Left\n     if i%2==1 then\n      x=xKeys[5]+MenuKeyWidth/2+5\n      Align=AlignH_Center\n     else x=xKeys[6]+ButtonSep end\n     if i<=2 then k=4 else k=8 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, Align, AlignV_Middle)\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n    for i=1, #Results do\n     if i==1 then\n      x=xKeys[5]+ButtonSep\n      y=MenuLines[6]+MenuKeyHeight/2+5\n     elseif i==2 then\n      x=xKeys[10]+ButtonSep\n      y=MenuLines[8]+MenuKeyHeight/2+5\n     end\n     setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n     addText(L_text, FontText, Results[i], x, y)\n    end\n\n   end\n   from_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen To\n  function distance_to_wp_Table_Function()\n   local Table=[[\n   local Title={\"Insert Destination\",\"Distance:\",\"Warp Cells:\",\"Max:\",\"Coordinates:\"}\n   local Tick={\">\",\"]].. keypad_input_dest ..[[\"}\n   local Units={\"Su\"}\n   local Results={\"]].. distance_to_go ..[[\",\"]].. MinWpCells ..[[\",\"]].. MaxWpCells ..[[\",\"]].. tostring(destination_coord) ..[[\"}\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if i==6 then y2=MenuLines[8] end\n     if i==10 then y1=MenuLines[5] y2=MenuLines[7] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function distance_to_wp_Table_List_Function()\n    local x, y , k=0, 0, 2\n    for i=1, #Title do\n     x=xKeys[6]+ButtonSep\n     if i==3 then x=xKeys[10]+ButtonSep end\n     if i==4 then x=xKeys[12]+ButtonSep end\n     if i==2 then k=5 elseif i==3 then k=k elseif i==4 then k=6 else k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Left, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    for i=1, #Units do\n     x=xKeys[6]+ButtonSep\n     y=MenuLines[6]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Left, AlignV_Middle)\n     addText(L_units, FontText, Units[i], x, y)\n    end\n\n    for i=1, #Tick do\n     local Align=AlignH_Left\n     if i==1 then\n      x=xKeys[5]+MenuKeyWidth/2+5\n      Align=AlignH_Center\n     else x=xKeys[6]+ButtonSep end\n     y=MenuLines[4]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, Align, AlignV_Middle)\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n    for i=1, #Results do\n     if i==1 then x=xKeys[7]+ButtonSep end\n     if i==2 then x=xKeys[10]+ButtonSep end\n     if i==3 then x=xKeys[13]+ButtonSep end\n     y=MenuLines[6]+MenuKeyHeight/2+5\n     if i==4 then x=xKeys[5]+ButtonSep y=MenuLines[8]+MenuKeyHeight/2+5 end\n     setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n     addText(L_text, FontText, Results[i], x, y)\n    end\n\n   end\n   distance_to_wp_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen PE Altitude\n  function target_pe_altitude_Table_Function()\n   local Table=[[\n   local Title={\"Insert PE Target Altitude\",\"Stored Altitude\"}\n   local Units={\"m\",\"m\"}\n   local Tick={]].. keypad_input_pe_target_alt ..[[}\n   local Results={\"]].. target_alt_warning ..[[\",]].. stored_pe_target_alt ..[[}\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function target_pe_altitude_Table_List_Function()\n    local x, y , k=0, 0, 3\n    for i=1, #Title do\n     x=xKeys[5]+ButtonSep\n     if i>1 then k=k+3 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Left, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    for i=1, #Units do\n     x=xKeys[5]+ButtonSep\n     if i==1 then k=4 else k=7 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Left, AlignV_Middle)\n     addText(L_units, FontText, Units[i], x, y)\n    end\n\n    for i=1, #Tick do\n     x=xKeys[6]+ButtonSep\n     y=MenuLines[4]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n    for i=1, #Results do\n     if i==1 then\n      x=xKeys[5]+ButtonSep\n      y=MenuLines[5]+MenuKeyHeight/2+5\n     elseif i==2 then\n      x=xKeys[6]+ButtonSep\n      y=MenuLines[7]+MenuKeyHeight/2+5\n     end\n     setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n     addText(L_text, FontText, Results[i], x, y)\n    end\n\n   end\n   target_pe_altitude_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen AGG\n  function agg_Table_Function()\n   local Table=[[\n   local agg_eng_stby=\"]].. agg_eng_stby ..[[\"\n   local agg_target_altitude=]].. tostring(agg_target_altitude) ..[[\n   local agg_base_altitude=\"]].. agg_base_altitude ..[[\"\n   if tonumber(agg_base_altitude)~=nil then math.floor(agg_base_altitude) end\n   local ALTDiffCheck=\"]].. ALTDiffCheck ..[[\"\n   local Title={\"Anti Gravity Generator\",\"AGG Altitude\",agg_base_altitude,\"Target Altitude\",\"Ship Altitude\",\"]].. ship_altitude ..[[\"}\n   local Buttons={\"]].. AGG_Off_Stby ..[[\",\"]].. AGG_Eng_Dis ..[[\"}\n   local Units={\"m\",\"m\",\"m\"}\n   local Tick={\"]].. agg_tick_input ..[[\",\"]].. keypad_input_agg_target_alt ..[[\"}\n   local Results={\"]].. agg_off_stby ..[[\"}\n\n   for i=3, 14 do\n    if i<=7 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==7 or i==10 or i==12 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if i==6 then y1=MenuLines[5] y2=MenuLines[6] end\n     if (i==7 or i==12) then y1=MenuLines[7] end\n     if i==10 then y1=MenuLines[4] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function agg_Table_List_Function()\n    local x, y, k=0, 0, 2\n    for i=1, #Title do\n     local AlignH=AlignH_Left\n     local AlignV=AlignV_Middle\n     if i==1 then x=xKeys[10] k=3 AlignH=AlignH_Center\n     elseif i==2 then x=xKeys[5]+ButtonSep k=4\n     elseif i==3 then\n      if agg_base_altitude==\"PB Not Linked to AGG\" then\n       x=xKeys[10]+ButtonSep\n       setNextFillColor(L_title, 1, 0, 0, 1)\n      else x=xKeys[11]+ButtonSep end\n     elseif i==4 then x=xKeys[6]+ButtonSep k=5\n     elseif i==5 then x=xKeys[5]+ButtonSep k=6\n     elseif i==6 then x=xKeys[11]+ButtonSep\n     end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     if ((i==3 or i==6) and ALTDiffCheck==\"GREEN\") then setNextFillColor(L_title, 0, 1, 0, 1) end \n     setNextTextAlign(L_title, AlignH, AlignV)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    for i=1, #Buttons do\n     local xCur1, xCur2=xKeys[5], xKeys[7]\n     if i==1 then x=xKeys[6] setNextFillColor(L_text, 1, 0, 0, 1)\n     else\n      x=xKeys[11]\n      xCur1, xCur2=xKeys[10], xKeys[12]\n      setNextFillColor(L_text, 0, 1, 0, 1)\n     end\n     y=MenuLines[8]\n     local yCur1, yCur2=MenuLines[7], MenuLines[9]\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontText, Buttons[i], x, y)\n     if (Buttons[i]==\"OFF\" or Buttons[i]==\"STBY\" or Buttons[i]==\"ENGAGE\") then\n      if (cx>xCur1 and cx<xCur2 and cy>yCur1 and cy<yCur2) then\n       local Width=xCur2-xCur1\n       local Height=yCur2-yCur1\n       setNextFillColor(L_text, ButtonPressedR, ButtonPressedG, ButtonPressedB, 0.1)\n       addBox(L_text, xCur1+2, yCur1+2, Width, Height)\n       if getCursorDown() then setOutput(Buttons[i]) end\n      end\n     end\n    end\n\n    k=3\n    local UnitIndex=1\n    if agg_base_altitude==\"PB Not Linked to AGG\" then UnitIndex=2 k=4 end\n    for i=UnitIndex, #Units do\n     x=xKeys[10]+ButtonSep\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Left, AlignV_Middle)\n     addText(L_units, FontText, Units[i], x, y)\n    end\n\n    for i=1, #Tick do\n     local Align=AlignH_Left\n     if i==1 then x=xKeys[5]+MenuKeyWidth/2+5 Align=AlignH_Center\n     else x=xKeys[11]+ButtonSep end\n     y=MenuLines[5]+MenuKeyHeight/2+5\n     if Tick[i]==\"X\" then setNextFillColor(L_text, 1, 0, 0, 1) end\n     if (i==2 and agg_target_altitude) then setNextFillColor(L_text, TitleR, TitleG, TitleB, 1) end\n     setNextTextAlign(L_text, Align, AlignV_Middle)\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n    for i=1, #Results do\n     x=xKeys[8]+MenuKeyWidth/2+5\n     y=MenuLines[8]\n     local xBOX=xKeys[12]+ButtonSep\n     local wBOX=(xKeys[14]+MenuKeyWidth-xKeys[12])-(ButtonSep*2)\n     local yBOX=MenuLines[7]+ButtonSep\n     local hBOX=(MenuLines[9]-MenuLines[7])-(ButtonSep*2)\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontText, Results[i], x, y)\n     if agg_eng_stby==\"RED\" then setNextFillColor(L_title, 1, 0, 0, 1)\n     elseif agg_eng_stby==\"GREEN\" then setNextFillColor(L_title, 0, 1, 0, 1) end\n     addBox(L_title, xBOX, yBOX, wBOX, hBOX)\n    end\n\n   end\n   agg_Table_List_Function()\n\n   requestAnimationFrame(10)\n   ]]\n   return Table\n  end\n\n --Screen Shield\n  function shield_Table_Function()\n   local Table=[[\n   local Title={\"Shield\",\"Energy Pool\",\"A\",\"E\",\"K\",\"T\"}\n   local Operators={\"-\",\"+\",\"-\",\"+\",\"-\",\"+\",\"-\",\"+\"}\n   local input=json.decode(getInput()) or {}\n   local Buttons=input[1] or {}\n   local ShieldData=input[2] or {}\n   local ShieldStressTable=input[3] or {}\n   local ShieldOnOff=Buttons[1]\n   local ShieldSET=Buttons[3]\n   local ShieldPercent=tonumber(ShieldData[1])\n   local EnergyDistribution=ShieldData[7]\n   local ShieldBaseEnergy=ShieldData[8]\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     if i==6 then x1=xKeys[8] end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==8 or i==9 or i==10 or i==11 or i==12 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if (i==9 or i==10 or i==11 or i==12) then y1=MenuLines[5] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function shield_Table_List_Function()\n    local x, y, k, xCur1, xCur2, yCur1, yCur2, xCol=0, 0, 0, 0, 0, 0, 0, 0\n    for i=1, #Title do\n     local AlignH=AlignH_Left\n     if i==1 then x=xKeys[11]+MenuKeyWidth/2 k=3 AlignH=AlignH_Center\n     elseif i==2 then x=xKeys[5]+ButtonSep k=5\n     elseif i==3 then x=xKeys[8]+MenuKeyWidth/2\n     elseif i>=4 then k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    k=2\n    for i=1, #Buttons do\n     x=xKeys[6]+MenuKeyWidth/2\n     xCur1=xKeys[5]\n     xCur2=xKeys[8]\n     if (i==1 or i==2) then k=k+1\n     elseif i==3 then k=7\n     elseif i==4 then k=8 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     yCur1=MenuLines[k]\n     yCur2=yCur1+MenuKeyHeight\n     local Btn=Buttons[i]\n     local Alpha=1\n     if (i==1 and Btn==\"RAISE\") then setNextFillColor(L_text, 0, 1, 0, Alpha)\n     elseif (i==1 and Btn==\"DROP\") then setNextFillColor(L_text, 1, 0, 0, Alpha)\n     elseif (i==2 and Btn==\"VENTING\") then setNextFillColor(L_text, 1, 0, 0, Alpha)\n     elseif (i==3 and Btn==\"SET\") then setNextFillColor(L_text, 0, 1, 0, Alpha)\n     elseif (i==4 and Btn==\"RESET\") then setNextFillColor(L_text, 1, 0, 0, Alpha)\n     end\n     if (i==2 and Btn~=\"VENTING\") then Alpha=0.3 setNextFillColor(L_text, 0.5, 0.5, 0.5, Alpha)\n     elseif (i==3 and (Btn~=\"SET\" or EnergyDistribution==false)) then Alpha=0.3 setNextFillColor(L_text, 0.5, 0.5, 0.5, Alpha)\n     elseif(i==4 and (ShieldSET~=\"SET\" or ShieldBaseEnergy) and EnergyDistribution==false) then Alpha=0.3 setNextFillColor(L_text, 0.5, 0.5, 0.5, Alpha)\n     end\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontText, Btn, x, y)\n     if ((cx>xCur1 and cx<xCur2 and cy>yCur1 and cy<yCur2) and Alpha==1) then\n      local Width, Height=xCur2-xCur1, MenuKeyHeight+7\n      setNextFillColor(L_text, ButtonPressedR, ButtonPressedG, ButtonPressedB, 0.1)\n      addBox(L_text, xCur1+2, yCur1+2, Width, Height)\n      if getCursorDown() then setOutput(Btn) end\n     end\n    end\n\n    for i=1, #ShieldData-2 do\n     x=xKeys[11]+MenuKeyWidth/2+5\n     if i==1 then x=xKeys[13]+ButtonSep k=3 setNextFillColor(L_units, FontColorR, FontColorG, FontColorB, 1)\n      ShieldData[i]=string.format(\"%.0f\", ShieldData[i]) ..\" %\"\n     elseif i==2 then x=xKeys[6]+MenuKeyWidth/2 k=6\n      if EnergyDistribution then setNextFillColor(L_units, UnitsColorR, UnitsColorG, UnitsColorB, 1)\n      else setNextFillColor(L_units, FontColorR, FontColorG, FontColorB, 1) end      \n     elseif i==3 then k=5 if not EnergyDistribution then setNextFillColor(L_units, TitleR, TitleG, TitleB, 1) end\n     elseif i==4 then k=6 if not EnergyDistribution then setNextFillColor(L_units, TitleR, TitleG, TitleB, 1) end\n     elseif i==5 then k=7 if not EnergyDistribution then setNextFillColor(L_units, TitleR, TitleG, TitleB, 1) end\n     elseif i==6 then k=8 if not EnergyDistribution then setNextFillColor(L_units, TitleR, TitleG, TitleB, 1) end\n     end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Center, AlignV_Middle)\n     addText(L_units, FontText, ShieldData[i], x, y)\n    end\n\n    k=4\n    for i=1, #Operators do\n     if i%2==1 then xCol=9 else xCol=10 end\n     x=xKeys[xCol]+MenuKeyWidth/2+5\n     xCur1=xKeys[xCol]+1\n     xCur2=xKeys[xCol+1]-1\n     if i%2==1 then k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     yCur1=MenuLines[k]+1\n     yCur2=MenuLines[k+1]-1\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontTick, Operators[i], x, y)\n     if ((cx>xCur1 and cx<xCur2 and cy>yCur1 and cy<yCur2) and ShieldSET==\"SET\") then\n      local Width, Height=MenuKeyWidth+7, MenuKeyHeight+7\n      setNextFillColor(L_text, ButtonPressedR, ButtonPressedG, ButtonPressedB, 0.1)\n      addBox(L_text, xCur1, yCur1, Width, Height)\n      local Output=\"\"\n      if i==1 then Output=\"A-\"\n      elseif i==2 then Output=\"A+\"\n      elseif i==3 then Output=\"E-\"\n      elseif i==4 then Output=\"E+\"\n      elseif i==5 then Output=\"K-\"\n      elseif i==6 then Output=\"K+\"\n      elseif i==7 then Output=\"T-\"\n      elseif i==8 then Output=\"T+\"\n      end\n      if getCursorDown() then setOutput(Output) end\n     end\n    end\n\n    k=4\n    for i=1, #ShieldStressTable do\n     k=k+1\n     local x1BAR, y1BAR=xKeys[12]+4, MenuLines[k]+10\n     local width=((xKeys[14]+MenuKeyWidth-xKeys[18]-8) * ShieldStressTable[i]*100)/100\n     local height=MenuLines[k+1]-MenuLines[k]-20\n     setNextFillColor(L_title, 0.53, 0.33, 0.97, 1)\n     addBox(L_title, x1BAR, y1BAR, width, height)\n    end\n\n    if ShieldPercent>0 then\n     local x1BAR, y1BAR=xKeys[8]+4, MenuLines[4]+4\n     local width=((xKeys[14]+MenuKeyWidth-xKeys[8]-8) * ShieldPercent)/100\n     local height=MenuLines[5]-MenuLines[4]-8\n     local Alpha=1\n     if ShieldOnOff==\"RAISE\" then Alpha=0.1 end\n     setNextFillColor(L_title, TitleR, TitleG, TitleB, Alpha)\n     addBox(L_title, x1BAR, y1BAR, width, height)\n    end\n\n   end\n   shield_Table_List_Function()\n\n   requestAnimationFrame(10)\n   ]]\n   return Table\n  end\n\n --Screen Settings\n  function settings_menu_Table_Function()\n   local Table=[[\n   local Title={\"Settings\",\"Page 1/1\"}\n   local Content={\"Ship Settings\",\"DB Reset\",\"WP Store\",\"Routes\",\"WP Sync\",\"---\",\"Screen Colors\",\"---\",\"DMG Report\",\"---\"}\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==11 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if (i>5 and i<14) then y1=MenuLines[4] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   TableNumbers(1)\n\n   function settings_menu_Table_List_Function()\n    for i=1, #Title do\n     local x, y=0, 0\n     if i==1 then x=xKeys[8] else x=xKeys[13] end\n     y=MenuLines[3]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Center, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    for i=1, #Content do\n     if i%2==1 then x=xKeys[6]+ButtonSep\n     else x=xKeys[11]+ButtonSep end\n     if (i==1 or i==2) then k=4\n     elseif (i==3 or i==4) then k=5\n     elseif (i==5 or i==6) then k=6\n     elseif (i==7 or i==8) then k=7\n     elseif (i==9 or i==10) then k=8\n     end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     if (cx>x-ButtonSep and cx<x+MenuButtonWidth and cy>MenuLines[k] and cy<MenuLines[k]+MenuKeyHeight+ButtonSep) then\n      setNextTextAlign(L_select, AlignH_Left, AlignV_Middle)\n      addText(L_select, FontText, Content[i], x, y)\n      if getCursorDown() then\n       Selected=true\n       setOutput(Content[i])\n      end\n     else\n      setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n      addText(L_text, FontText, Content[i], x, y)\n     end\n\n    end\n\n   end\n   settings_menu_Table_List_Function()\n\n   requestAnimationFrame(10)\n   ]]\n   return Table\n  end\n\n --Screen WP Settings\n  function wp_settings_Table_Function()\n   local Table=[[\n   local edit_wp=\"]].. edit_wp ..[[\"\n   local Title={\"WP: \".. edit_wp,\"Altitude\",\"Speed\"}\n   local Units={\"m\",\"Km/h\"}\n   local Tick={\"]].. wp_altitude_tick ..[[\",\"]].. keypad_input_wp_altitude ..[[\",\"]].. wp_speed_tick ..[[\",\"]].. keypad_input_wp_speed ..[[\"}\n   local wp_altitude_inserted=]].. tostring(wp_altitude_inserted) ..[[\n   local wp_speed_inserted=]].. tostring(wp_speed_inserted) ..[[\n\n   for i=3, 14 do\n    if i<=6 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if (i==6 or i==10) then\n      y1=MenuLines[4]\n      y2=MenuLines[6]\n     end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function wp_settings_Table_List_Function()\n    local x, y, k=0, 0, 2\n    for i=1, #Title do\n     if i==1 then x=xKeys[8]+ButtonSep else x=xKeys[6]+ButtonSep end\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Left, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    k=3\n    for i=1, #Units do\n     x=xKeys[10]+ButtonSep\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Left, AlignV_Middle)\n     addText(L_units, FontText, Units[i], x, y)\n    end\n\n    for i=1, #Tick do\n     if i%2==1 then x=xKeys[5]+MenuKeyWidth/2+5\n     else x=xKeys[12]+ButtonSep end\n     if i<=2 then k=4 else k=5 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n     if ((i==2 and wp_altitude_inserted) or (i==4 and wp_speed_inserted)) then setNextFillColor(L_text, TitleR, TitleG, TitleB, 1) end\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n   end\n   wp_settings_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen Ship Settings\n  function settings1_Table_Function()\n   local Table=[[\n   local Title={\"Ship Settings\",\"MTOW\",\"Autobrake\",\"Dist. To WP\",\"Holding Speed\"}\n   local Units={\"t\",\"Su\",\"Km\",\"Km/h\"}\n   local Tick={\"]].. MTOW_tick ..[[\",\"]].. keypad_input_MTOW ..[[\",\"]].. autobrake_tick ..[[\",\"]].. keypad_input_autobrake ..[[\",\"]].. wp_dist_tick ..[[\",\"]].. keypad_input_wpdist ..[[\",\"]].. holding_tick ..[[\",\"]].. keypad_input_holding ..[[\"}\n   local MTOW_inserted=]].. tostring(MTOW_inserted) ..[[\n   local autobrake_stops_at_inserted=]].. tostring(autobrake_stops_at_inserted) ..[[\n   local wp_dist_inserted=]].. tostring(wp_dist_inserted) ..[[\n   local holding_speed_inserted=]].. tostring(holding_speed_inserted) ..[[\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if (i==6 or i==10) then\n      y1=MenuLines[4]\n      y2=MenuLines[8]\n     end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function settings1_Table_List_Function()\n    local x, y, k=0, 0, 3\n    for i=1, #Title do\n     local Align=AlignH_Center\n     if i==1 then x=xKeys[10]\n     else\n      x=xKeys[6]+ButtonSep\n      Align=AlignH_Left\n     end\n     if i>=2 then k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, Align, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    k=3\n    for i=1, #Units do\n     x=xKeys[10]+ButtonSep\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Left, AlignV_Middle)\n     addText(L_units, FontText, Units[i], x, y)\n    end\n\n    for i=1, #Tick do\n     local Align=AlignH_Left\n     if i%2==1 then x=xKeys[5]+MenuKeyWidth/2+5 Align=AlignH_Center\n     else x=xKeys[12]+ButtonSep end\n     if (i==1 or i==2) then k=4\n     elseif (i==3 or i==4) then k=5\n     elseif (i==5 or i==6) then k=6\n     elseif (i==7 or i==8) then k=7\n     end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, Align, AlignV_Middle)\n     if ((i==2 and MTOW_inserted) or\n      (i==4 and autobrake_stops_at_inserted) or\n      (i==6 and wp_dist_inserted) or\n      (i==8 and holding_speed_inserted)) then setNextFillColor(L_text, TitleR, TitleG, TitleB, 1)\n     end\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n   end\n   settings1_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen WP Store\n  function settings2_Table_Function()\n   local Table=[[\n   local Title={\"WP Store\",\"WP Coord\",\"WP Name\"}\n   local Units={\"Lat\",\"Lon\",\"Alt\"}\n   local Tick={\"]].. wp_selected_planet ..[[\",\"]].. wp_lat_tick ..[[\",\"]].. keypad_input_wp_lat ..[[\",\"]].. wp_name_tick ..[[\",\"]].. keypad_input_wp_name ..[[\",\"]].. wp_lon_tick ..[[\",\"]].. keypad_input_wp_lon ..[[\",\"]].. wp_alt_tick ..[[\",\"]].. keypad_input_wp_alt ..[[\"}\n   local Results={\"]].. stored ..[[\",\"]].. wp_coordinated_stored ..[[\"}\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==11 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if i==6 then y1=MenuLines[6] y2=MenuLines[7]\n     elseif (i==10 or i==11) then y1=MenuLines[4] y2=MenuLines[8]\n     elseif i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1\n     end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function settings2_Table_List_Function()\n    local x, y, k=0, 0, 3\n    for i=1, #Title do\n     local Align=AlignH_Center\n     if i==1 then x=xKeys[10]\n     elseif i==2 then x=xKeys[13]\n     elseif i==3 then x=xKeys[8]\n     end\n     if i>=2 then k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, Align, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    k=4\n    for i=1, #Units do\n     x=xKeys[11]+ButtonSep\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Left, AlignV_Middle)\n     addText(L_units, FontText, Units[i], x, y)\n    end\n\n    k=3\n    for i=1, #Tick do\n     local Align=AlignH_Left\n     if i==1 then x=xKeys[5]+ButtonSep\n     elseif (i==2 or i==6 or i==8) then x=xKeys[10]+MenuKeyWidth/2+5 Align=AlignH_Center\n     elseif (i==3 or i==7 or i==9) then x=xKeys[12]+ButtonSep\n     elseif i==4 then x=xKeys[5]+MenuKeyWidth/2+5 Align=AlignH_Center\n     elseif i==5 then x=xKeys[6]+ButtonSep\n     end\n     if i==1 then k=4\n     elseif (i==2 or i==3) then k=5\n     elseif (i>=4 and i<=7) then k=6\n     else k=7\n     end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, Align, AlignV_Middle)\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n    k=6\n    for i=1, #Results do\n     x=xKeys[5]+ButtonSep\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n     addText(L_text, FontText, Results[i], x, y)\n    end\n\n   end\n   settings2_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen WP Sync\n  function settings3_Table_Function()\n   local Table=[[\n   local Title={\"WP Sync\",\"Ship ID\",\"Data Stored\",\"WP:]]..keys_number..[[ - Fleet:]].. FleetNumber ..[[\"}\n   local Units={\"<< Downlink >>\",\">> Uplink <<\"}\n   local Tick={\"]].. shipid_tick ..[[\",\"]].. keypad_input_shipid ..[[\",\"]].. dwn_sync_tick ..[[\",\"]].. up_sync_tick ..[[\"}\n   local Results={\"]]..sync_result..[[\"}\n   local prog_bar=]].. prog_bar ..[[\n   local ShipIdCheck=]].. tostring(ShipIdCheck) ..[[\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==11 or i==14) then\n     local x1, y1, x2, y2, y3, y4=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9], MenuLines[6], MenuLines[7]\n     if i==6 then y1=MenuLines[4] y2=MenuLines[5]\n     elseif i==10 then y1=MenuLines[4] y2=MenuLines[7]\n     elseif i==11 then y1=y3 y2=y4\n     end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n     if i==6 then addLine(L_table, x1, y3, x2, y4) end\n    end\n   end\n\n   function settings3_Table_List_Function()\n    local x, y, k=0, 0, 2\n    for i=1, #Title do\n     local Align=AlignH_Center\n     if i==1 then x=xKeys[10]\n     elseif (i==2 or i==3) then x=xKeys[8]\n     else x=xKeys[12]+MenuKeyWidth/2+5\n     end\n     if i<=3 then k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, Align, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    for i=1, #Units do\n     if i==1 then x=xKeys[8] else x=xKeys[13] end\n     y=MenuLines[6]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Center, AlignV_Middle)\n     addText(L_units, FontText, Units[i], x, y)\n    end\n\n    for i=1, #Tick do\n     local Align=AlignH_Center\n     if i%2==1 then x=xKeys[5]+MenuKeyWidth/2+5\n     else x=xKeys[10]+MenuKeyWidth/2+5 end\n     if i==2 then x=xKeys[10]+ButtonSep Align=AlignH_Left end\n     if (i==1 or i==2) then k=4\n     else k=6 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, Align, AlignV_Middle)\n     if (i==2 and ShipIdCheck==true) then setNextFillColor(L_text, TitleR, TitleG, TitleB, 1) end\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n    for i=1, #Results do\n     x=xKeys[10]\n     y=MenuLines[8]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontText, Results[i], x, y)\n    end\n\n    if prog_bar>0 then\n     x=xKeys[5]+2\n     y=MenuLines[7]+2\n     width=((xKeys[14]+MenuKeyWidth-xKeys[5]-4)* prog_bar)/ 100\n     height=MenuLines[7]-MenuLines[6]-4\n     setNextFillColor(L_title, TitleR, TitleG, TitleB, 1)\n     addBox(L_title, x, y, width, height)\n    end\n\n   end\n   settings3_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen Colours\n  function settings4_Table_Function()\n   local Table=[[\n   local Title={\"Screen Colors\",\"Table Borders\",\"Titles\",\"Text\",\"Buttons Pressed\",\"Buttons\"}\n   local Tick={\"]].. tick_color_1 ..[[\",\"]].. keypad_input_color1 ..[[\",\"]].. tick_color_2 ..[[\",\"]].. keypad_input_color2 ..[[\",\"]].. tick_color_3 ..[[\",\"]].. keypad_input_color3 ..[[\",\"]].. tick_color_4 ..[[\",\"]].. keypad_input_color4 ..[[\",\"]].. tick_color_5 ..[[\",\"]].. keypad_input_color5 ..[[\"}\n   local Check={[2]=\"]].. tostring(RGBColor1) ..[[\",[4]=\"]].. tostring(RGBColor2) ..[[\",[6]=\"]].. tostring(RGBColor3) ..[[\",[8]=\"]].. tostring(RGBColor4) ..[[\",[10]=\"]].. tostring(RGBColor5) ..[[\"}\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if (i>5 and i<14) then y1=MenuLines[4] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function settings4_Table_List_Function()\n    local x, y, k=0, 0, 2\n    for i=1, #Title do\n     local Align=AlignH_Left\n     if i==1 then x=xKeys[10] Align=AlignH_Center\n     else x=xKeys[6]+ButtonSep end\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, Align, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    k=3\n    for i=1, #Tick do\n     local Align=AlignH_Left\n     if i%2==1 then x=xKeys[5]+MenuKeyWidth/2+5 Align=AlignH_Center\n     else x=xKeys[10]+ButtonSep end\n     if i%2==1 then k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     if i%2==0 then\n      if Check[i]==\"true\" then setNextFillColor(L_text, TitleR, TitleG, TitleB, 1) end\n     end\n     setNextTextAlign(L_text, Align, AlignV_Middle)\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n   end\n   settings4_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen DMG Report\n  function settings5_Table_Function()\n   local Table=[[\n   local Title={\"DMG Report Position\",\"Top View\",\"Side View\",\"Scale\",\"Factor\"}\n   local Units={\"UP\",\"LH\",\"DN\",\"RH\"}\n   local Tick={\"]].. tick_dmg_1 ..[[\",\"]]..tick_dmg_2..[[\"}\n   local Results={\"]].. keypad_input_dmg1 ..[[\",\"]]..keypad_input_dmg2..[[\"}\n   local Operators={\"-\",\"+\",\" - \",\" + \"}\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==11 or i==12 or i==13 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if i==6 then y1=MenuLines[4] y2=MenuLines[6]\n     elseif i==10 then y1=MenuLines[4] y2=MenuLines[6] y3=MenuLines[7] y4=MenuLines[9]\n     elseif i==11 then y1=MenuLines[5] y2=MenuLines[6] y3=MenuLines[7] y4=MenuLines[9]\n     elseif (i==12 or i==13) then y1=MenuLines[4] y2=MenuLines[6]\n     elseif i==14 then x3=xKeys[i]+MenuKeyWidth x4=x3 y1=MenuLines[5] y2=MenuLines[6] y3=MenuLines[7] y4=MenuLines[9]\n     end\n     addLine(L_table, x1, y1, x2, y2)\n     if (i==10 or i==11 or i==14) then addLine(L_table, x1, y3, x2, y4) end\n     if i==14 then\n      y1, y2=MenuLines[3], MenuLines[9]\n      addLine(L_table, x3, y1, x4, y2)\n     end\n    end\n   end\n\n   function settings5_Table_List_Function()\n    local x, y, k, xCur1, xCur2, yCur1, yCur2=0, 0, 2, 0, 0, 0, 0\n    for i=1, #Title do\n     x=xKeys[6]+ButtonSep\n     local Align=AlignH_Left\n     if i==1 then x=xKeys[10] Align=AlignH_Center\n     elseif (i==4 or i==5) then x=xKeys[5]+ButtonSep\n     end\n     if i<=3 then k=k+1\n     elseif i==4 then k=7 \n     elseif i==5 then k=8\n     end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, Align, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    for i=1, #Units do\n     x=xKeys[12]+MenuKeyWidth/2+5\n     xCur1=xKeys[12]\n     xCur2=xCur1+MenuKeyWidth\n     if i==2 then x=xKeys[11]+MenuKeyWidth/2+5 xCur1=xKeys[11] xCur2=xCur1+MenuKeyWidth\n     elseif i==4 then x=xKeys[13]+MenuKeyWidth/2+5 xCur1=xKeys[13] xCur2=xCur1+MenuKeyWidth\n     end\n     if i>=2 then k=5 else k=4 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     yCur1=MenuLines[k]\n     yCur2=MenuLines[k]+MenuKeyHeight\n     setNextTextAlign(L_units, AlignH_Center, AlignV_Middle)\n     addText(L_units, FontText, Units[i], x, y)\n     if (cx>xCur1 and cx<xCur2 and cy>yCur1 and cy<yCur2) then\n      setNextFillColor(L_units, ButtonPressedR, ButtonPressedG, ButtonPressedB, 0.1)\n      addBox(L_units, xCur1+2, yCur1+2, MenuKeyWidth+7, MenuKeyHeight+7)\n      if getCursorDown() then setOutput(Units[i]) end\n     end\n    end\n\n    for i=1, #Tick do\n     x=xKeys[5]+MenuKeyWidth/2+5\n     y=MenuLines[i+3]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n\n    for i=1, #Results do\n     x=xKeys[12]+MenuKeyWidth/2+5\n     y=MenuLines[i+6]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontText, Results[i], x, y)\n    end\n\n    k=6\n    for i=1, #Operators do\n     x=xKeys[10]+MenuKeyWidth/2+5\n     xCur1=xKeys[10]\n     xCur2=xCur1+MenuKeyWidth\n     local Width, Height=MenuKeyWidth+7, MenuKeyHeight+7\n     if (i==2 or i==4) then x=xKeys[14]+MenuKeyWidth/2 xCur1=xKeys[14] xCur2=xCur1+MenuKeyWidth end\n     if i%2==1 then k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     yCur1=MenuLines[k]\n     yCur2=yCur1+MenuKeyHeight\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontTick, Operators[i], x, y)\n     if (cx>xCur1 and cx<xCur2 and cy>yCur1 and cy<yCur2) then\n      setNextFillColor(L_text, ButtonPressedR, ButtonPressedG, ButtonPressedB, 0.1)\n      if (i==2 or i==4) then Width=MenuKeyWidth-5 end\n      addBox(L_text, xCur1+2, yCur1+2, Width, Height)\n      if getCursorDown() then setOutput(Operators[i]) end\n     end\n    end\n\n   end\n   settings5_Table_List_Function()\n\n   requestAnimationFrame(10)\n   ]]\n   return Table\n  end\n\n --Screen DB Reset\n  function settings6_Table_Function()\n   local Table=[[\n   local Title={\"Databank Reset\",\"X to Keep\",\"Stored WP\",\"ENT to Change\",\"Ship Settings\",\"CLR to Execute\",\"Ship ID\",\"Screen Colors\",\"DMG Rep.\"}\n   local Tick={\"]]..tick_[1]..[[\",\"]]..db_mark_1..[[\",\"]]..tick_[2]..[[\",\"]]..db_mark_2..[[\",\"]]..tick_[3]..[[\",\"]]..db_mark_3..[[\",\"]]..tick_[4]..[[\",\"]]..db_mark_4..[[\",\"]]..tick_[5]..[[\",\"]]..db_mark_5..[[\"}\n   local Results={\"]]..reset_db_status..[[\",\"]].. reset_db_status2 ..[[\"}\n   \n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2, x3, x4=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i], xKeys[6], xKeys[10]\n     if (i==5 or i==6 or i==8) then\n      addLine(L_table, x1, y1, x3, y2)\n      addLine(L_table, x4, y1, x2, y2)\n     else addLine(L_table, x1, y1, x2, y2) end\n    end\n  \n    if (i==5 or i==6 or i==10 or i==11 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if (i==6 or i==10 or i==11) then y1=MenuLines[4] y2=MenuLines[9]\n     elseif i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1\n     end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n   \n   function settings6_Table_List_Function()\n    local x, y, k=0, 0, 3\n    for i=1, #Title do\n     local Align=AlignH_Left\n     if i==1 then x=xKeys[10] Align=AlignH_Center\n     elseif (i==2 or i==4 or i==6) then x=xKeys[6]+ButtonSep \n     elseif (i==3 or i==5 or i>=7) then x=xKeys[11]+ButtonSep\n     end\n     if (i%2==0 and i<=7) then k=k+1\n     elseif i>=8 then k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, Align, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n     \n    k=3\n    for i=1, #Tick do\n     if i%2==1 then x=xKeys[5]+MenuKeyWidth/2+5\n     else x=xKeys[10]+MenuKeyWidth/2+5 end\n     if i%2==1 then k=k+1 end\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontTick, Tick[i], x, y)\n    end\n   \n    for i=1, #Results do\n     x=xKeys[6]+ButtonSep\n     y=MenuLines[i+6]+MenuKeyHeight/2+5\n     if Results[i]==\"Restart The Interface\" then setNextFillColor(L_text, 1, 0, 0, 1) end\n     setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n     addText(L_text, FontText, Results[i], x, y)\n    end\n   \n   end\n   settings6_Table_List_Function()\n   ]]\n   return Table\n  end\n\n --Screen Routes\n  function settings7_Table_Function()\n   local Table=[[\n   local routes_page_index=]].. routes_page_index ..[[\n   local routes_pages=]].. routes_pages ..[[\n   local routes_wp_page_index=]].. routes_wp_page_index ..[[\n   local routes_wp_pages=]].. routes_wp_pages ..[[\n   local RouteCounter=]].. RouteCounter ..[[\n   local Title={\"ROUTES\",\"Page \".. routes_page_index ..\"/\".. routes_pages ,\"WP\",\"Page \".. routes_wp_page_index ..\"/\".. routes_wp_pages}\n   local route_tick_={]].. RouteTickList:gsub(\"[%[%]]+\",\"\") ..[[}\n   local wp_tick_={]].. WpTickList:gsub(\"[%[%]]+\",\"\") ..[[}\n   local input=json.decode(getInput()) or {}\n   local routes_list=input[1]\n   local WpRouteList=input[2]\n   local DistanceList=input[3]\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==6 or i==10 or i==11 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if (i==6 or i==11) then y1=MenuLines[4] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function settings7_Table_List_Function()\n    if Selected==nil then Selected=false end\n    local x, y, k=0, 0, 3\n    local RouteIndex=(routes_page_index*5)-4\n    local wp_tick_index=(routes_wp_page_index*5)-4\n\n    for i=1, #Title do\n     if i==1 then x=xKeys[5]+ButtonSep\n     elseif i==2 then x=xKeys[8]\n     elseif i==3 then x=xKeys[10]+ButtonSep\n     elseif i==4 then x=xKeys[13]\n     end\n     y=MenuLines[3]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, AlignH_Left, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    for i=RouteIndex, (RouteIndex+4) do\n     x=xKeys[5]+MenuKeyWidth/2+5\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontTick, route_tick_[i], x, y)\n    end\n\n    k=3\n    for i=wp_tick_index, (wp_tick_index +4) do\n     if wp_tick_[i]==nil then wp_tick_[i]=\"\" end\n     x=xKeys[10]+MenuKeyWidth/2+5\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_text, AlignH_Center, AlignV_Middle)\n     addText(L_text, FontTick, wp_tick_[i], x, y)\n    end\n\n    k=3\n    for i=RouteIndex, (RouteIndex +4) do\n     if i<=RouteCounter then\n      route_name=routes_list[i].route\n      x=xKeys[6]+ButtonSep\n     else route_name=\"\" end\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     if (cx>x and cx<xKeys[10] and cy>MenuLines[k] and cy<MenuLines[k]+MenuKeyHeight+ButtonSep) then\n      setNextTextAlign(L_select, AlignH_Left, AlignV_Middle)\n      addText(L_select, FontText, route_name, x, y)\n      if getCursorDown() then\n       Selected=true\n       SelectedID=route_name\n       setOutput(route_name)\n      end\n     else\n      setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n      addText(L_text, FontText, route_name, x, y)\n     end\n    end\n\n    k=3\n    for i=wp_tick_index, (wp_tick_index +4) do\n     local wp=\"wp\"..i\n     local route_wp_name=\"\"\n     if WpRouteList~=nil then\n      local wpn=WpRouteList[wp]\n      if wpn and wpn~=\"\" then\n       route_wp_name=WpRouteList[wp]\n       x=xKeys[11]+ButtonSep\n      end\n     end\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     setNextTextAlign(L_units, AlignH_Left, AlignV_Middle)\n     addText(L_units, FontText, route_wp_name, x, y)\n    end\n\n    if Selected then\n     setNextTextAlign(L_selected, AlignH_Center, AlignV_Middle)\n     addText(L_selected, FontText, SelectedID, xKeys[3], MenuLines[4]+MenuKeyHeight/2) \n    end\n\n   end\n   settings7_Table_List_Function()\n\n   requestAnimationFrame(10)\n   ]]\n   return Table\n  end\n\n --Screen Routing\n  function route_page_Table_Function()\n   local Table=[[\n   local selected_route_name=\"]].. selected_route_name ..[[\"\n   local selected_route_page_index=]].. selected_route_page_index ..[[\n   local selected_route_pages=]].. selected_route_pages ..[[\n   local Title={\"Route: \".. selected_route_name,\"Page \".. selected_route_page_index ..\"/\".. selected_route_pages}\n   local input=json.decode(getInput()) or {}\n   local WpSettingsList=input[1]\n   local WpRouteList=input[2] or {}\n   local DistanceList=input[3] or {}\n   local distance=\"\"\n\n   local ListFix={}\n   for i, v in pairs(WpRouteList) do ListFix[tonumber(i)]=v end\n   WpRouteList=ListFix\n   ListFix={}\n   for i, v in pairs(DistanceList) do ListFix[tonumber(i)]=v end\n   DistanceList=ListFix\n\n   for i=3, 14 do\n    if i<=8 then\n     local x1, y1, x2, y2=xKeys[5], MenuLines[i], xKeys[14]+MenuKeyWidth, MenuLines[i]\n     addLine(L_table, x1, y1, x2, y2)\n    end\n\n    if (i==5 or i==10 or i==14) then\n     local x1, y1, x2, y2=xKeys[i], MenuLines[3], xKeys[i], MenuLines[9]\n     if i==10 then y1=MenuLines[4] end\n     if i==14 then x1=xKeys[i]+MenuKeyWidth x2=x1 end\n     addLine(L_table, x1, y1, x2, y2)\n    end\n   end\n\n   function route_page_Table_List_Function()\n    local x, xSel, y, k, xDis, Unit=0, 0, 0, 2, 0, \"\"\n    local Align=AlignH_Left\n    local wp_tick_index=(selected_route_page_index*5)-4\n    for i=1, #Title do\n     if i==1 then x=xKeys[5]+ButtonSep\n     else x=xKeys[12] end\n     y=MenuLines[3]+MenuKeyHeight/2+5\n     setNextTextAlign(L_title, Align, AlignV_Middle)\n     addText(L_title, FontTitle, Title[i], x, y)\n    end\n\n    k=3\n    for i=wp_tick_index, (wp_tick_index +4) do\n     Align=AlignH_Left\n     x=xKeys[5]+ButtonSep\n     xSel=x\n     k=k+1\n     y=MenuLines[k]+MenuKeyHeight/2+5\n     local route_wp_name=WpRouteList[i]\n     local route_wp_nameMOD=\"\"\n     if route_wp_name==nil then route_wp_name=\"\" end\n     local CkSetting=route_wp_name:gsub(\"To \", \"\")\n     if WpSettingsList[CkSetting] then\n      if (WpSettingsList[CkSetting].alt~=\"\" or WpSettingsList[CkSetting].s~=\"\") then\n      setNextFillColor(L_text, 0, 1, 0, 1)\n      end\n     end\n     if string.match(route_wp_name, \"To \") then\n       route_wp_name=route_wp_name:gsub(\"To \", \"\")\n      route_wp_nameMOD=\">> \".. route_wp_name ..\" <<\"\n      Align=AlignH_Center\n      x=xKeys[7]+MenuKeyWidth/2+5\n     else route_wp_nameMOD=route_wp_name end\n     if (cx>xSel and cx<xKeys[10] and cy>MenuLines[k] and cy<MenuLines[k]+MenuKeyHeight+ButtonSep) then\n      setNextTextAlign(L_select, Align, AlignV_Middle)\n      addText(L_select, FontText, route_wp_nameMOD, x, y)\n      if getCursorDown() then\n       Selected=true\n       SelectedID=route_wp_name\n       setOutput(\"WpID \"..i)\n      end\n     else\n      setNextTextAlign(L_text, Align, AlignV_Middle)\n      addText(L_text, FontText, route_wp_nameMOD, x, y)\n     end\n     if DistanceList[i] then\n      distance=DistanceList[i]\n      local checkSu=string.find(distance, \"Su\")\n      local checkKm=string.find(distance, \"Km\")\n      if checkSu then Unit=\"Su\" distance=distance:gsub(\"%a\", \"\")\n      elseif checkKm then Unit=\"Km\" distance=distance:gsub(\"%a\", \"\")\n      end\n      x=xKeys[10]+ButtonSep\n      setNextFillColor(L_text, FontColorR, FontColorG, FontColorB, 1)\n      setNextTextAlign(L_text, AlignH_Left, AlignV_Middle)\n      addText(L_text, FontText, distance, x, y)\n      if (distance~=\"\" and distance~=\"Wrong Wp Name\" and distance~=\"Holding\") then\n       x=xKeys[14]\n       setNextTextAlign(L_units, AlignH_Left, AlignV_Middle)\n       addText(L_units, FontText, Unit, x, y)\n      end\n     end\n    end\n\n    if Selected then\n     setNextTextAlign(L_selected, AlignH_Center, AlignV_Middle)\n     addText(L_selected, FontText, SelectedID, xKeys[3], MenuLines[4]+MenuKeyHeight/2) \n    end\n\n   end\n   route_page_Table_List_Function()\n\n   requestAnimationFrame(10)\n   ]]\n   return Table\n  end\n\n --RENDER\n  function ScreenRender()\n   local Menu_Interface=Parameters .. Setup .. MenuLists .. MenuButtons .. KkeypadButtons .. KeysButton .. CursorClick\n   local DISPLAY=\"\"\n   \n   if screenState==0 then stored_waypoints_1() DISPLAY=WPStore_Table_Function()\n   elseif screenState==1 then su_distance_time() DISPLAY=SuDistanceTime_Table_Function()\n   elseif screenState==2 then from() DISPLAY=from_Table_Function()\n   elseif screenState==3 then distance_to_wp() DISPLAY=distance_to_wp_Table_Function()\n   elseif screenState==4 then target_pe_altitude() DISPLAY=target_pe_altitude_Table_Function()\n   elseif screenState==5 then settings1() DISPLAY=settings1_Table_Function()\n   elseif screenState==6 then atlas_list_page() DISPLAY=ATLAS_Table_Function()\n   elseif screenState==7 then settings2() DISPLAY=settings2_Table_Function()\n   elseif screenState==8 then settings3() DISPLAY=settings3_Table_Function()\n   elseif screenState==9 then DISPLAY=settings_menu_Table_Function()\n   elseif screenState==10 then DISPLAY=settings4_Table_Function()\n   elseif screenState==11 then DISPLAY=settings5_Table_Function()\n   elseif screenState==12 then DISPLAY=settings6_Table_Function()\n   elseif screenState==13 then agg() DISPLAY=agg_Table_Function()\n   elseif screenState==14 then settings7() DISPLAY=settings7_Table_Function()\n   elseif screenState==15 then route_page() DISPLAY=route_page_Table_Function()\n   elseif screenState==16 then wp_settings() DISPLAY=wp_settings_Table_Function()\n   elseif screenState==17 then shieldFunction() DISPLAY=shield_Table_Function()\n   end\n\n   local Status=DataStatus_Table_Function()\n\n   local Screen=Menu_Interface .. DISPLAY .. Status\n   screen.setRenderScript(Screen)\n  end\n  ScreenRender()\n\n end\n LuaScreen()","filter":{"args":[],"signature":"start()","slotKey":"-1"},"key":"2"},{"code":"--unit.stop()\n screen.clear()\n screen.deactivate()","filter":{"args":[],"signature":"stop()","slotKey":"-1"},"key":"3"},{"code":"--unit.tick(\"delay\")\n delay_timer=delay_timer-1\n if delay_timer==0 then\n  unit.stopTimer(\"delay\")\n  if delay_id==\"SyncData\" then sync_data()\n  elseif delay_id==\"ShipIDResponse\" then\n   if (sync_result==\"Ship ID Sent\" or sync_result==\"Downlink Requested\") then sync_result=\"No Response\" LuaScreen() end\n  end\n end","filter":{"args":[{"value":"delay"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"4"},{"code":"--unit.tick(\"Ship_Id\")\n ship_id_verified=false\n WP_request=false\n unit.stopTimer(\"Ship_Id\")","filter":{"args":[{"value":"Ship_Id"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"5"},{"code":"--unit.tick(\"routing\")\n if (screenState==15 or screenState==16 or screenState==9 or screenState==5) then\n\n  local myPos=vec3(core.getConstructWorldPos())\n  local distance=\"\"\n  for i, v in pairs(WpRouteList) do\n   local wp=v\n   if WPCoordinates[i] then\n    distance=math.floor(((vec3(WPCoordinates[i]) - myPos):len())/1000*100)/100\n    if distance>200 then DistanceList[i]=math.floor((distance/200)*100)/100 ..\" Su\"\n    else DistanceList[i]=distance ..\" Km\" end\n   elseif (wp==\"To HOLD\" or wp==\"To hold\" or wp==\"HOLD\" or wp==\"hold\") then DistanceList[i]=\"Holding\"\n   elseif (wp==\"\" or wp==\"To \") then DistanceList[i]=\"\"\n   else DistanceList[i]=\"Wrong Wp Name\" end\n  end\n    \n  screen.setScriptInput(json.encode({WpSettingsList,WpRouteList,DistanceList}))\n\n  routing_timer=true\n  RouteLoop=false\n  local distance=DistanceList[DistToNextWp] or \"\"\n  if (distance==\"Holding\" or distance==\"Wrong Wp Name\") then\n   unit.stopTimer(\"routing\")\n   next_wp_selected=false\n   databank.setIntValue(\"Holding\", 1)\n  elseif (distance~=\"Holding\" and distance~=\"\") then\n   distance=distance:gsub(\"%a\", \"\")\n   if tonumber(distance)~=nil then\n    distance=tonumber(distance)\n    local d=math.sqrt((wp_sequencing_distance)^2 + ((math.floor(core.getAltitude())/1000)^2))\n    if (distance<d) then\n     unit.stopTimer(\"routing\")\n     next_wp_selected=true\n     databank.setIntValue(\"Holding\", 0)\n     LuaScreen()\n    end\n   end\n  else\n   first_wp_selected=false\n   databank.setIntValue(\"Holding\", 0)\n   unit.stopTimer(\"routing\")\n   LuaScreen()\n  end\n else\n  databank.setIntValue(\"Holding\", 0)\n  routing_timer=false\n  unit.stopTimer(\"routing\")\n end","filter":{"args":[{"value":"routing"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"6"},{"code":"--unit.tick(\"agg\")\n if screenState==13 then\n  if agg_target_altitude==true then keypad_input_agg_target_alt=databank.getIntValue(\"agg_t_alt\") end\n  LuaScreen()\n else unit.stopTimer(\"agg\") end","filter":{"args":[{"value":"agg"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"7"},{"code":"--unit.tick(\"shield\")\nif screenState==17 then\n shieldFunction()\nelse unit.stopTimer(\"shield\") end","filter":{"args":[{"value":"shield"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"8"},{"code":"--unit.tick(\"PVPStation\")\n if PVPStationIsON==nil then PVPStationIsON=false end\n if databank.getStringValue(\"PVPStation\")==\"ON\" then PVPStationIsON=true\n else PVPStationIsON=false end\n\n if PVPStationIsON then\n  HUD_HTML={} \n  system.setScreen(PVPInfoFunction())\n  system.showScreen(1)\n else system.showScreen(0) end","filter":{"args":[{"value":"PVPStation"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"9"},{"code":"--system.inputText(*)\n input_text=text\n\n if (screenState==1 and tonumber(input_text)~=nil) then\n  if su_tick==\">\" then keypad_input_su=input_text\n  elseif speed_tick==\">\" then keypad_input_speed=input_text\n  end\n  ent_button()\n elseif screenState==2 then\n  if FROM_tick==\">\" then keypad_input_from=input_text\n  elseif WPADD_tick==\">\" then keypad_input_wpname=input_text\n  end\n  ent_button()\n elseif screenState==3 then keypad_input_dest=input_text\n  ent_button()\n elseif (screenState==4 and tonumber(input_text)~=nil) then\n  keypad_input_pe_target_alt=input_text\n  target_pe_altitude_inserted=false\n  status_TA=\"\"\n  target_alt_warning=\"\"\n  ent_button()\n elseif (screenState==5 and tonumber(input_text)~=nil) then\n  if MTOW_tick==\">\" then keypad_input_MTOW=input_text\n  elseif autobrake_tick==\">\" then keypad_input_autobrake=input_text\n  elseif wp_dist_tick==\">\" then keypad_input_wpdist=input_text\n  elseif holding_tick==\">\" then keypad_input_holding=input_text\n  end\n  ent_button()\n elseif screenState==7 then\n  local check0=string.find(input_text, \"::pos{\")\n  local check00=string.find(input_text, \"::pos{0,0,\")\n  if check0 then\n   local pos=input_text\n   local num=' *([+-]?%d+%.?%d*e?[+-]?%d*)'\n   local posPattern='::pos{0,' .. num .. ',' ..  num .. ',' .. num ..  ',' .. num .. '}'\n   local bodyId, latitude, longitude, altitude=string.match(pos, posPattern);\n   for i, v in pairs(atlas[0]) do\n    if atlas[0][i].id==tonumber(bodyId) then wp_selected_planet=atlas[0][i].name[1] break\n    elseif check00 then wp_selected_planet=\"World Coordinates\"\n    else wp_selected_planet=\"Invalid Entry\" end\n   end\n   input_text=\"\"\n   wp_name_tick=\">\"   \n   keypad_input_wp_lat=tonumber(latitude)\n   keypad_input_wp_lon=tonumber(longitude)\n   keypad_input_wp_alt=tonumber(altitude)\n  end\n  if wp_name_tick==\">\" then\n   keypad_input_wp_name=input_text\n  elseif (wp_lat_tick==\">\" and tonumber(input_text)~=nil) then keypad_input_wp_lat=input_text\n  elseif (wp_lon_tick==\">\" and tonumber(input_text)~=nil) then keypad_input_wp_lon=input_text\n  elseif (wp_alt_tick==\">\" and tonumber(input_text)~=nil) then keypad_input_wp_alt=input_text\n  end\n elseif screenState==8 then\n  if shipid_tick==\">\" then keypad_input_shipid=input_text end\n  ent_button()\n elseif screenState==10 then\n  if tick_color_1==\">\" then keypad_input_color1=input_text\n  elseif tick_color_2==\">\" then keypad_input_color2=input_text\n  elseif tick_color_3==\">\" then keypad_input_color3=input_text\n  elseif tick_color_4==\">\" then keypad_input_color4=input_text\n  elseif tick_color_5==\">\" then keypad_input_color5=input_text\n  end\n  ent_button()\n elseif (screenState==13 and agg_target_altitude==true and tonumber(input_text)~=nil) then\n  keypad_input_agg_target_alt=input_text\n  agg_target_altitude=false\n  ent_button()\n elseif screenState==14 then\n  route_tick_index=(routes_page_index*5)-4\n  for i=route_tick_index, (route_tick_index +4) do\n   if (route_tick_[i]==\">\" and (routes_list[i]==\"\" or routes_list[i]==nil)) then\n    local check=databank.getStringValue(\"Route\"..i)\n    if check~=\"\" then\n     local DbKeys=databank.getNbKeys()\n     for x=1, DbKeys do\n      local find=databank.getStringValue(\"Route\"..x)\n      if find==\"\" then i=x break end\n     end\n    end\n    new_route_id=\"Route\"..i\n    keypad_input_route=input_text\n    routing(new_route_id, keypad_input_route)\n    break\n   elseif (route_tick_[i]==\"*\") then\n     local route_id=\"Route\"..i\n     local wp=\"wp\"..wp_tick_n\n     if (wp_tick_[wp_tick_n]==\">\") then\n      local id=\"wp\"..wp_tick_n\n      keypad_input_wp_route=input_text\n      add_wp_to_route(id, keypad_input_wp_route)\n      wp_tick_n=wp_tick_n +1\n      if wp_tick_n > (wp_tick_index +4) then wp_tick_n=(wp_tick_index +4) end\n      wp_tick_[wp_tick_n -1]=\"\"\n      wp_tick_[wp_tick_n]=\">\"   \n     end\n    end\n  end\n elseif (screenState==16 and tonumber(input_text)~=nil) then\n  if wp_altitude_tick==\">\" then keypad_input_wp_altitude=input_text\n  elseif wp_speed_tick==\">\" then keypad_input_wp_speed=input_text\n  end\n  ent_button()\n end\n LuaScreen()","filter":{"args":[{"variable":"*"}],"signature":"inputText(text)","slotKey":"-2"},"key":"10"},{"code":"--system.actionLoop(lshift)\n L_SHIFT=true","filter":{"args":[{"value":"lshift"}],"signature":"actionLoop(action)","slotKey":"-2"},"key":"11"},{"code":"--system.actionStop(lshift)\n L_SHIFT=false","filter":{"args":[{"value":"lshift"}],"signature":"actionStop(action)","slotKey":"-2"},"key":"12"},{"code":"--system.actionStart(gear)\n if shield and L_SHIFT then\n  if shield.isVenting()==1 then shield.stopVenting() else shield.startVenting() end\n end ","filter":{"args":[{"value":"gear"}],"signature":"actionStart(action)","slotKey":"-2"},"key":"13"}],"methods":[],"events":[]}