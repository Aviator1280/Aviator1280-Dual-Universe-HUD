{"slots":{"0":{"name":"slot6","type":{"events":[],"methods":[]}},"1":{"name":"databank","type":{"events":[],"methods":[]}},"2":{"name":"core","type":{"events":[],"methods":[]}},"3":{"name":"receiver","type":{"events":[],"methods":[]}},"4":{"name":"emitter","type":{"events":[],"methods":[]}},"5":{"name":"slot7","type":{"events":[],"methods":[]}},"6":{"name":"shield","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-2":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"--receiver.receiver(*,*)\n local DownlinkApproved=string.find(message, \"<DownlinkApproved>\")\n local ConstructIDRqst=string.find(message, \"<ConstructIDRqst>\")\n local BaseShipId=string.find(message, \"<BaseShipId>\")\n local WPBaseData=string.find(message, \"<WPBaseData>\")\n local FleetBaseData=string.find(message, \"<FleetBaseData>\")\n local BaseData_n=string.find(message, \"<BaseData_n>\")\n local SendDataTo=string.find(message, \"<SendDataTo>\")\n\n if SendDataTo then\n  SendDataTo=string.gsub(message, \"<SendDataTo>\", \"\")\n  if (SendDataTo==ship_id or SendDataTo==\"ALL\") then WP_request=true end\n end\n\n if DownlinkApproved then\n  local CheckShipID=string.gsub(message, \"<DownlinkApproved>\", \"\")\n  if CheckShipID==ship_id then sync_data() end\n end\n\n if ConstructIDRqst then\n  local CheckShipID=string.gsub(message, \"<ConstructIDRqst>\", \"\")\n  if CheckShipID==ship_id then\n   local ConstructID=core.getConstructId()\n   emitter.send(\"AviatorHUD\", \"<\"..ship_id..\">\"..ConstructID)\n  end\n end\n\n if BaseShipId then\n  base_ship_id=string.gsub(message, \"<BaseShipId>\", \"\")\n  ship_id_verified=false\n  if base_ship_id==ship_id then\n   ship_id_verified=true\n   reqst_waypoints()\n  end\n end\n\n if WPBaseData and (ship_id_verified==true or WP_request==true) then\n  msg_counter=msg_counter+1\n  system.print(ship_id..\" RECEIVED WP:\"..msg_counter..\" of \"..receiving_wp)\n  sync_result='>> WP Uplink << '..msg_counter ..'/'..receiving_wp\n  prog_bar=(msg_counter * 496)/receiving_wp\n  msg_received=true\n  rcv_msg=message:gsub(\"@@@\",\"\\\"\")\n  rcv_msg=string.gsub(rcv_msg, \"<WPBaseData>\", \"\")\n  rcv_msg=json.decode(rcv_msg)\n  receiving_data()\n  unit.setTimer(\"Ship_Id\", 5)\n end\n\n if FleetBaseData and (ship_id_verified==true or WP_request==true) then\n  fleet_msg_counter=fleet_msg_counter+1\n  system.print(ship_id..\" RECEIVED Ship Data:\"..fleet_msg_counter..\" of \"..receiving_wp)\n  sync_result='>> Fleet Data Uplink << '..fleet_msg_counter ..'/'..receiving_wp\n  prog_bar=(fleet_msg_counter * 496)/receiving_wp\n  msg_received=true\n  rcv_msg=message:gsub(\"@@@\",\"\\\"\")\n  rcv_msg=string.gsub(rcv_msg, \"<FleetBaseData>\", \"\")\n  rcv_msg=json.decode(rcv_msg)\n  receiving_FleetData()\n  unit.setTimer(\"Ship_Id\", 5)\n end\n\n if BaseData_n then receiving_wp=string.gsub(message, \"<BaseData_n>\", \"\") end","filter":{"args":[{"variable":"*"},{"variable":"*"}],"signature":"receive(channel,message)","slotKey":"3"},"key":"0"},{"code":"--SETUP\n function Setup()\n  local SoftwareVersion=\"v4.0.0\"\n  databank.setStringValue(\"Navigator Interface No Scr ver\", SoftwareVersion)\n  ScrW=system.getScreenWidth()\n  ScrH=system.getScreenHeight()\n  xStart=ScrW/4\n  yStart=ScrH/5\n  MenuW=ScrW/10\n  MenuY=ScrH/30\n  MENU_ON=true --export\n  L_SHIFT=false\n  L_ALT=false\n  PVPStationIsON=false\n  if shield then unit.setTimer(\"PVPStation\", 1) end\n  if receiver then receiver.setChannels(\"AviatorWPBaseSync\") end\n  atlas=require('atlas')\n end\n Setup()\n\n--DATABANK INITIALIZATION\n Databank_Soft_Reset=false --export\n Databank_Hard_Reset=false --export\n function databank_initialization()\n  databank.setStringValue(\"databank_verification\", \"Verified\")\n  databank.setStringValue(\"Ship ID\", \"No ID\")\n  databank.setFloatValue(\"navigator_speed\", \"n/a\")\n  databank.setFloatValue(\"navigator_distance\", \"n/a\")\n  databank.setStringValue(\"navigator_target_destination\", \"no Dest.\")\n  databank.setStringValue(\"navigator_coordinates\", \"n/a\")\n  databank.setFloatValue(\"navigator_eta_h\", 0)\n  databank.setFloatValue(\"navigator_eta_m\", 0)\n  databank.setFloatValue(\"navigator_eta_s\", 0)\n  databank.setStringValue(\"navigator_from_coordinates\", \"n/a\")\n  databank.setStringValue(\"navigator_from\", \"no From\")\n  databank.setFloatValue(\"navigator_pe_target_altitude\", factory_PE_target_altitude)\n  databank.setFloatValue(\"navigator_from_planet_radius\", 0)\n  databank.setFloatValue(\"navigator_target_planet_radius\", 0)\n  factory_autobrake=2.3\n  databank.setFloatValue(\"navigator_autobrake\", factory_autobrake)\n  factory_MTOW=730000\n  databank.setFloatValue(\"navigator_MTOW\", factory_MTOW)\n  wp_sequencing_distance=0.5\n  databank.setFloatValue(\"navigator_wpdist\", wp_sequencing_distance)\n  databank.setStringValue(\"SCRFontColor\", \"{217,217,217}\")\n  databank.setStringValue(\"SCRButtonColor\", \"{0,0,255}\")\n  databank.setStringValue(\"SCRTableColor\", \"{0,0,255}\")\n  databank.setStringValue(\"SCRFontTitle\", \"{255,255,0}\")\n  databank.setStringValue(\"SCRButtonPressed\", \"{255,0,0}\")\n  databank.setStringValue(\"FontColor\", \"{217,217,217}\")\n  databank.setStringValue(\"Background\", \"{0,0,100}\")\n  databank.setStringValue(\"TableColor\", \"{0,0,255}\")\n  databank.setStringValue(\"FontTitle\", \"{255,255,0}\")\n  databank.setStringValue(\"Selection\", \"{0,100,200}\")\n  databank.setFloatValue(\"Alpha1\", 0.4)\n  databank.setFloatValue(\"Alpha2\", 0.8)\n  databank.setStringValue(\"wp_color\", \"none\")\n  databank.setStringValue(\"agg eng/stby\", \"STBY\")\n  databank.setStringValue(\"agg off/stby\", \"OFF\")\n  databank.setIntValue(\"agg_base\", 1000)\n  databank.setIntValue(\"agg_t_alt\", 1000)\n  databank.setStringValue(\"nav agg\", \"OFF\")\n  databank.setFloatValue(\"DMG Scale\", 3)\n  databank.setFloatValue(\"DMG TV U/D\", -20)\n  databank.setFloatValue(\"DMG TV L/R\", 30)\n  databank.setFloatValue(\"DMG SV U/D\", 40)\n  databank.setFloatValue(\"DMG SV L/R\", 100)\n  databank.setIntValue(\"holding_speed\", 300)\n  databank.setIntValue(\"Holding\", 0)\n  local check=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n  if check==\"\" then\n   local data={}\n   data=json.encode(data)\n   databank.setStringValue(\"wp_settings\", data:gsub(\"\\\"\",\"@@@\"))\n  end\n end\n if (Databank_Soft_Reset or databank.getStringValue(\"databank_verification\")~=\"Verified\") then databank_initialization() end\n if Databank_Hard_Reset then databank.clear() databank_initialization() end\n\n--PARAMETERS\n if (databank.getFloatValue(\"navigator_MTOW\")~=0) then\n  factory_MTOW=databank.getFloatValue(\"navigator_MTOW\")\n  new_MTOW=factory_MTOW/1000\n else\n  factory_MTOW=730000 --export\n  new_MTOW=factory_MTOW/1000\n end\n\n if (databank.getFloatValue(\"navigator_autobrake\")~=0) then\n  factory_autobrake=databank.getFloatValue(\"navigator_autobrake\")\n else\n  factory_autobrake=2.3 --export\n end\n factory_PE_target_altitude=20000 --export\n\n if (databank.getFloatValue(\"navigator_wpdist\")~=\"\") then\n  wp_sequencing_distance=databank.getFloatValue(\"navigator_wpdist\")\n else\n  wp_sequencing_distance=0.5 --export\n end\n\n if (databank.getIntValue(\"holding_speed\")~=0) then\n  holding_speed=databank.getIntValue(\"holding_speed\")\n else\n  holding_speed=300 --export\n end\n\n local FontColor=databank.getStringValue(\"FontColor\")\n  FontColor=json.decode(FontColor)\n  Font_R=FontColor[1]\n  Font_G=FontColor[2]\n  Font_B=FontColor[3]\n local ButtonColor=databank.getStringValue(\"Background\")\n  ButtonColor=json.decode(ButtonColor)\n  Button_R=ButtonColor[1]\n  Button_G=ButtonColor[2]\n  Button_B=ButtonColor[3]\n local TableColor=databank.getStringValue(\"TableColor\")\n  TableColor=json.decode(TableColor)\n  Table_R=TableColor[1]\n  Table_G=TableColor[2]\n  Table_B=TableColor[3]\n local FontTitle=databank.getStringValue(\"FontTitle\")\n  FontTitle=json.decode(FontTitle)\n  Title_R=FontTitle[1]\n  Title_G=FontTitle[2]\n  Title_B=FontTitle[3]\n local ButtonPressed=databank.getStringValue(\"Selection\")\n  ButtonPressed=json.decode(ButtonPressed)\n  Button_Pressed_R=ButtonPressed[1]\n  Button_Pressed_G=ButtonPressed[2]\n  Button_Pressed_B=ButtonPressed[3]\n local Alpha1=databank.getFloatValue(\"Alpha1\")\n local Alpha2=databank.getFloatValue(\"Alpha2\")\n\n--CSS\n function css_html()\n  HUD_HTML={}\n  HUD_HTML[#HUD_HTML+1]=[[\n  <style>\n   td {border:2px solid rgb(]].. Table_R ..[[,]].. Table_G ..[[,]].. Table_B ..[[);\n    color:rgb(]].. Font_R ..[[,]].. Font_G ..[[,]].. Font_B ..[[);\n    font-family:Arial;\n    font-size:15px;\n    text-align:center;\n    vertical-align:middle;}\n   .pvp {font-size:12px;}\n   .bkgnd {background:rgba(]].. Button_R ..[[,]].. Button_G ..[[,]].. Button_B ..[[,]].. Alpha1 ..[[)}\n   .bkgndSolid {background:rgba(]].. Button_R ..[[,]].. Button_G ..[[,]].. Button_B ..[[,]].. Alpha2 ..[[)}\n   .center {text-align:center}\n   .left {text-align:left}\n   .right {text-align:right}\n   .Fright {float:right}\n   .Fleft {float:left}\n   .Title {color:rgb(]].. Title_R ..[[,]].. Title_G ..[[,]].. Title_B ..[[) !important}\n   .Units {color:rgb(0,255,255) !important}\n   .select {background-color:rgb(]].. Button_Pressed_R ..[[,]].. Button_Pressed_G ..[[,]].. Button_Pressed_B ..[[)}\n   .green {color:rgb(0,255,0) !important}\n   .red {color:rgb(255,0,0) !important}\n  </style>]]\n  return HUD_HTML\n end\n\n--STRING CONVERTER TO VEC3\n function vec3FromStr(vStr) --to convert string to vec3\n  local v3={};\n  for num in string.gmatch(vStr, \"[-%d%.]+\") do\n   local vN=string.gsub(num, \"%+\", \"\")\n   table.insert(v3, tonumber(vN))\n  end\n  return vec3(table.unpack(v3))\n end\n\n--SET COORDINATES FROM ATLAS\n function set_coordinates(body)\n  planet_lat=body.center[1]\n  planet_lon=body.center[2]\n  planet_alt=body.center[3]\n\n  local world_coord=\"::pos{0,0,\"..planet_lat..\",\"..planet_lon..\",\"..planet_alt..\"}\"\n  system.setWaypoint(world_coord)\n end\n\n--SET COORDINATES FROM WP\n function set_wp_coordinates(body)\n  system.setWaypoint(\"::pos{0,0,\"..body:gsub(\"[()]\",\"\")..\"}\")\n end\n\n--WORLD TO VEC3 COORDINATES\n function coord_converter()\n  for i, v in pairs(atlas[0]) do\n   if atlas[0][i].name[1]==wp_selected_planet then\n    planet_center=vec3(atlas[0][i].center)\n    planet_radius=atlas[0][i].radius\n    planet_system=0\n   end\n  end\n\n  local wp_pos={system=planet_system, lat=tonumber(keypad_input_wp_lat), lon=tonumber(keypad_input_wp_lon), alt=tonumber(keypad_input_wp_alt)}\n  local deg2rad=math.pi/180\n  local lat_rad=wp_pos.lat * deg2rad\n  local lon_rad=wp_pos.lon * deg2rad\n  local xproj=math.cos(lat_rad)\n\n  return planet_center + (planet_radius + wp_pos.alt) * vec3(xproj*math.cos(lon_rad), xproj*math.sin(lon_rad), math.sin(lat_rad))\n end\n\n--GENERATING WP LIST PAGES\n function generating_wp_pages(option)\n  local dbKeys=databank.getNbKeys()\n  if option==0 then\n   if dbKeys>0 then\n    local counter=0\n    local wp_id=\"\"\n    for i=1, dbKeys do\n     wp_id=tostring(\"wp\"..i)\n     local name=databank.getStringValue(wp_id)\n     if (tostring(name)~=nil and tostring(name)~=\"\") then counter=counter + 1 end\n    end\n    pages=math.ceil(counter/10)\n    if pages==0 then pages=1 end\n   else\n    pages=1\n   end\n  end\n  return pages\n end\n wp_pages=generating_wp_pages(0)\n\n--WP CHECK\n function wp_check()\n  local dbn=databank.getNbKeys()\n  stored=\"\"\n  for i=1, dbn+1 do\n   local wp_id=tostring(\"wp\"..i)\n   local wp_checking=databank.getStringValue(wp_id)\n   if keypad_input_wpname==wp_checking then stored=\"WP Name Already Exist\" break end\n  end\n  if stored~=\"WP Name Already Exist\" then\n   for i=1, dbn+1 do\n    local wp_id=tostring(\"wp\"..i)\n    local wp_checking=databank.getStringValue(wp_id)\n    if wp_checking==\"\" then\n     local name=databank.setStringValue(wp_id, keypad_input_wpname)\n     local coord=databank.setStringValue(wp_id..\"_coord\", tostring(from_coordinates))\n     stored=\"STORED\"\n     break\n    end\n   end\n  end\n  wp_settings_init()\n end\n\n--ENT DESTINATION WP\n function ent_to_wp(x)\n  if (screenState==0 or RouteActivated) then\n   if (wp_list[x]~=nil) then\n    local dest=wp_list[x].id\n    if dest~=\"\" then\n     if (RouteActivated==false or RouteActivated==nil) then screenState=3 end\n     keypad_input_dest=dest\n     databank.setStringValue(\"to\", keypad_input_dest)\n     destination_inserted=false\n     destination_coord=\"\"\n     distance_to_go=\"\"\n     distance_to_go_warp=0\n     HUDScreen()\n     ent_button()\n    else\n     screenState=3\n     HUDScreen()\n    end\n   else\n    screenState=3\n    HUDScreen()\n   end\n  elseif screenState==6 then\n   local dest=atlas_list[x]\n   for i, v in pairs(atlas[0]) do\n    if dest==atlas[0][i].name[1] then\n     screenState=3\n     keypad_input_dest=dest\n     databank.setStringValue(\"to\", keypad_input_dest)\n     destination_inserted=false\n     destination_coord=\"\"\n     distance_to_go=\"\"\n     distance_to_go_warp=0\n     HUDScreen()\n     ent_button()\n     break\n    end\n   end\n  else\n   screenState=3\n   HUDScreen()\n  end\n end\n\n--ENT FROM WP\n function ent_from_wp(x)\n  FROMSelect={\"select\",\"\"}\n  if screenState==0 then\n   if (wp_list[x]~=nil) then\n    local from=wp_list[x].id\n    if from~=\"\" then\n     screenState=2\n     keypad_input_from=from\n     databank.setStringValue(\"from\", keypad_input_from)\n     from_coordinates=\"\"\n     from_inserted=false\n     FROMSelect[1]=\"select\"\n     keypad_input_wpname=\"\"\n     wpname_inserted=false\n     FROMSelect[2]=\"\"\n     stored=\"\"\n     HUDScreen()\n     ent_button()\n    else\n     screenState=2\n     HUDScreen()\n    end\n   else\n    screenState=2\n    HUDScreen()\n   end\n  elseif screenState==6 then\n   local from=atlas_list[x]\n   for i, v in pairs(atlas[0]) do\n    if from==atlas[0][i].name[1] then\n     screenState=2\n     keypad_input_from=from\n     databank.setStringValue(\"from\", keypad_input_from)\n     from_coordinates=\"\"\n     from_inserted=false\n     FROMSelect[1]=\"select\"\n     keypad_input_wpname=\"\"\n     wpname_inserted=false\n     FROMSelect[2]=\"\"\n     stored=\"\"\n     HUDScreen()\n     ent_button()\n     break\n    end\n   end\n  else\n   screenState=2\n   HUDScreen()\n  end\n end\n\n--WP SETTINGS INIT\n function wp_settings_init()\n  local dbKeys=databank.getNbKeys()\n\n  local check=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n  if check==\"\" then\n   local data={}\n   data=json.encode(data)\n   databank.setStringValue(\"wp_settings\", data:gsub(\"\\\"\",\"@@@\"))\n  else\n   check=json.decode(check)\n   for i, v in pairs(check) do\n    if (check[i].alt==\"\" and check[i].s==\"\") then check[i]=nil end\n   end\n   check=json.encode(check)\n   databank.setStringValue(\"wp_settings\", check:gsub(\"\\\"\",\"@@@\"))\n  end\n end\n wp_settings_init()\n\n--CREATE ROUTE\n function AddRemoveRoute()\n  if WpRouteList==nil then WpRouteList={} end\n  if DistanceList==nil then DistanceList={} end\n  if FlyStat==nil then FlyStat={} end\n  if GoTo==nil then GoTo={} end\n  if ItHasSettings==nil then ItHasSettings={} end\n  local x=WPSelected\n  if SelectionList[2]==\"select\" then --Settings > Route > Execute\n   if RouteExist then WpRouteList={} DistanceList={} FlyStat={} GoTo={} ItHasSettings={} MenuSelect={[0]=\"0\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"select\"} end\n  elseif ((SelectionList[5]==\"select\" or SelectionList[6]==\"select\") and wp_list[x]) then --WP > +Route/+Route and HOLD\n   local WpName=wp_list[x].name\n   for i=1, (#WpRouteList+1) do\n    if (WpRouteList[i]==nil or WpRouteList[i]==\"\") then\n     WpRouteList[i]=WpName\n     MenuSelect[i+8]=\"\"\n     DistanceList[i]=\"\"\n     FlyStat[i]=\"\"\n     GoTo[i]=\"Go To &#8594;\"\n     ItHasSettings[i]=\"\"\n     if SelectionList[6]==\"select\" then\n      WpRouteList[i+1]=\"HOLD\"\n      MenuSelect[i+1+8]=\"\"\n      DistanceList[i+1]=\"\"\n      FlyStat[i+1]=\"\"\n      GoTo[i+1]=\"\"\n      ItHasSettings[i+1]=\"\"\n     end\n     break\n    end\n   end\n  elseif (SelectionList[7]==\"select\" and wp_list[x]) then --WP > -Route\n   local WpName=wp_list[x].name\n   for i=1, #WpRouteList do\n    if WpRouteList[i]==WpName then\n     WpRouteList[i]=\"\"\n     MenuSelect[i+8]=nil\n     DistanceList[i]=nil\n     FlyStat[i]=nil\n     GoTo[i]=nil\n     ItHasSettings[i]=nil\n     if WpRouteList[i+1]==\"HOLD\" then\n      WpRouteList[i+1]=\"\"\n      MenuSelect[i+1+8]=nil\n      DistanceList[i+1]=nil\n      FlyStat[i+1]=nil\n      GoTo[i+1]=nil\n      ItHasSettings[i+1]=nil\n     end\n     break\n    end\n   end\n   local WpRouteList_temp={}\n   local counter=0\n   for i=1, #WpRouteList do\n    if WpRouteList[i]~=\"\" then counter=counter+1 WpRouteList_temp[counter]=WpRouteList[i] GoTo[i]=\"Go To &#8594;\" end\n   end\n   WpRouteList=WpRouteList_temp\n  end\n  SelectionList=nil\n  if #WpRouteList>0 then RouteExist=true else RouteExist=false end\n  HUDScreen()\n end\n\n--ROUTE CHECK\n function RouteCheck()\n  local RoutePossible=false\n  if (#WpRouteList==1 or (#WpRouteList==2 and WpRouteList[2]==\"HOLD\")) then\n   local D1=DistanceList[1]\n   D1=D1:gsub(\"%a\",\"\")\n   if tonumber(D1)>=wp_sequencing_distance then RoutePossible=true end\n  elseif #WpRouteList>1 then\n   for i=1, #WpRouteList do\n    local D1=DistanceList[i]\n    if D1==\"Holding\" then D1=\"999 Km\" end\n    D1=D1:gsub(\"%a\",\"\")\n    if tonumber(D1)>=wp_sequencing_distance then RoutePossible=true break else RoutePossible=false end\n   end\n  end\n  if RoutePossible then SelectionIsTrue=false RouteActivated=true route_page()\n  else WpRouteList[1]=\"WP Too Close\" route_page() HUDScreen() end\n end\n\n--DATABANK CLEANING\n function databank_clean(wp, settings, id, colors, dmg)\n  local store_db_wp={}\n  local stored_db_route={}\n  local stored_db_wpsettings={}\n  local settings_list={}\n  local id_list={}\n  local colors_list={}\n  local dmg_list={}\n  local item_cleared=\"\"\n\n  if wp==true then\n   local dbn=databank.getNbKeys()\n   local counter=0\n   for i=1, dbn do\n    local key=\"wp\"..i\n    local value=databank.getStringValue(key)\n    local key_coord=\"wp\"..i..\"_coord\"\n    local value_coord=databank.getStringValue(key_coord)\n    if (value~=\"\" and value_coord~=\"\") then\n     counter=counter +1\n     local new_key=\"wp\"..counter\n     local new_key_coord=\"wp\"..counter..\"_coord\"\n     store_db_wp[counter]={[\"key\"]=new_key, [\"value\"]=value, [\"key_coord\"]=new_key_coord, [\"value_coord\"]=value_coord}\n    end\n   end\n\n   stored_db_route={}\n   local counter=0\n   for x=1, dbn do\n    local route_id=\"Route\"..x\n    local data=databank.getStringValue(route_id):gsub(\"@@@\",\"\\\"\")\n    data=json.decode(data)\n    if data then\n     if (data.wp1~=nil or data.wp1~=\"\") then\n      counter=counter +1\n      local name=data.name\n      stored_db_route[name]={}\n      local x=-1\n      for i, v in pairs(data) do x=x +1 end\n      for y=1, x do\n       local wp_id=\"wp\"..y\n       local wp=data[wp_id]\n       if wp~=nil then\n        table.insert(stored_db_route[name], y, wp)\n       end\n      end\n     end\n    end\n   end\n\n   stored_db_wpsettings={}\n   local counter=0\n   local data=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n   data=json.decode(data)\n   if data then\n    for i, v in pairs(data) do\n     if (data[i].alt~=nil or data[i].alt~=\"\" or data[i].s~=nil or data[i].s~=\"\") then\n      counter=counter +1\n      local name=i\n      local alt=data[i].alt\n      local s=data[i].s\n      stored_db_wpsettings[counter]={[\"name\"]=name,[\"alt\"]=alt,[\"s\"]=s}\n     end\n    end\n   end\n  else\n   item_cleared=item_cleared..\"(1)\"\n  end\n\n  if settings==true then\n   local name=\"navigator_MTOW\"\n   local value=databank.getFloatValue(\"navigator_MTOW\")\n   settings_list[1]={[\"name\"]=name, [\"value\"]=value}\n   name=\"navigator_autobrake\"\n   value=databank.getFloatValue(\"navigator_autobrake\")\n   settings_list[2]={[\"name\"]=name, [\"value\"]=value}\n   name=\"navigator_wpdist\"\n   value=databank.getFloatValue(\"navigator_wpdist\")\n   settings_list[3]={[\"name\"]=name, [\"value\"]=value}\n   name=\"holding_speed\"\n   value=databank.getFloatValue(\"holding_speed\")\n   settings_list[4]={[\"name\"]=name, [\"value\"]=value}\n  else\n   keypad_input_MTOW=factory_MTOW/1000\n   keypad_input_autobrake=factory_autobrake\n   keypad_input_wpdist=wp_sequencing_distance\n   keypad_input_holding=holding_speed\n   item_cleared=item_cleared..\"(2)\"\n  end\n\n  if id==true then\n   local name=\"Ship ID\"\n   local value=databank.getStringValue(\"Ship ID\")\n   id_list[1]={[\"name\"]=name, [\"value\"]=value}\n  else\n   keypad_input_shipid=\"\"\n   item_cleared=item_cleared..\"(3)\"\n  end\n\n  if colors==true then\n   local name=\"TableColor\"\n   local value=databank.getStringValue(\"TableColor\")\n   colors_list[1]={[\"name\"]=name, [\"value\"]=value}\n   name=\"FontTitle\"\n   value=databank.getStringValue(\"FontTitle\")\n   colors_list[2]={[\"name\"]=name, [\"value\"]=value}\n   name=\"FontColor\"\n   value=databank.getStringValue(\"FontColor\")\n   colors_list[3]={[\"name\"]=name, [\"value\"]=value}\n   name=\"Selection\"\n   value=databank.getStringValue(\"Selection\")\n   colors_list[4]={[\"name\"]=name, [\"value\"]=value}\n   name=\"Background\"\n   value=databank.getStringValue(\"Background\")\n   colors_list[5]={[\"name\"]=name, [\"value\"]=value}\n  else\n   Table_RGB=\"0,0,255\"\n   databank.setStringValue(\"TableColor\", \"{0,0,255}\")\n   Title_RGB=\"255,255,0\"\n   databank.setStringValue(\"FontTitle\", \"{255,255,0}\")\n   Font_RGB=\"217,217,217\"\n   databank.setStringValue(\"FontColor\", \"{217,217,217}\")\n   Button_Pressed_RGB=\"0,0,255\"\n   databank.setStringValue(\"Background\", \"{0,0,255}\")\n   Button_RGB=\"255,0,0\"\n   databank.setStringValue(\"Selection\", \"{255,0,0}\")\n   item_cleared=item_cleared..\"(4)\"\n  end\n\n  if dmg==true then\n   local name=\"DMG Scale\"\n   local value=databank.getFloatValue(\"DMG Scale\")\n   dmg_list[1]={[\"name\"]=name, [\"value\"]=value}\n   name=\"DMG TV U/D\"\n   value=databank.getFloatValue(\"DMG TV U/D\")\n   dmg_list[2]={[\"name\"]=name, [\"value\"]=value}\n   name=\"DMG TV L/R\"\n   value=databank.getFloatValue(\"DMG TV L/R\")\n   dmg_list[3]={[\"name\"]=name, [\"value\"]=value}\n   name=\"DMG SV U/D\"\n   value=databank.getFloatValue(\"DMG SV U/D\")\n   dmg_list[4]={[\"name\"]=name, [\"value\"]=value}\n   name=\"DMG SV L/R\"\n   value=databank.getFloatValue(\"DMG SV L/R\")\n   dmg_list[5]={[\"name\"]=name, [\"value\"]=value}\n  else\n   keypad_input_dmg1=3\n   DMG_REP_TOP_VIEW_Up_Down=-20\n   DMG_REP_TOP_VIEW_LH_RH=30\n   DMG_REP_SIDE_VIEW_Up_Down=40\n   DMG_REP_SIDE_VIEW_LH_RH=100\n   item_cleared=item_cleared..\"(5)\"\n  end\n\n  databank.clear()\n  system.print(\"CLEARING DATABANK\")\n  databank_initialization()\n  system.print(\"REGENERATING DATABANK, KEYS: \"..databank.getNbKeys())\n\n  if wp==true then\n   local id=0\n   local restore_data={}\n   local route_id=\"\"\n   for i=1, #store_db_wp do\n    databank.setStringValue(store_db_wp[i].key, store_db_wp[i].value)\n    databank.setStringValue(store_db_wp[i].key_coord, store_db_wp[i].value_coord)\n   end\n   table.sort(stored_db_route)\n   for i, v in pairs(stored_db_route) do\n    id=id +1\n    route_id=\"Route\"..id\n    restore_data={[\"name\"]=i}\n    for k, f in pairs(stored_db_route[i]) do\n     local wp_id=\"wp\"..k\n     restore_data[wp_id]=f\n    end\n    restore_data=json.encode(restore_data)\n    databank.setStringValue(route_id, restore_data:gsub(\"\\\"\",\"@@@\"))\n   end\n\n   if stored_db_wpsettings then\n    restore_data={}\n    for i=1, #stored_db_wpsettings do\n     local name=stored_db_wpsettings[i].name\n     local alt=stored_db_wpsettings[i].alt\n     local s=stored_db_wpsettings[i].s\n     restore_data[name]={[\"alt\"]=alt,[\"s\"]=s}\n    end\n    restore_data=json.encode(restore_data)\n    databank.setStringValue(\"wp_settings\", restore_data:gsub(\"\\\"\",\"@@@\"))\n   end\n  end\n\n  if settings==true then\n   for i=1, #settings_list do\n    databank.setFloatValue(settings_list[i].name, settings_list[i].value)\n   end\n  end\n\n  if id==true then\n   for i=1, #id_list do\n    databank.setStringValue(id_list[i].name, id_list[i].value)\n   end\n  end\n\n  if colors==true then\n   for i=1, #colors_list do\n    databank.setStringValue(colors_list[i].name, colors_list[i].value)\n   end\n  end\n\n  if dmg==true then\n   for i=1, #dmg_list do\n    databank.setFloatValue(dmg_list[i].name, dmg_list[i].value)\n   end\n  end\n\n  wp_settings_init()\n\n  reset_db_status=\"CLEARED: \"..item_cleared..\" Restart The Interface\"\n  system.print(\"DATABANK REGENERATED, KEYS: \"..databank.getNbKeys())\n\n  HUDScreen()\n end\n\n--DATA STATUS\n ship_id=\"\"\n ship_id_verified=false\n \n if (databank.getStringValue(\"databank_verification\")==\"Verified\") then\n  databank.setStringValue(\"\", nil)\n  ship_id=databank.getStringValue(\"Ship ID\")\n end\n if (ship_id==\"No ID\" or ship_id==\"\") then ShipIdCheck=false else ShipIdCheck=true end\n\n--BUTTON FUNCTIONS\n --ADD/RENAME WP BUTTON\n  function add_wp()\n   if (screenState==2 and keypad_input_from==\"PPOS\" and keypad_input_wpname~=\"\") then\n    wp_check()\n    screenState=2\n   elseif (screenState==2 and keypad_input_from~=\"\" and keypad_input_wpname~=\"\") then\n    databank.setStringValue(wp_id_rename, keypad_input_wpname)\n    stored=\"WP RENAMED\"\n    local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n    ext=json.decode(ext)\n    if ext[keypad_input_from] then\n     ext[keypad_input_wpname]={[\"alt\"]=ext[keypad_input_from].alt,[\"s\"]=ext[keypad_input_from].s}\n     ext=json.encode(ext)\n     databank.setStringValue(\"wp_settings\", ext:gsub(\"\\\"\",\"@@@\"))\n    end\n    screenState=2\n   elseif (screenState==7 and wp_name_inserted==true and wp_lat_inserted==true and wp_lon_inserted==true and wp_alt_inserted==true and WPSTORESelect[1]==\"select\") then\n    keypad_input_wpname=keypad_input_wp_name\n    if (wp_selected_planet~=\"Invalid Entry\" and wp_selected_planet~=\"World Coordinates\" and wp_coordinated_stored~=\"\") then from_coordinates=coord_converter()\n    else from_coordinates=vec3(tonumber(keypad_input_wp_lat),tonumber(keypad_input_wp_lon),tonumber(keypad_input_wp_alt)) end\n    wp_check()\n   end\n  end\n\n --CLR WP BUTTON\n  function clr_wp(clr)\n   if (wp_list[clr] and screenState==0) then\n    local wp_id=wp_list[clr].id\n    for i=1, #wp_list do\n     if wp_list[i].id==wp_id then\n      local wp_del=wp_list[i].wp\n      local wp_name=wp_list[i].name\n      databank.setStringValue(wp_del, nil)\n      databank.setStringValue(wp_del..\"_coord\", nil)\n      local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n      ext=json.decode(ext)\n      ext[wp_name]=nil\n      ext=json.encode(ext)\n      databank.setStringValue(\"wp_settings\", ext:gsub(\"\\\"\",\"@@@\"))\n      wp_settings_init()\n      break\n     end\n    end\n   end\n   HUDScreen()\n  end\n\n --BIG ARROW UP\n  function big_arrow_up()\n   if screenState==0  then      --wp page up\n    if wp_page_index>1 then\n     wp_page_index=wp_page_index -1\n    end\n   elseif screenState==6 then    --atlas page up\n    if atlas_page_index>1 then\n     atlas_page_index=atlas_page_index -1\n    end\n   end\n  end\n\n --BIG ARROW DOWN\n  function big_arrow_down()\n   if screenState==0 then       --wp page down\n    if wp_page_index<wp_pages then\n     wp_page_index=wp_page_index +1\n    end\n   elseif screenState==6 then    --atlas page down\n    if atlas_page_index<atlas_pages then\n     atlas_page_index=atlas_page_index +1\n    end\n   end\n  end\n\n --ENT BUTTON\n  function ent_button()\n   --ENT Time Calculator\n    if screenState==1 then\n     if (su_distance_inserted==true and (keypad_input_speed~=\"\" or keypad_input_speed==\"\" or tonumber(keypad_input_speed)>0)) then\n      local su_num=tonumber(keypad_input_su)\n      local speed_num=tonumber(keypad_input_speed)\n      if (keypad_input_speed==\"\" or speed_num >=30000) then\n       if math.floor((vec3(core.getVelocity()):len())*3.6)==0 then\n        keypad_input_speed=0\n        databank.setFloatValue(\"navigator_speed\", 0)\n        speed_num=0\n        databank.setFloatValue(\"navigator_eta_h\", 0)\n        databank.setFloatValue(\"navigator_eta_m\", 0)\n        databank.setFloatValue(\"navigator_eta_s\", 0)\n        speed_inserted=false\n       else\n        keypad_input_speed=tostring(math.floor((vec3(core.getVelocity()):len())*3.6))\n        speed_num=math.floor((vec3(core.getVelocity()):len())*3.6)\n        databank.setFloatValue(\"navigator_speed\", speed_num)\n        speed_inserted=true\n       end\n      else\n       speed_num=tonumber(keypad_input_speed)\n       databank.setFloatValue(\"navigator_speed\", speed_num)\n      end\n      if speed_num==0 then\n       time_to_go=\"Speed Is Invalid\"\n       databank.setFloatValue(\"navigator_eta_h\", 0)\n       databank.setFloatValue(\"navigator_eta_m\", 0)\n       databank.setFloatValue(\"navigator_eta_s\", 0)\n       speed_inserted=false\n      else\n       local time_min=(su_num*200/speed_num*60)\n       local time_h  =(time_min/60)\n       local time_m  =(time_h - math.floor(time_h))*60\n       local time_s  =(time_m - math.floor(time_m))*60\n       time_to_go=math.floor(time_h) ..\" h \".. math.floor(time_m) ..\" m \".. math.floor(time_s) ..\" s\"\n       databank.setFloatValue(\"navigator_eta_h\", math.floor(time_h))\n       databank.setFloatValue(\"navigator_eta_m\", math.floor(time_m))\n       databank.setFloatValue(\"navigator_eta_s\", math.floor(time_s))\n       speed_inserted=true\n      end\n     elseif (su_distance_inserted==false and keypad_input_su==\"\" and keypad_input_speed==\"\") then\n      databank.setFloatValue(\"navigator_distance\", \"n/a\")\n     elseif (su_distance_inserted==false and keypad_input_su~=\"\" and keypad_input_speed==\"\") then\n      databank.setFloatValue(\"navigator_distance\", keypad_input_su)\n      su_distance_inserted=true\n      su_tick=\"\"\n      TimeCalcSelect[1]=\"\"\n      speed_tick=\">\"\n      TimeCalcSelect[2]=\"select\"\n     end\n    end\n\n   --ENT From\n    if screenState==2 then\n     if (from_inserted==false and keypad_input_from==\"\") then\n      local myPos=vec3(core.getConstructWorldPos())\n      keypad_input_from=\"PPOS\"\n      databank.setStringValue(\"navigator_from\", \"PPOS\")\n      databank.setStringValue(\"from\", \"PPOS\")\n      from_coordinates=tostring(myPos)\n      databank.setStringValue(\"navigator_from_coordinates\", tostring(myPos))\n      from_inserted=true\n      FROMSelect[1]=\"\"\n      FROMSelect[2]=\"select\" \n     elseif (from_inserted==false and keypad_input_from~=\"\") then\n      from_coordinates_check=false\n      for i, v in pairs(atlas[0]) do\n       if atlas[0][i].name[1]==keypad_input_from then\n        databank.setStringValue(\"navigator_from\", atlas[0][i].name[1])\n        databank.setFloatValue(\"navigator_from_planet_radius\", atlas[0][i].radius)\n        databank.setStringValue(\"from\", keypad_input_from)\n        from_inserted=true\n        from_coordinates=vec3(atlas[0][i].center)\n        databank.setStringValue(\"navigator_from_coordinates\", tostring(from_coordinates))\n        from_coordinates_check=true\n        break\n       elseif databank.hasKey(keypad_input_from)==1 then\n        local wp_check=keypad_input_from\n        for x=1, #wp_list do \n         if wp_list[x].id==wp_check then\n          local wp_id=wp_list[x].wp\n          wp_id_rename=wp_id\n          keypad_input_from=databank.getStringValue(wp_id)\n          keypad_input_from_coord=wp_id ..\"_coord\"\n          databank.setStringValue(\"navigator_from\", keypad_input_from)\n          databank.setStringValue(\"from\", keypad_input_from)\n          databank.setFloatValue(\"navigator_from_planet_radius\", 1)\n          from_inserted=true\n          from_coordinates=vec3FromStr(databank.getStringValue(keypad_input_from_coord))\n          databank.setStringValue(\"navigator_from_coordinates\", tostring(from_coordinates))\n          from_coordinates_check=true\n          FROMSelect[1]=\"\"\n          FROMSelect[2]=\"select\" \n          break\n         end\n        end\n       elseif from_coordinates_check==false then\n        databank.setStringValue(\"navigator_from\", \"no From\")\n        from_inserted=false\n        from_coordinates=\"Not Present In Databank\"\n        databank.setStringValue(\"navigator_from_coordinates\", \"n/a\")\n        FROMSelect[1]=\"select\"\n        FROMSelect[2]=\"\"\n       end\n      end\n     end\n    end\n\n   --ENT Destination\n    if (screenState==3 or RouteActivated) then\n     if (destination_inserted==false and keypad_input_dest~=\"\") then\n      destination_check=false\n      for i, v in pairs(atlas[0]) do\n       if atlas[0][i].name[1]==keypad_input_dest then\n        databank.setStringValue(\"navigator_target_destination\", atlas[0][i].name[1])\n        databank.setStringValue(\"to\", keypad_input_dest)\n        databank.setFloatValue(\"navigator_target_planet_radius\", atlas[0][i].radius)\n        destination_inserted=true\n        local myPos=vec3(core.getConstructWorldPos())\n        destination_coord=vec3(atlas[0][i].center)\n        databank.setStringValue(\"navigator_coordinates\", tostring(destination_coord))\n        set_coordinates(atlas[0][i])\n        distance_to_go=math.floor(((vec3(atlas[0][i].center) - myPos):len())/1000/200*100)/100\n        distance_to_go_warp=distance_to_go\n        databank.setFloatValue(\"navigator_distance\", distance_to_go)\n        databank.setFloatValue(\"navigator_eta_h\", 0)\n        databank.setFloatValue(\"navigator_eta_m\", 0)\n        databank.setFloatValue(\"navigator_eta_s\", 0)\n        destination_check=true\n        break\n       elseif databank.hasKey(keypad_input_dest)==1 then\n        local wp_check=keypad_input_dest\n        for x=1, #wp_list do \n         if wp_list[x].id==wp_check then\n          local wp_id=wp_list[x].wp\n          keypad_input_dest=databank.getStringValue(wp_id)\n          keypad_input_dest_coord=wp_id ..\"_coord\"\n          databank.setStringValue(\"navigator_target_destination\", keypad_input_dest)\n          databank.setStringValue(\"to\", keypad_input_dest)\n          databank.setFloatValue(\"navigator_target_planet_radius\", 1)\n          destination_inserted=true\n          local myPos=vec3(core.getConstructWorldPos())\n          destination_coord=vec3FromStr(databank.getStringValue(keypad_input_dest_coord))\n          databank.setStringValue(\"navigator_coordinates\", tostring(destination_coord))\n          set_wp_coordinates(databank.getStringValue(keypad_input_dest_coord))\n          distance_to_go=math.floor(((destination_coord - myPos):len())/1000/200*100)/100\n          distance_to_go_warp=distance_to_go\n          databank.setFloatValue(\"navigator_distance\", distance_to_go)\n          databank.setFloatValue(\"navigator_eta_h\", 0)\n          databank.setFloatValue(\"navigator_eta_m\", 0)\n          databank.setFloatValue(\"navigator_eta_s\", 0)\n          destination_check=true\n          break\n         else\n          databank.setStringValue(\"navigator_target_destination\", \"no Dest.\")\n          destination_inserted=false\n          destination_coord=\"Not Present In Databank\"\n          databank.setStringValue(\"navigator_coordinates\", \"n/a\")\n         end\n        end\n       elseif (destination_check==false) then\n        databank.setStringValue(\"navigator_target_destination\", \"no Dest.\")\n        destination_inserted=false\n        destination_coord=\"Not Present In Databank\"\n        databank.setStringValue(\"navigator_coordinates\", \"n/a\")\n       end\n      end\n     end\n    end\n\n   --ENT Target Pe Altitude\n    if screenState==4 then\n     local Destination=\"\"\n     local MinimumABSAltitude=10000\n     local MinimumAltitude=0\n     local SelectabledAltitude=0\n     if (keypad_input_dest==nil or keypad_input_dest==\"\") then Destination=core.getCurrentPlanetId()\n     else Destination=keypad_input_dest end\n     if (tonumber(Destination)~=nil and Destination~=0) then MinimumAltitude=atlas[0][Destination].atmosphereThickness\n     elseif Destination==0 then MinimumAltitude=10000\n     else\n      for i, v in pairs(atlas[0]) do\n       if atlas[0][i].name[1]==Destination then MinimumAltitude=atlas[0][i].atmosphereThickness break end\n      end\n     end\n\n     if (target_pe_altitude_inserted==false and keypad_input_pe_target_alt~=\"\") then\n      if tonumber(keypad_input_pe_target_alt)==nil then\n       target_alt_warning=\"Invalid Input\"\n       target_pe_altitude_inserted=true\n      elseif (tonumber(keypad_input_pe_target_alt)<MinimumABSAltitude and MinimumABSAltitude>=MinimumAltitude) then\n       target_alt_warning=\"Warning Altitude below 10.000 m\"\n       target_pe_altitude_inserted=true\n      elseif (tonumber(keypad_input_pe_target_alt)<MinimumAltitude) then\n       target_alt_warning=\"Warning Destination Atmosphere Altitude is \"..MinimumAltitude\n       target_pe_altitude_inserted=true\n      elseif (tonumber(keypad_input_pe_target_alt)>=MinimumABSAltitude and tonumber(keypad_input_pe_target_alt)>=MinimumAltitude) then\n       databank.setFloatValue(\"navigator_pe_target_altitude\", tonumber(keypad_input_pe_target_alt))\n       target_pe_altitude_inserted=true\n       stored_pe_target_alt=keypad_input_pe_target_alt\n       databank.setFloatValue(\"PE_altitude\", math.floor(stored_pe_target_alt))\n      elseif target_alt_warning==\"Invalid Input\" then\n       target_alt_warning=\"Invalid Input\"\n       target_pe_altitude_inserted=true\n      end\n     else\n      target_alt_warning=\"Invalid Input\"\n      target_pe_altitude_inserted=true\n     end\n    end\n\n   --ENT Settings\n    if screenState==9 then        --(Settings Menu)\n     if SETTINGSSelect[1]==\"select\" then     --SELECT Ship Settings\n      screenState=5\n      SHIPSETINGSSelect={[0]=\"select\",\"\",\"\",\"\",\"\"}\n     elseif SETTINGSSelect[2]==\"select\" then --SELECT WP Store\n      screenState=7\n      WPSTORESelect={[0]=\"select\",\"\",\"\",\"\",\"\"}\n      wp_selected_planet=\"\"\n      keypad_input_wp_name=\"\"\n      keypad_input_wp_lat=\"\"\n      keypad_input_wp_lon=\"\"\n      keypad_input_wp_alt=\"\"\n     elseif SETTINGSSelect[3]==\"select\" then --SELECT WP Sync\n      screenState=8\n      WPSYNCSelect={[0]=\"select\",\"\",\"\",\"\"}\n      sync_result=\"\"\n      receiving_wp=0\n      wp_synced=0\n      index_sync=1\n      prog_bar=0\n      keypad_input_shipid=databank.getStringValue(\"Ship ID\")\n     elseif SETTINGSSelect[4]==\"select\" then --SELECT Screen Colors\n      screenState=10\n      COLORSSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"}\n      local TableColor=databank.getStringValue(\"TableColor\")\n      TableColor=json.decode(TableColor)\n      keypad_input_color1=TableColor[1] ..\",\".. TableColor[2] ..\",\".. TableColor[3]\n      local FontTitle=databank.getStringValue(\"FontTitle\")\n      FontTitle=json.decode(FontTitle)\n      keypad_input_color2=FontTitle[1] ..\",\".. FontTitle[2] ..\",\".. FontTitle[3]\n      local FontColor=databank.getStringValue(\"FontColor\")\n      FontColor=json.decode(FontColor)\n      keypad_input_color3=FontColor[1] ..\",\".. FontColor[2] ..\",\".. FontColor[3]\n      local ButtonPressed=databank.getStringValue(\"Selection\")\n      ButtonPressed=json.decode(ButtonPressed)\n      keypad_input_color4=ButtonPressed[1] ..\",\".. ButtonPressed[2] ..\",\".. ButtonPressed[3]\n      local ButtonColor=databank.getStringValue(\"Background\")\n      ButtonColor=json.decode(ButtonColor)\n      keypad_input_color5=ButtonColor[1] ..\",\".. ButtonColor[2] ..\",\".. ButtonColor[3]\n      local Alpha1=databank.getFloatValue(\"Alpha1\")\n      keypad_input_color6=Alpha1\n      local Alpha2=databank.getFloatValue(\"Alpha2\")\n      keypad_input_color7=Alpha2\n     elseif SETTINGSSelect[5]==\"select\" then --SELECT DMG Rep.\n      screenState=11  \n      DMGREPSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\"}\n      keypad_input_dmg1=databank.getFloatValue(\"DMG Scale\")\n      DMG_REP_TOP_VIEW_Up_Down=databank.getFloatValue(\"DMG TV U/D\")\n      DMG_REP_TOP_VIEW_LH_RH=databank.getFloatValue(\"DMG TV L/R\")\n      DMG_REP_SIDE_VIEW_Up_Down=databank.getFloatValue(\"DMG SV U/D\")\n      DMG_REP_SIDE_VIEW_LH_RH=databank.getFloatValue(\"DMG SV L/R\")\n     elseif SETTINGSSelect[6]==\"select\" then --SELECT DB Reset\n      screenState=12\n      DBRESSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\"}\n      db_mark_1=\"X\"\n      db_mark_1_TF=true\n      db_mark_2=\"X\"\n      db_mark_2_TF=true\n      db_mark_3=\"X\"\n      db_mark_3_TF=true\n      db_mark_4=\"X\"\n      db_mark_4_TF=true\n      db_mark_5=\"X\"\n      db_mark_5_TF=true\n      reset_db_status=databank.getNbKeys()..\" Keys\"\n      HUDScreen()\n     end\n    elseif screenState==5 then    --(Ship Settings)\n     if SHIPSETINGSSelect[1]==\"select\" then\n      if (keypad_input_MTOW==\"\") then\n       keypad_input_MTOW=factory_MTOW/1000\n       new_MTOW=keypad_input_MTOW\n       databank.setFloatValue(\"navigator_MTOW\", new_MTOW*1000)\n      else\n       new_MTOW=tonumber(keypad_input_MTOW)\n       databank.setFloatValue(\"navigator_MTOW\", new_MTOW*1000)\n      end\n     elseif SHIPSETINGSSelect[2]==\"select\" then\n      if keypad_input_autobrake==\"\" then\n       keypad_input_autobrake=factory_autobrake\n       databank.setFloatValue(\"navigator_autobrake\", keypad_input_autobrake)\n      else\n       keypad_input_autobrake=tonumber(keypad_input_autobrake)\n       databank.setFloatValue(\"navigator_autobrake\", keypad_input_autobrake)\n      end\n     elseif SHIPSETINGSSelect[3]==\"select\" then\n      if keypad_input_wpdist==\"\" then\n       keypad_input_wpdist=wp_sequencing_distance\n       databank.setFloatValue(\"navigator_wpdist\", keypad_input_wpdist)\n      else\n       keypad_input_wpdist=tonumber(keypad_input_wpdist)\n       wp_sequencing_distance=keypad_input_wpdist\n       databank.setFloatValue(\"navigator_wpdist\", keypad_input_wpdist)\n      end\n     elseif SHIPSETINGSSelect[4]==\"select\" then\n      if keypad_input_holding==\"\" then\n       keypad_input_holding=databank.getIntValue(\"holding_speed\")\n       holding_speed=keypad_input_holding\n      else\n       keypad_input_holding=tonumber(keypad_input_holding)\n       holding_speed=keypad_input_holding\n       databank.setIntValue(\"holding_speed\", holding_speed)\n      end\n     end\n    elseif screenState==8 then    --(WP Sync)\n     msg_counter=0\n     if (WPSYNCSelect[1]==\"select\" and keypad_input_shipid~=\"\") then\n      ship_id=keypad_input_shipid\n      databank.setStringValue(\"Ship ID\", ship_id)\n      ShipIdCheck=true\n     end\n     if (WPSYNCSelect[2]==\"select\" and keys_number>0 and WPSYNCSelect[3]==\"\" and emitter) then\n      emitter.send(\"AviatorHUD\", \"<SendDataToBase>\"..ship_id)\n      sync_result=\"Downlink Requested\"\n      delay_timer=5\n      delay_id=\"ShipIDResponse\"\n      unit.setTimer(\"delay\", 1)\n     elseif (keys_number==0) then\n      prog_bar=0\n      sync_result=\"No Data To Sync\"\n     end\n     if WPSYNCSelect[3]==\"select\" then ship_id=databank.getStringValue(\"Ship ID\")\n      if (ship_id~=\"\" and ship_id~=\"No ID\" and emitter) then\n       emitter.send(\"AviatorHUD\", \"<SendShipID>\"..ship_id)\n       sync_result=\"Ship ID Sent\"\n       delay_timer=5\n       delay_id=\"ShipIDResponse\"\n       unit.setTimer(\"delay\", 1)\n      else\n       if emitter then sync_result=\"No Ship ID\" else sync_result=\"No Emitter/Receiver\" end\n      end\n     end\n    elseif screenState==10 then   --(Screen Colors)\n     if COLORSSelect[1]==\"select\" then\n      if (keypad_input_color1:find(\"%a\")~=nil or keypad_input_color1:find(\"(%d+),(%d+),(%d+)\")==nil) then keypad_input_color1=\"Insert RGB\"\n      elseif keypad_input_color1~=\"\" then\n       Table_RGB=\"{\".. keypad_input_color1 ..\"}\"\n       databank.setStringValue(\"TableColor\", Table_RGB)\n       local TableColor=json.decode(Table_RGB)\n       Table_R=(TableColor[1])\n       Table_G=(TableColor[2])\n       Table_B=(TableColor[3])\n      end\n     elseif COLORSSelect[2]==\"select\" then\n      if (keypad_input_color2:find(\"%a\")~=nil or keypad_input_color2:find(\"(%d+),(%d+),(%d+)\")==nil) then keypad_input_color2=\"Insert RGB\"\n      elseif keypad_input_color2~=\"\" then\n       Title_RGB=\"{\".. keypad_input_color2 ..\"}\"\n       databank.setStringValue(\"FontTitle\", Title_RGB)\n       local FontTitle=json.decode(Title_RGB)\n       Title_R=(FontTitle[1])\n       Title_G=(FontTitle[2])\n       Title_B=(FontTitle[3])\n      end\n     elseif COLORSSelect[3]==\"select\" then\n      if (keypad_input_color3:find(\"%a\")~=nil or keypad_input_color3:find(\"(%d+),(%d+),(%d+)\")==nil) then keypad_input_color3=\"Insert RGB\"\n      elseif keypad_input_color3~=\"\" then\n       Font_RGB=\"{\".. keypad_input_color3 ..\"}\"\n       databank.setStringValue(\"FontColor\", Font_RGB)\n       local FontColor=json.decode(Font_RGB)\n       Font_R=(FontColor[1])\n       Font_G=(FontColor[2])\n       Font_B=(FontColor[3])\n      end\n     elseif COLORSSelect[4]==\"select\" then\n      if (keypad_input_color4:find(\"%a\")~=nil or keypad_input_color4:find(\"(%d+),(%d+),(%d+)\")==nil) then keypad_input_color4=\"Insert RGB\"\n      elseif keypad_input_color4~=\"\" then\n       Button_Pressed_RGB=\"{\".. keypad_input_color4 ..\"}\"\n       databank.setStringValue(\"Selection\", Button_Pressed_RGB)\n       local ButtonPressed=json.decode(Button_Pressed_RGB)\n       Button_Pressed_R=(ButtonPressed[1])\n       Button_Pressed_G=(ButtonPressed[2])\n       Button_Pressed_B=(ButtonPressed[3])\n      end\n     elseif COLORSSelect[5]==\"select\" then\n      if (keypad_input_color5:find(\"%a\")~=nil or keypad_input_color5:find(\"(%d+),(%d+),(%d+)\")==nil) then keypad_input_color5=\"Insert RGB\"\n      elseif keypad_input_color5~=\"\" then\n       Button_RGB=\"{\".. keypad_input_color5 ..\"}\"\n       databank.setStringValue(\"Background\", Button_RGB)\n       local ButtonColor=json.decode(Button_RGB)\n       Button_R=(ButtonColor[1])\n       Button_G=(ButtonColor[2])\n       Button_B=(ButtonColor[3])\n      end\n     elseif COLORSSelect[6]==\"select\" then\n      if keypad_input_color6~=\"\" then\n       Alpha1=keypad_input_color6\n       databank.setFloatValue(\"Alpha1\", Alpha1)\n      end\n     elseif COLORSSelect[7]==\"select\" then\n      if keypad_input_color7~=\"\" then\n        Alpha2=keypad_input_color7\n        databank.setFloatValue(\"Alpha2\", Alpha2)\n       end\n     end\n    elseif screenState==12 then   --(DB reset)\n     if DBRESSelect[1]==\"select\" then db_mark_1=\"X\" db_mark_1_TF=true\n     elseif DBRESSelect[2]==\"select\" then db_mark_2=\"X\" db_mark_2_TF=true\n     elseif DBRESSelect[3]==\"select\" then db_mark_3=\"X\" db_mark_3_TF=true\n     elseif DBRESSelect[4]==\"select\" then db_mark_4=\"X\" db_mark_4_TF=true\n     elseif DBRESSelect[5]==\"select\" then db_mark_5=\"X\" db_mark_5_TF=true\n     end\n    elseif screenState==16 then   --(WP Setting)\n     if WPSETTINGSelect[1]==\"select\" then\n      if (tonumber(keypad_input_wp_altitude)~=nil) then wp_altitude_inserted=true end\n     elseif WPSETTINGSelect[2]==\"select\" then\n      if (tonumber(keypad_input_wp_speed)~=nil) then wp_speed_inserted=true end\n     end\n\n     local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n     ext=json.decode(ext)\n     ext[edit_wp]={[\"alt\"]=keypad_input_wp_altitude,[\"s\"]=keypad_input_wp_speed}\n     ext=json.encode(ext)\n     databank.setStringValue(\"wp_settings\", ext:gsub(\"\\\"\",\"@@@\"))\n     wp_settings_init()\n    end\n\n  end\n\n --CLR BUTTON\n  function clr_button()\n   --CLR Time Calculator\n    if screenState==1 then\n     if (su_distance_inserted==true and keypad_input_su~=\"\" and keypad_input_speed~=\"\") then\n      keypad_input_speed=nil\n      databank.setFloatValue(\"navigator_speed\", \"0\")\n      speed_inserted=false\n      time_to_go=\"\"\n      databank.setFloatValue(\"navigator_eta_h\", 0)\n      databank.setFloatValue(\"navigator_eta_m\", 0)\n      databank.setFloatValue(\"navigator_eta_s\", 0)\n     elseif (su_distance_inserted==true and keypad_input_su~=\"\" and keypad_input_speed==\"\") then\n      keypad_input_su=nil\n      databank.setStringValue(\"navigator_distance\", \"n/a\")\n      su_distance_inserted=false\n      speed_inserted=false\n      databank.setStringValue(\"navigator_speed\", \"0\")\n      databank.setFloatValue(\"navigator_eta_h\", 0)\n      databank.setFloatValue(\"navigator_eta_m\", 0)\n      databank.setFloatValue(\"navigator_eta_s\", 0)\n     elseif (su_distance_inserted==false and keypad_input_su~=\"\" and keypad_input_speed==\"\") then\n      keypad_input_su=nil\n      databank.setStringValue(\"navigator_distance\", \"n/a\")\n      databank.setFloatValue(\"navigator_eta_h\", 0)\n      databank.setFloatValue(\"navigator_eta_m\", 0)\n      databank.setFloatValue(\"navigator_eta_s\", 0)\n     end\n    end\n\n   --CLR From\n    if screenState==2 then\n     if (keypad_input_from~=\"\" or FROMSelect[2]==\"select\")then\n      keypad_input_from=nil\n      databank.setStringValue(\"navigator_from\", \"no From\")\n      from_coordinates=\"\"\n      databank.setStringValue(\"navigator_from_coordinates\", \"n/a\")\n      from_inserted=false\n      databank.setFloatValue(\"navigator_from_planet_radius\", 0)\n      wpname_inserted=false\n      FROMSelect[1]=\"select\"\n      FROMSelect[2]=\"\"\n      stored=\"\"\n     end\n    end\n\n   --CLR Distance To Coordinates\n    if screenState==3 then\n     if (keypad_input_dest~=\"\") then\n      if routing_timer then unit.stopTimer(\"routing\") end\n      keypad_input_dest=nil\n      databank.setStringValue(\"navigator_target_destination\", \"no Dest.\")\n      destination_inserted=false\n      destination_coord=nil\n      databank.setStringValue(\"navigator_coordinates\", \"n/a\")\n      distance_to_go=\"\"\n      databank.setFloatValue(\"navigator_target_planet_radius\", 0)\n     end\n    end\n\n   --CLR Settings\n    if screenState==8 then  --(WP Sync)\n     if WPSYNCSelect[1]==\"select\" then\n      keypad_input_shipid=\"No ID\"\n      ship_id=keypad_input_shipid\n      databank.setStringValue(\"Ship ID\", ship_id)\n      ShipIdCheck=false\n     end\n    elseif screenState==12 then --(DB reset)\n     if DBRESSelect[1]==\"select\" then db_mark_1=\"\" db_mark_1_TF=false\n     elseif DBRESSelect[2]==\"select\" then db_mark_2=\"\" db_mark_2_TF=false\n     elseif DBRESSelect[3]==\"select\" then db_mark_3=\"\" db_mark_3_TF=false\n     elseif DBRESSelect[4]==\"select\" then db_mark_4=\"\" db_mark_4_TF=false\n     elseif DBRESSelect[5]==\"select\" then db_mark_5=\"\" db_mark_5_TF=false\n     elseif DBRESSelect[6]==\"select\" then databank_clean(db_mark_1_TF, db_mark_2_TF, db_mark_3_TF, db_mark_4_TF, db_mark_5_TF)\n     end\n    elseif screenState==16 then --(WP Setting)\n     if WPSETTINGSelect[1]==\"select\" then\n      keypad_input_wp_altitude=\"\"\n      wp_altitude_inserted=false\n     elseif WPSETTINGSelect[2]==\"select\" then\n      keypad_input_wp_speed=\"\"\n      wp_speed_inserted=false\n     end\n     ent_button()\n    end\n\n  end\n \n--SCREEN GENERATOR ( &#8592;)( &#8593;)( &#8594;)( &#8595;)\n --MAIN MENU               (screenState=-1)\n  function MainMenu()\n   if MenuSelect==nil then MenuSelect={[0]=\"0\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"} end\n   if MenuTick==nil then MenuTick=1 MenuSelect[1]=\"select\" else MenuSelect[MenuTick]=\"select\" end\n   local List={\"Time Calculator\",\"ATLAS\",\"WP\",\"FROM\",\"DESTINATION\",\"PE Target Altitude\",\"Shield\",\"Settings\"}\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart ..[[px;left:]].. xStart ..[[px;\">\n    <table class=\"bkgnd\" width=\"]].. MenuW ..[[\">\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" width=\"]].. MenuW ..[[\">]].. ship_id ..[[</td></tr>]]\n    for i=1, #List do\n     HUD_HTML[#HUD_HTML+1]=[[<tr height=\"]].. MenuY ..[[\"><td class=\"]].. MenuSelect[i] ..[[\" width=\"]].. MenuW ..[[\">]].. List[i] ..[[<span class=\"Fright\">></span></td></tr>]]\n    end\n    HUD_HTML[#HUD_HTML+1]=[[</table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --STORED WAYPOINTS        (screenState=0)\n  function stored_waypoints_1()\n   local dbKeys=databank.getNbKeys()\n   local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n   ext=json.decode(ext)\n   local wp_setting_color_l=\"\"\n   local wp_setting_color_r=\"\"\n   local sel=\"\"\n\n   order_list={}\n   for i=1, dbKeys do\n    local dbkey=\"wp\"..i\n    local value=databank.getStringValue(dbkey)\n    if value~=\"\" then\n     table.insert(order_list, value)\n     table.sort(order_list)\n    end\n   end\n\n   wp_list={}\n   wp_counter=0\n   for i=1, #order_list do\n    local dbkeysort=order_list[i]\n    for x=1, dbKeys do\n     local key=\"wp\"..x\n     local v=databank.getStringValue(key)\n     if dbkeysort==v then\n      wp_counter=wp_counter + 1\n      local id=\"wp\"..wp_counter\n      if ext[v]~=nil then\n       if (ext[v].alt~=\"\" or ext[v].s~=\"\") then sel=\"*\" end\n      else sel=\"\" end\n      wp_list[wp_counter]={[\"id\"]=id,[\"wp\"]=key,[\"name\"]=v,[\"settings\"]=sel}\n      break\n     end\n    end\n   end\n   wp_pages=generating_wp_pages(0)\n   if wp_page_index==nil then wp_page_index=1 else wp_page_index=wp_page_index end\n\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n    <table class=\"bkgnd\" width=\"500px\">\n    <tr height=\"]].. MenuY ..[[\"><td colspan=\"4\" class=\"Title ]].. WPSelect[0] ..[[\"><span class=\"Fleft\">&#8592;</span> &#8592; Page ]]..wp_page_index..[[ / ]]..wp_pages..[[ &#8594;</td></tr>]]\n\n   local index=(wp_page_index*10)-9\n   local x=0\n   for i=index, (index+4) do\n    if i<=wp_counter then wp_id_l=wp_list[i].wp else wp_id_l=\"\" end\n    if (i+5)<=wp_counter then wp_id_r=wp_list[i+5].wp else wp_id_r=\"\" end\n    x=x+1\n    local tick_l=WPSelect[x]\n    local tick_r=WPSelect[x+5]\n        \n    wp_name_l=databank.getStringValue(wp_id_l)\n    if ext[wp_name_l] then      \n     if wp_list[i].settings==\"*\" then wp_setting_color_l=\"green\" end\n    else wp_setting_color_l=\"\" end\n\n    wp_name_r=databank.getStringValue(wp_id_r)\n    if ext[wp_name_r] then \n     if wp_list[i+5].settings==\"*\" then wp_setting_color_r=\"green\" end\n    else wp_setting_color_r=\"\" end\n\n    HUD_HTML[#HUD_HTML+1]=[[\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" width=\"40px\">]]..i..[[</td><td class=\"]]..wp_setting_color_l..[[ ]]..tick_l..[[\" width=\"210vw\">]].. wp_name_l ..[[<span class=\"Fright\">></span></td><td class=\"Title\" width=\"40px\">]]..(i+5)..[[</td><td class=\"]]..wp_setting_color_r..[[ ]]..tick_r..[[\" width=\"210vw\">]].. wp_name_r ..[[<span class=\"Fright\">></span></td></tr>]]\n   end\n   HUD_HTML[#HUD_HTML+1]=[[</table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --ATLAS LIST              (screenState=6)\n  function atlas_list_page()\n   atlas_list={}\n   atlas_pages=0\n   atlas_counter=0\n   for i, v in pairs(atlas[0]) do\n    atlas_counter=atlas_counter + 1\n    local name=atlas[0][i].name[1]\n    table.insert(atlas_list, name)\n    table.sort(atlas_list)\n   end\n\n   atlas_pages=math.ceil(atlas_counter/10)\n   atlas_page_index=atlas_page_index\n\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n    <table class=\"bkgnd\" width=\"500px\">\n    <tr height=\"]].. MenuY ..[[\"><td colspan=\"4\" class=\"Title ]].. ATLASSelect[0] ..[[\"><span class=\"Fleft\">&#8592;</span> &#8592; Page ]]..atlas_page_index..[[ / ]]..atlas_pages..[[ &#8594;</td></tr>]]\n\n   local index=(atlas_page_index*10)-9\n   local x=0\n   for i=index, (index+4) do\n    if i<=atlas_counter then atlas_id_l=atlas_list[i]\n    else atlas_id_l=\"\" end\n    if (i+5)<=atlas_counter then atlas_id_r=atlas_list[i+5]\n    else atlas_id_r=\"\" end\n    x=x+1\n    local tick_l=ATLASSelect[x]\n    local tick_r=ATLASSelect[x+5]\n\n    HUD_HTML[#HUD_HTML+1]=[[\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" width=\"40px\">]]..i..[[</td><td class=\"]].. tick_l ..[[\" width=\"210px\">]].. atlas_id_l ..[[<span class=\"Fright\">></span></td><td class=\"Title\" width=\"40px\">]]..(i+5)..[[</td><td class=\"]].. tick_r ..[[\" width=\"210px\">]].. atlas_id_r ..[[<span class=\"Fright\">></span></td></tr>]]\n   end\n   HUD_HTML[#HUD_HTML+1]=[[</table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --SELECTED ITEM           (SelectionIsTrue)\n  function SelectedItem()\n   if SelectionList==nil then SelectionList={} end\n   if WPclr==nil then WPclr={\"\",\"\",\"\",\"\",\"\",\"\",\"\"} end\n   local List={}\n   if screenState==6 then atlas_list_page()\n    List={\"Destination\",\"From\"}\n   elseif screenState==0 then stored_waypoints_1()\n    List={\"Settings\",\"Destination\",\"From\",\"Clear\",\"+ Route\",\"+ Route and HOLD\",\"- Route\"}\n   elseif screenState==9 then settings_menu()\n    List={\"Execute\",\"Clear\"}\n   end\n\n   if #SelectionList~=#List then\n    SelectionList[0]=\"0\"\n    for i=1, #List do if i==1 then SelectionList[i]=\"select\" else SelectionList[i]=\"\" end end\n   end\n   local DiffW=250\n   local DiffH=(MenuY * CellSelected)\n   if CellSelected>5 then DiffW=500 DiffH=(MenuY * (CellSelected-5)) end\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick)+DiffH ..[[px;left:]].. (xStart+MenuW+10+DiffW) ..[[px;\">\n    <table class=\"bkgndSolid\" width=\"]].. MenuW ..[[\">]]\n   for i=1, #List do\n    HUD_HTML[#HUD_HTML+1]=[[<tr height=\"]].. MenuY ..[[\"><td class=\"]].. SelectionList[i] ..[[\">]].. List[i] ..[[<span class=\"]].. WPclr[i] ..[[ Fright\">ent &#8594;</span></td></tr>]]\n   end\n   HUD_HTML[#HUD_HTML+1]=[[</table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --SU DISTANCE TIME PAGE   (screenState=1)\n  function su_distance_time()\n   if TimeCalcSelect==nil then TimeCalcSelect={\"select\",\"\"} end\n   if time_to_go==nil then time_to_go=\"\" end\n   if su_distance_inserted==nil then su_distance_inserted=false end\n   if speed_inserted==nil then speed_inserted=false end\n   if distance_to_go~=nil then\n    if distance_to_go~=\"\" then\n    keypad_input_su=distance_to_go\n    databank.setFloatValue(\"navigator_distance\", keypad_input_su)\n    su_distance_inserted=true\n    su_tick=\"\"\n    TimeCalcSelect[1]=\"\"\n    speed_tick=\">\"\n    TimeCalcSelect[2]=\"select\"\n    end\n   end\n\n   if (tonumber(keypad_input_su)==nil or keypad_input_su==\".\") then\n    keypad_input_su=\"\"\n    su_tick=\">\"\n    TimeCalcSelect[1]=\"select\"\n    speed_tick=\"\"\n    TimeCalcSelect[2]=\"\"\n   end\n   if (tonumber(keypad_input_speed)==nil or keypad_input_speed==\".\") then keypad_input_speed=\"\" end\n   if time_to_go==nil then time_to_go=\"\" end\n\n   if (keypad_input_su==nil or keypad_input_su==\"\") then warp_distance=0\n   else warp_distance=keypad_input_su end\n\n   if (keypad_input_su~=\"\" or keypad_input_su~=\"\") then\n    TimeCalcSelect[1]=\"\"\n    TimeCalcSelect[2]=\"select\"\n   end\n\n   if tonumber(warp_distance)==nil then warp_distance=0 end\n   MinWpCells=math.floor((core.getConstructMass()/1000) * warp_distance * 0.00025)\n   MaxWpCells=math.floor((new_MTOW) * warp_distance * 0.00025)\n\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. (yStart+MenuY) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n    <table class=\"bkgnd\" width=\"300px\">\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" colspan=\"2\">Insert The Distance</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"]].. TimeCalcSelect[1] ..[[\" colspan=\"2\"><span class=\"Fleft\">&#8592;</span>]].. keypad_input_su ..[[&nbsp<span class=\"Units\">Su</span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" colspan=\"2\">Insert Cruising Speed</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"]].. TimeCalcSelect[2] ..[[\" colspan=\"2\"><span class=\"Fleft\">&#8592; &#8593; clr</span>]].. keypad_input_speed ..[[&nbsp<span class=\"Units\">Km/h</span><span class=\"Fright\">ent &#8595;</span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td width=\"150px\" class=\"Title\">ETA After</td><td class=\"Title\">Warp Cells</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td>]].. time_to_go ..[[</td><td>]].. math.floor((core.getConstructMass()/1000) * warp_distance * 0.00025) ..[[<span class=\"Title\">&nbsp Max:&nbsp</span>]].. math.floor((new_MTOW) * warp_distance * 0.00025) ..[[</td></tr>\n    </table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --FROM PAGE               (screenState=2)\n  function from()\n   if FROMclr==nil then FROMclr=\"\" end\n   if (databank.getStringValue(\"navigator_from\")~=\"no From\" and databank.getStringValue(\"navigator_from\")~=\"PPOS\") then keypad_input_from=databank.getStringValue(\"from\") end\n\n   if from_inserted==nil then\n    from_inserted=false\n    FROMSelect[1]=\"select\"\n    keypad_input_wpname=\"\"\n    wpname_inserted=false\n    FROMSelect[2]=\"\"\n    stored=\"\"\n   end\n\n   if keypad_input_from==nil then\n    keypad_input_from=\"\"\n    from_coordinates=\"\"\n    from_inserted=false\n    FROMSelect[1]=\"select\"\n    keypad_input_wpname=\"\"\n    wpname_inserted=false\n    FROMSelect[2]=\"\"\n    stored=\"\"\n   end\n\n   if from_coordinates~=\"\" then FROMSelect[1]=\"\" FROMSelect[2]=\"select\" end\n\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n    <table class=\"bkgnd\" width=\"500px\">\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" colspan=\"2\">Insert Departure or Arrow Down for PPOS</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"]].. FROMSelect[1] ..[[\" colspan=\"2\"><span class=\"Fleft\"> &#8592; &#8595; ppos</span>]].. keypad_input_from ..[[</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" colspan=\"2\">Coordinates</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\">]].. tostring(from_coordinates) ..[[</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" colspan=\"2\">WP Add / Rename</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td width=\"250px\" class=\"]].. FROMSelect[2] ..[[\"><span class=\"Fleft\"> &#8592; <span class=\"]].. FROMclr ..[[\">&#8593; clr</span></span>]].. keypad_input_wpname ..[[<span class=\"Fright\">ad/rn wp &#8594;</span></td><td width=\"250px\">]].. stored ..[[</td></tr>\n    </table></div>]]\n   stored=\"\"\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --DESTINATION PAGE        (screenState=3)\n  function distance_to_wp()\n   if DESTclr==nil then DESTclr=\"\" end\n   if (databank.getStringValue(\"navigator_target_destination\")~=\"no Dest.\") then\n    keypad_input_dest=databank.getStringValue(\"to\")\n    distance_to_go=databank.getFloatValue(\"navigator_distance\")\n    distance_to_go_warp=databank.getFloatValue(\"navigator_distance\")\n   end\n\n   if destination_inserted==nil then destination_inserted=false end\n\n   if keypad_input_dest==nil then\n    keypad_input_dest=\"\"\n    destination_coord=\"\"\n    distance_to_go=\"\"\n    distance_to_go_warp=0\n   else keypad_input_dest=keypad_input_dest end\n\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n    <table class=\"bkgnd\" width=\"500px\">\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" colspan=\"2\">Insert Destination</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"select\" colspan=\"2\"><span class=\"Fleft\"> &#8592; <span class=\"]].. DESTclr ..[[\">&#8593; clr</span></span>]].. keypad_input_dest ..[[</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td width=\"300px\" class=\"Title\">Distance</td><td width=\"200px\" class=\"Title\">Warp Cells</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td>]] .. distance_to_go .. [[&nbsp<span class=\"Units\">Su</span></td><td>]].. math.floor((core.getConstructMass()/1000) * distance_to_go_warp * 0.00025) ..[[<span class=\"Title\">&nbsp Max:&nbsp</span>]].. math.floor((new_MTOW) * distance_to_go_warp * 0.00025) ..[[</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" colspan=\"2\">Coordinates</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\">]].. tostring(destination_coord) ..[[</td></tr>\n    </table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --TARGET PE ALTITUDE PAGE (screenState=4)\n  function target_pe_altitude()\n   if target_alt_warning==nil then target_alt_warning=\"\" end\n   if target_pe_altitude_inserted==nil then target_pe_altitude_inserted=false end\n\n   if (databank.getFloatValue(\"PE_altitude\")~=0) then stored_pe_target_alt=math.floor(databank.getFloatValue(\"PE_altitude\"))\n   else stored_pe_target_alt=factory_PE_target_altitude end\n\n   if keypad_input_pe_target_alt==nil then\n    keypad_input_pe_target_alt=\"\"\n    target_pe_altitude_inserted=false\n   else keypad_input_pe_target_alt=keypad_input_pe_target_alt end\n\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n    <table class=\"bkgnd\" width=\"500px\">\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Insert PE Target Altitude</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"select\"><span class=\"Fleft\"> &#8592;</span>]].. keypad_input_pe_target_alt ..[[&nbsp<span class=\"Units\">m</span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td>]].. target_alt_warning ..[[</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Stored Altitude</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td>]].. stored_pe_target_alt ..[[&nbsp<span class=\"Units\">m</span></td></tr>\n    </table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --SHIELD                  (screenState=17)\n  function shieldFunction()\n   if SHIELDSelect==nil then SHIELDSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"} end\n   if EnergyDistribution==nil then EnergyDistribution=false end\n   local EnergyPool=(shield.getResistancesPool())*100\n   if EnergyDistribution==false then  EneryLeft=(shield.getResistancesRemaining())*100 end\n   local ShieldEnergyPool=string.format(\"%.0f / %.0f\", EneryLeft, EnergyPool)\n\n   local shieldHp=shield.getShieldHitpoints()\n   local shieldMaxHp=shield.getMaxShieldHitpoints()\n   local ShieldPercent=(shieldHp/shieldMaxHp*100)\n   \n   local ShieldStress=shield.getStressRatio()\n   local San=tonumber(string.format(\"%.0f\", (ShieldStress[1]*100)))\n   local Sel=tonumber(string.format(\"%.0f\", (ShieldStress[2]*100)))\n   local Ski=tonumber(string.format(\"%.0f\", (ShieldStress[3]*100)))\n   local Sth=tonumber(string.format(\"%.0f\", (ShieldStress[4]*100)))\n\n   local ResistanceTable=shield.getResistances()\n   local an=tonumber(string.format(\"%.0f\", (ResistanceTable[1]*100)+10))\n   local el=tonumber(string.format(\"%.0f\", (ResistanceTable[2]*100)+10))\n   local ki=tonumber(string.format(\"%.0f\", (ResistanceTable[3]*100)+10))\n   local th=tonumber(string.format(\"%.0f\", (ResistanceTable[4]*100)+10))\n   if (an==10 and el==10 and ki==10 and th==10) then ShieldBaseEnergy=true else ShieldBaseEnergy=false end\n\n   if ScreenSelection~=\"\" then\n    local x=ScreenSelection\n    ScreenSelection=\"\"\n    if x==\"ShieldToggle\" then shield.toggle()\n    elseif x==\"VENTING\" then if shield.isVenting()==1 then shield.stopVenting() else shield.startVenting() end\n    elseif x==\"RESET\" then\n     if EnergyDistribution then menu(\"Shield\")\n     elseif ShieldBaseEnergy==false then\n      Ran, Rel, Rki, Rth=10, 10, 10, 10\n      shield.setResistances(0,0,0,0)--setResistances(antimatter,electromagnetic,kinetic,thermic)\n      ShieldBaseEnergy=true\n     end\n    elseif x==\"A-\" then if Ran>=15 then Ran=Ran-5 EneryLeft=EneryLeft+5 end\n    elseif x==\"A+\" then if EneryLeft>=5 then Ran=Ran+5 EneryLeft=EneryLeft-5 end\n    elseif x==\"E-\" then if Rel>=15 then Rel=Rel-5 EneryLeft=EneryLeft+5 end\n    elseif x==\"E+\" then if EneryLeft>=5 then Rel=Rel+5 EneryLeft=EneryLeft-5 end\n    elseif x==\"K-\" then if Rki>=15 then Rki=Rki-5 EneryLeft=EneryLeft+5 end\n    elseif x==\"K+\" then if EneryLeft>=5 then Rki=Rki+5 EneryLeft=EneryLeft-5 end\n    elseif x==\"T-\" then if Rth>=15 then Rth=Rth-5 EneryLeft=EneryLeft+5 end\n    elseif x==\"T+\" then if EneryLeft>=5 then Rth=Rth+5 EneryLeft=EneryLeft-5 end\n    elseif (x==\"SET\" and EnergyDistribution) then\n     shield.setResistances((Ran-10)/100,(Rel-10)/100,(Rki-10)/100,(Rth-10)/100)\n     EnergyDistribution=false\n    end\n   end\n   if (Ran~=an or Rel~=el or Rki~=ki or Rth~=th) then EnergyDistribution=true else EnergyDistribution=false end\n   local EnergyColor=\"Title\"\n   if EnergyDistribution then EnergyColor=\"Units\" end\n  \n   local ShieldOnOff=\"RAISE\"\n   local ShieldOpacity=0.2\n   local isActive=shield.getState()\n   if isActive==1 then ShieldOnOff=\"DROP\" ShieldOpacity=1 end\n\n   local ShieldVENT=\"VENTING\"\n   local ventCool=shield.getVentingCooldown()\n   if ventCool>0 then ShieldVENT=string.format(\"%.0f\", ventCool) ..\" STOP\" end\n\n   local ShieldSET=\"SET\"\n   local ShieldRESET=\"RESET\"\n   local resCool=shield.getResistancesCooldown()\n   if resCool>0 then ShieldSET=string.format(\"%.0f\", resCool) end\n\n   local ShieldStressTable={San,Sel,Ski,Sth}\n   local Buttons={ShieldOnOff,ShieldVENT,ShieldSET,ShieldRESET}\n   local ShieldData={ShieldPercent,ShieldEnergyPool,an,el,ki,th}\n   if EnergyDistribution then ShieldData={ShieldPercent,ShieldEnergyPool,Ran,Rel,Rki,Rth} end\n\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n    <table class=\"bkgnd\" width=\"500px\">\n    <tr height=\"]].. MenuY ..[[\"><td colspan=\"4\" class=\"]].. SHIELDSelect[0] ..[[ Title\"><span class=\"Fleft\"> &#8592;</span>Shield</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td width=\"200px\" class=\"]].. SHIELDSelect[1] ..[[\">]].. Buttons[1] ..[[<span class=\"Fright\">ent &#8594;</span></td><td width=\"300px\" colspan=\"3\">]].. ShieldData[1] ..[[ %</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"]].. SHIELDSelect[2] ..[[\">]].. Buttons[2] ..[[<span class=\"Fright\">ent &#8594;</span></td>\n     <td colspan=\"3\"><span class=\"Fleft\"><svg width=\"]].. ((ShieldData[1]*300)/100) ..[[px\" height=\"]].. MenuY ..[[\"><rect x=\"0\" y=\"5\" width=\"100%\" height=\"100%\" style=\"fill:yellow\" opacity=\"]].. ShieldOpacity ..[[\"/></svg></span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Energy Pool</td><td width=\"160px\" class=\"]].. SHIELDSelect[5] ..[[ Title\"><span class=\"Fleft\"> &#8592; -5</span>A<span class=\"Fright\">+5 &#8594;</span></td><td width=\"40px\" class=\"]].. EnergyColor ..[[\">]].. ShieldData[3] ..[[</td>\n     <td width=\"100px\"><span class=\"Fleft\"><svg width=\"]].. ((ShieldStressTable[1]*100)/100) ..[[px\" height=\"]].. MenuY ..[[\"><rect x=\"2\" y=\"5\" width=\"100%\" height=\"100%\" style=\"fill:red\"/></svg></span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td>]].. ShieldData[2] ..[[</td><td class=\"]].. SHIELDSelect[6] ..[[ Title\"><span class=\"Fleft\"> &#8592; -5</span>E<span class=\"Fright\">+5 &#8594;</span></td><td class=\"]].. EnergyColor ..[[\">]].. ShieldData[4] ..[[</td>\n     <td><span class=\"Fleft\"><svg width=\"]].. ((ShieldStressTable[2]*100)/100) ..[[px\" height=\"]].. MenuY ..[[\"><rect x=\"2\" y=\"5\" width=\"100%\" height=\"100%\" style=\"fill:red\"/></svg></span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"]].. SHIELDSelect[3] ..[[\">]].. Buttons[3] ..[[<span class=\"Fright\">ent &#8594;</span></td><td class=\"]].. SHIELDSelect[7] ..[[ Title\"><span class=\"Fleft\"> &#8592; -5</span>K<span class=\"Fright\">+5 &#8594;</span></td><td class=\"]].. EnergyColor ..[[\">]].. ShieldData[5] ..[[</td>\n     <td><span class=\"Fleft\"><svg width=\"]].. ((ShieldStressTable[3]*100)/100) ..[[px\" height=\"]].. MenuY ..[[\"><rect x=\"2\" y=\"5\" width=\"100%\" height=\"100%\" style=\"fill:red\"/></svg></span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"]].. SHIELDSelect[4] ..[[\">]].. Buttons[4] ..[[<span class=\"Fright\">ent &#8594;</span></td><td class=\"]].. SHIELDSelect[8] ..[[ Title\"><span class=\"Fleft\"> &#8592; -5</span>T<span class=\"Fright\">+5 &#8594;</span></td><td class=\"]].. EnergyColor ..[[\">]].. ShieldData[6] ..[[</td>\n     <td><span class=\"Fleft\"><svg width=\"]].. ((ShieldStressTable[4]*100)/100) ..[[px\" height=\"]].. MenuY ..[[\"><rect x=\"2\" y=\"5\" width=\"100%\" height=\"100%\" style=\"fill:red\"/></svg></span></td></tr>\n    </table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --PVP INFO\n  function PVPInfoFunction()\n   local cooldown=math.floor(shield.getVentingCooldown())\n   if cooldown==0 then cooldown=\"\" end\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:10px;left:]].. (ScrW/2)-(MenuW/2) ..[[px;\">\n    <table class=\"bkgnd\" width=\"]].. MenuW ..[[px\">\n    <tr height=\"]].. MenuY ..[[px\"><td class=\"Title pvp\" width=\"]].. MenuW ..[[px\">\n    <span class=\"Fleft\">SHIFT+G Start/Stop VENTING</span>\n    <span class=\"Fright\">]].. cooldown ..[[</span>\n    </td></tr>\n    </table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --WP SETTINGS             (screenState=16)\n  function wp_settings()\n   if WPSETTINGSelect==nil then WPSETTINGSelect={[0]=\"select\",\"\",\"\"} end\n   if WPSETclr==nil then WPSETclr={\"\",\"\"} end\n   if tonumber(keypad_input_wp_altitude)==nil then keypad_input_wp_altitude=\"\" end\n   if tonumber(keypad_input_wp_speed)==nil then keypad_input_wp_speed=\"\" end\n\n   local DivPos=\"\"\n   if ScreenOrigin==-1 then DivPos=[[<div style=\"position:absolute;top:]].. yStart+(MenuY * (MenuTick-8)) ..[[px;right:]].. (xStart+MenuW+20) ..[[px;\">]]\n   else DivPos=[[<div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">]] end\n   HUD_HTML[#HUD_HTML+1]=DivPos..[[\n    <table class=\"bkgnd\" width=\"500px\">\n    <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\" class=\"]].. WPSETTINGSelect[0] ..[[ Title\"><span class=\"Fleft\">&#8592;</span> WP: ]].. edit_wp ..[[</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td width=\"250px\" class=\"Title\">Altitude</td><td width=\"250px\" class=\"]].. WPSETTINGSelect[1] ..[[\"><span class=\"]].. WPSETclr[1] ..[[ Fleft\"> &#8592; clr</span>]].. keypad_input_wp_altitude ..[[&nbsp<span class=\"Units\">m</span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Speed</td><td class=\"]].. WPSETTINGSelect[2] ..[[\"><span class=\"]].. WPSETclr[2] ..[[ Fleft\"> &#8592; clr</span>]].. keypad_input_wp_speed ..[[&nbsp<span class=\"Units\">Km/h</span></td></tr>\n    </table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --ROUTING                 (screenState=15)\n  function FindWP()\n   if WpRouteList[IDToNextWp]~=\"HOLD\" then\n    for i=1, #wp_list do\n     if wp_list[i].name==WpRouteList[IDToNextWp] then\n      local WpID=wp_list[i].id\n      WpID=WpID:gsub(\"wp\", \"\")\n      for i=1, #WpRouteList do\n       FlyStat[i]=\"\"\n       if WpRouteList[i]~=\"HOLD\" then GoTo[i]=\"Go To &#8594;\" end\n      end\n      FlyStat[IDToNextWp]=\"To &#8594; \"\n      GoTo[IDToNextWp]=\"\"\n      DistToNextWp=DistToNextWp+1\n      ent_to_wp(tonumber(WpID))\n      break\n     end\n    end\n   end\n  end\n\n  function route_page()\n   if ROUTESelect==nil then ROUTESelect={} end\n   if InitRoute==nil then InitRoute=false end \n   RouteStatus=\"Inactive\"\n   if (RouteActivated and RouteStatus~=\"Holding\") then RouteStatus=\"Activated\" end\n   local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n   ext=json.decode(ext)\n   WpSettingsList=ext\n   databank.setIntValue(\"Holding\", 0)\n\n   WPCoordinates={}\n   local myPos=vec3(core.getConstructWorldPos())\n   local distance=\"\"   \n   local vec3_coord=\"\"\n   for i=1, #WpRouteList do\n    local WpName=WpRouteList[i]\n    for x=1, #wp_list do\n     local wp_id=\"wp\"..x\n     local wpMatch=databank.getStringValue(wp_id)\n     if wpMatch==WpName then\n      local wp_coord=databank.getStringValue(wp_id..\"_coord\")\n      vec3_coord=vec3FromStr(wp_coord)\n      WPCoordinates[i]=vec3_coord\n      distance=math.floor(((vec3(vec3_coord) - myPos):len())/1000*100)/100\n      if distance>200 then DistanceList[i]=math.floor((distance/200)*100)/100 ..\" Su\"\n      else DistanceList[i]=distance ..\" Km\" end\n      break\n     elseif WpName==\"HOLD\" then DistanceList[i]=\"Holding\" end\n    end\n   end\n\n   if (InitRoute==false and RouteActivated) then\n    InitRoute=true\n    IDToNextWp=1\n    DistToNextWp=0\n    FindWP()\n    unit.setTimer(\"routing\", 1)\n   elseif (InitRoute==true and RouteActivated and RouteStatus~=\"Holding\") then\n    local distanceSTR=DistanceList[DistToNextWp]\n    if WpRouteList[IDToNextWp]~=\"HOLD\" then distance=distanceSTR:gsub(\"%a\", \"\")\n    else distance=nil end\n    if tonumber(distance)~=nil then\n     databank.setIntValue(\"Holding\", 0)\n     distance=tonumber(distance)\n     local d=math.sqrt((wp_sequencing_distance)^2 + ((math.floor(core.getAltitude())/1000)^2))\n     if (distance<d) then IDToNextWp=IDToNextWp+1\n      if (WpRouteList[IDToNextWp]~=nil and WpRouteList[IDToNextWp]~=\"HOLD\") then FindWP()\n      elseif WpRouteList[IDToNextWp]~=\"HOLD\" then IDToNextWp=1 DistToNextWp=0 FindWP()\n      end\n     end\n    elseif WpRouteList[IDToNextWp]==\"HOLD\" then\n     databank.setIntValue(\"Holding\", 1)\n     RouteStatus=\"Holding\"\n    end\n   end\n\n   local LeftForSett=\"\"\n   if RouteActivated then LeftForSett=[[<span class=\"Fleft\">&#8592; wp sett.</span>]] else LeftForSett=\"\" end\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart ..[[px;right:]].. xStart-80 ..[[px;\">\n    <table class=\"bkgnd\" width=\"]].. (MenuW + MenuW/2) ..[[\">\n    <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\" class=\"Title\" width=\"]].. MenuW ..[[\">]].. LeftForSett ..[[ROUTE: ]].. RouteStatus ..[[</td></tr>]]\n    for i=1, #WpRouteList do\n     if MenuSelect[i+8] then ROUTESelect[i]=MenuSelect[i+8] else ROUTESelect[i]=\"\" end\n     if MenuSelect[i+8]==nil then ROUTESelect[i]=\"\" end\n     if WpRouteList[i]==nil then WpRouteList[i]=\"\" end\n     if DistanceList[i]==nil then DistanceList[i]=\"\" end\n     if FlyStat[i]==nil then FlyStat[i]=\"\" end\n     if GoTo[i]==nil then GoTo[i]=\"\" end\n     if WpSettingsList[WpRouteList[i]] then ItHasSettings[i]=\"green\" else ItHasSettings[i]=\"\" end\n     HUD_HTML[#HUD_HTML+1]=[[<tr height=\"]].. MenuY ..[[\">\n      <td class=\"]].. ROUTESelect[i] ..[[\" width=\"]].. MenuW ..[[\"><span class=\"]].. ItHasSettings[i] ..[[ Fleft\"><span class=\"Title\">]].. FlyStat[i] ..[[</span>]].. WpRouteList[i] ..[[</span><span class=\"Fright\">]].. GoTo[i] ..[[</span></td>\n      <td width=\"]]..  MenuW/2 ..[[\">]].. DistanceList[i] ..[[</td></tr>]]\n    end\n    HUD_HTML[#HUD_HTML+1]=[[</table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n\n --SETTINGS MENU           (screenState=9)\n  function settings_menu()\n   if SETTINGSSelect==nil then SETTINGSSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"} end\n   HUD_HTML[#HUD_HTML+1]=[[\n    <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n    <table class=\"bkgnd\" width=\"500px\">\n    <tr height=\"]].. MenuY ..[[\"><td colspan=\"4\" class=\"]].. SETTINGSSelect[0] ..[[ Title\"><span class=\"Fleft\"> &#8592;</span>Settings</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\" width=\"40px\">1</td><td class=\"]].. SETTINGSSelect[1] ..[[\" width=\"210px\">Ship Settings<span class=\"Fright\">></span></td><td class=\"Title\" width=\"40px\">6</td><td class=\"]].. SETTINGSSelect[6] ..[[\" width=\"210px\">DB Reset<span class=\"Fright\">></span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">2</td><td class=\"]].. SETTINGSSelect[2] ..[[\">WP Store<span class=\"Fright\">></span></td><td class=\"Title\">7</td><td class=\"]].. SETTINGSSelect[7] ..[[\">Route<span class=\"Fright\">></span></td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">3</td><td class=\"]].. SETTINGSSelect[3] ..[[\">WP Sync<span class=\"Fright\">></span></td><td class=\"Title\">8</td><td class=\"]].. SETTINGSSelect[8] ..[[\">---</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">4</td><td class=\"]].. SETTINGSSelect[4] ..[[\">Interface Colors<span class=\"Fright\">></span></td><td class=\"Title\">9</td><td class=\"]].. SETTINGSSelect[9] ..[[\">---</td></tr>\n    <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">5</td><td class=\"]].. SETTINGSSelect[5] ..[[\">DMG Report<span class=\"Fright\">></span></td><td class=\"Title\">10</td><td class=\"]].. SETTINGSSelect[10] ..[[\">---</td></tr>\n    </table></div>]]\n   local HTML=table.concat(HUD_HTML)\n   return HTML\n  end\n  --SETTINGS PAGE 1        (Ship Settings)(screenState=5)\n   function settings1()\n    if SHIPSETINGSSelect==nil then SHIPSETINGSSelect={[0]=\"select\",\"\",\"\",\"\",\"\"} end\n    if keypad_input_MTOW==nil then\n     keypad_input_MTOW=factory_MTOW/1000\n     new_MTOW=factory_MTOW/1000\n    end\n    if keypad_input_autobrake==nil then keypad_input_autobrake=factory_autobrake end\n    if keypad_input_wpdist==nil then keypad_input_wpdist=wp_sequencing_distance end\n    if keypad_input_holding==nil then keypad_input_holding=holding_speed end\n\n    HUD_HTML[#HUD_HTML+1]=[[\n     <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n     <table class=\"bkgnd\" width=\"500px\">\n     <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\" class=\"]].. SHIPSETINGSSelect[0] ..[[ Title\"><span class=\"Fleft\"> &#8592;</span>Ship Settings</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td width=\"250px\" class=\"Title\">MTOW</td><td width=\"250px\" class=\"]].. SHIPSETINGSSelect[1] ..[[\">]].. keypad_input_MTOW ..[[&nbsp<span class=\"Units\">t</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Autobrake</td><td class=\"]].. SHIPSETINGSSelect[2] ..[[\">]].. keypad_input_autobrake ..[[&nbsp<span class=\"Units\">Su</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Dist. To WP</td><td class=\"]].. SHIPSETINGSSelect[3] ..[[\">]].. keypad_input_wpdist ..[[&nbsp<span class=\"Units\">Km</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Holding Speed</td><td class=\"]].. SHIPSETINGSSelect[4] ..[[\">]].. keypad_input_holding ..[[&nbsp<span class=\"Units\">Km/h</span></td></tr>\n     </table></div>]]\n    local HTML=table.concat(HUD_HTML)\n    return HTML\n   end\n\n  --SETTINGS PAGE 2        (WP Store)(screenState=7)\n   function settings2()\n    if WPSTORESelect==nil then WPSTORESelect={[0]=\"select\",\"\",\"\",\"\",\"\"} end\n    if databank.getStringValue(\"to\")~=nil then\n     for i, v in pairs(atlas[0]) do\n      if atlas[0][i].name[1]==keypad_input_dest then wp_selected_planet=databank.getStringValue(\"to\") end\n     end\n    else wp_selected_planet=\"\" end\n\n    if (wp_selected_planet==nil or wp_selected_planet==\"\" or wp_selected_planet==\"Set Destination or Past Coord.\") then\n     wp_selected_planet=\"Set Destination or Past Coord.\"\n     WPSTORESelect={[0]=\"select\",\"\",\"\",\"\",\"\"}\n     stored=\"\"\n    end\n\n    if (keypad_input_wp_name==nil or keypad_input_wp_name==\"\") then\n     keypad_input_wp_name=\"\"\n     wp_name_inserted=false\n    else wp_name_inserted=true end\n\n    if (tonumber(keypad_input_wp_lat)==nil or keypad_input_wp_lat==\"\") then\n     keypad_input_wp_lat=\"\"\n     wp_lat_inserted=false\n    else wp_lat_inserted=true end\n\n    if (tonumber(keypad_input_wp_lon)==nil or keypad_input_wp_lon==\"\") then\n     keypad_input_wp_lon=\"\"\n     wp_lon_inserted=false\n    else wp_lon_inserted=true end\n\n    if (tonumber(keypad_input_wp_alt)==nil or keypad_input_wp_alt==\"\") then\n     keypad_input_wp_alt=\"\"\n     wp_alt_inserted=false\n    else wp_alt_inserted=true end\n\n    if (wp_selected_planet~=\"World Coordinates\" and wp_name_inserted==true and wp_lat_inserted==true and wp_lon_inserted==true and wp_alt_inserted==true) then\n     wp_coordinated_stored=tostring(coord_converter())\n    else wp_coordinated_stored=\"\" end\n\n    HUD_HTML[#HUD_HTML+1]=[[\n     <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n     <table class=\"bkgnd\" width=\"500px\">\n     <tr height=\"]].. MenuY ..[[\"><td class=\"]].. WPSTORESelect[0] ..[[ Title\" colspan=\"2\"><span class=\"Fleft\"> &#8592;</span>WP Store</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Units\" width=\"250px\">]].. wp_selected_planet ..[[</td><td width=\"250px\" class=\"Title\">WP Coord</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">WP Name</td><td class=\"]].. WPSTORESelect[2] ..[[\">]].. keypad_input_wp_lat ..[[&nbsp<span class=\"Units\">Lat</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"]].. WPSTORESelect[1] ..[[\">]].. keypad_input_wp_name ..[[<span class=\"Fright\">store &#8594;</span></td><td class=\"]].. WPSTORESelect[3] ..[[\">]].. keypad_input_wp_lon ..[[&nbsp<span class=\"Units\">Lon</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td >]].. stored ..[[</td><td class=\"]].. WPSTORESelect[4] ..[[\">]].. keypad_input_wp_alt ..[[&nbsp<span class=\"Units\">Alt</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\">]].. wp_coordinated_stored ..[[</td></tr>\n     </table></div>]]\n    stored=\"\"\n    local HTML=table.concat(HUD_HTML)\n    return HTML\n   end\n\n  --SETTINGS PAGE 3        (WP Sync)(screenState=8)\n   function settings3()\n    if WPSYNCSelect==nil then WPSYNCSelect={[0]=\"select\",\"\",\"\",\"\"} end\n    if ShipIDclr==nil then ShipIDclr=\"\" end\n    if FleetNumber==nil then FleetNumber=0 end\n    local FleetList=databank.getStringValue(\"Fleet\")\n    FleetList=json.decode(FleetList)\n    if FleetList==nil then FleetNumber=0\n    else FleetNumber=#FleetList end\n\n    local dbKeys=databank.getNbKeys()\n\n    if dbKeys>0 then\n     local counter=0\n     for i=1, dbKeys do\n      local wp_name=\"wp\"..i\n      local wp_name=databank.getStringValue(wp_name)\n\n      if (tostring(wp_name)~=nil and tostring(wp_name)~=\"\") then counter=counter + 1 end\n      keys_number=counter\n     end\n    else keys_number=0 end\n    if (sync_result==nil or sync_result==\"\") then sync_result=\"\" end\n\n    HUD_HTML[#HUD_HTML+1]=[[\n     <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n     <table class=\"bkgnd\" width=\"500px\">\n     <tr height=\"]].. MenuY ..[[\"><td class=\"]].. WPSYNCSelect[0] ..[[ Title\" colspan=\"2\"><span class=\"Fleft\"> &#8592;</span>WP Sync</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td width=\"250px\" class=\"Title\" >Ship ID</td><td width=\"250px\" class=\"]].. WPSYNCSelect[1] ..[[\"><span class=\"]].. ShipIDclr ..[[ Fleft\"> &#8592; clr</span>]].. keypad_input_shipid ..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Data Stored</td><td>WP:]].. keys_number ..[[ - Fleet:]].. FleetNumber ..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"]].. WPSYNCSelect[2] ..[[ Units\"> << Downlink >> <span class=\"Fright\">ent &#8594;</span></td><td class=\"]].. WPSYNCSelect[3] ..[[ Units\"> >> Uplink << <span class=\"Fright\">ent &#8594;</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\"><span class=\"Fleft\">\n      <svg width=\"]].. prog_bar ..[[px\" height=\"]].. MenuY ..[[\">\n      <rect x=\"2\" y=\"5\" width=\"100%\" height=\"100%\" style=\"fill:yellow\"/>\n      </svg>\n     </span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\" >]].. sync_result ..[[</td></tr>\n     </table></div>]]\n    local HTML=table.concat(HUD_HTML)\n    return HTML\n   end\n\n  --SETTINGS PAGE 4        (Screen Colours)(screenState=10)\n   function settings4()\n    if COLORSSelect==nil then COLORSSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"} end\n\n    HUD_HTML[#HUD_HTML+1]=[[\n     <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n     <table class=\"bkgnd\" width=\"500px\">\n     <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\" class=\"]].. COLORSSelect[0] ..[[ Title\"><span class=\"Fleft\"> &#8592;</span>HUD Menu Colors</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td width=\"250px\" class=\"Title\">Table Borders</td><td width=\"250px\" class=\"]].. COLORSSelect[1] ..[[\">]]..keypad_input_color1..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Titles</td><td class=\"]].. COLORSSelect[2] ..[[\">]]..keypad_input_color2..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Text</td><td class=\"]].. COLORSSelect[3] ..[[\">]]..keypad_input_color3..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Selection</td><td class=\"]].. COLORSSelect[4] ..[[\">]]..keypad_input_color4..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Background</td><td class=\"]].. COLORSSelect[5] ..[[\">]]..keypad_input_color5..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Background Alpha</td><td class=\"]].. COLORSSelect[6] ..[[\">]]..keypad_input_color6..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Overlapped Table Alpha</td><td class=\"]].. COLORSSelect[7] ..[[\">]]..keypad_input_color7..[[</td></tr>\n     </table></div>]]\n    local HTML=table.concat(HUD_HTML)\n    return HTML\n   end\n\n  --SETTINGS PAGE 5        (DMG Rep.)(screenState=11)\n   function settings5()\n    if DMGREPSelect==nil then DMGREPSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\"} end\n\n    HUD_HTML[#HUD_HTML+1]=[[\n     <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n     <table class=\"bkgnd\" width=\"500px\">\n     <tr height=\"]].. MenuY ..[[\"><td colspan=\"5\" class=\"]].. DMGREPSelect[0] ..[[ Title\"><span class=\"Fleft\"> &#8592;</span>DMG Report Position</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td width=\"240px\" class=\"Title\">Top View</td><td width=\"30px\" class=\"Title\">X</td><td width=\"100px\" class=\"]].. DMGREPSelect[1] ..[[\">]].. DMG_REP_TOP_VIEW_LH_RH ..[[</td><td width=\"30px\" class=\"Title\">Y</td><td width=\"100px\" class=\"]].. DMGREPSelect[2] ..[[\">]].. DMG_REP_TOP_VIEW_Up_Down ..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"Title\">Side View</td><td class=\"Title\">X</td><td class=\"]].. DMGREPSelect[3] ..[[\">]].. DMG_REP_SIDE_VIEW_LH_RH ..[[</td><td class=\"Title\">Y</td><td class=\"]].. DMGREPSelect[4] ..[[\">]].. DMG_REP_SIDE_VIEW_Up_Down ..[[</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td colspan=\"3\" class=\"Title\">Scale</td><td colspan=\"2\" class=\"]].. DMGREPSelect[5] ..[[\">]].. keypad_input_dmg1 ..[[</td></tr>\n     </table></div>]]\n    local HTML=table.concat(HUD_HTML)\n    return HTML\n   end\n  \n  --SETTINGS PAGE 6        (DB Reset)(screenState=12)\n   function settings6()\n    if DBRESSelect==nil then DBRESSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\"} end\n\n    HUD_HTML[#HUD_HTML+1]=[[\n     <div style=\"position:absolute;top:]].. yStart+(MenuY * MenuTick) ..[[px;left:]].. (xStart+MenuW+10) ..[[px;\">\n     <table class=\"bkgnd\" width=\"500px\">\n     <tr height=\"]].. MenuY ..[[\"><td colspan=\"2\" class=\"]].. DBRESSelect[0] ..[[ Title\"><span class=\"Fleft\"> &#8592;</span>Databank Reset</td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td width=\"200px\">]].. db_mark_1 ..[[</td><td class=\"]].. DBRESSelect[1] ..[[ Title\" width=\"300px\"><span class=\"Fleft\"> &#8592; clr</span>Stored WP<span class=\"Fright\">keep &#8594;</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td>]].. db_mark_2 ..[[</td><td class=\"]].. DBRESSelect[2] ..[[ Title\"><span class=\"Fleft\"> &#8592; clr</span>Ship Settings<span class=\"Fright\">keep &#8594;</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td>]].. db_mark_3 ..[[</td><td class=\"]].. DBRESSelect[3] ..[[ Title\"><span class=\"Fleft\"> &#8592; clr</span>Ship ID<span class=\"Fright\">keep &#8594;</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td>]].. db_mark_4 ..[[</td><td class=\"]].. DBRESSelect[4] ..[[ Title\"><span class=\"Fleft\"> &#8592; clr</span>HUD Menu Colors<span class=\"Fright\">keep &#8594;</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td>]].. db_mark_5 ..[[</td><td class=\"]].. DBRESSelect[5] ..[[ Title\"><span class=\"Fleft\"> &#8592; clr</span>DMG Report<span class=\"Fright\">keep &#8594;</span></td></tr>\n     <tr height=\"]].. MenuY ..[[\"><td class=\"]].. DBRESSelect[6] ..[[ Title\">EXECUTE<span class=\"Fright\">ent &#8594;</span></td><td>]].. reset_db_status ..[[</td></tr>\n     </table></div>]]\n    local HTML=table.concat(HUD_HTML)\n    return HTML\n   end\n\n--SENDING DATA\n function sync_data()\n  if emitter then\n   local dbKeys=databank.getNbKeys()\n   if dbKeys>0 then\n    local counter=0\n    for i=index_sync, dbKeys do\n     local wp_name='wp'..i\n     local wp_name=databank.getStringValue(wp_name)\n     if (tostring(wp_name)~=nil and tostring(wp_name)~=\"\") then\n      counter=counter + 1\n      local wp_coord='wp'..i..'_coord'\n      local wp_coord=databank.getStringValue(wp_coord)\n      system.print(ship_id..\" is TRANSMITTING WP: \"..wp_name)\n\n      waypoint={wp_n=wp_name, wp_c=wp_coord}\n      json_string=json.encode(waypoint,{indent=false})\n      if counter<=1 then\n       wp_synced=wp_synced + 1\n       emitter.send(\"AviatorHUD\", \"<ShipData>\"..json_string:gsub(\"\\\"\",\"@@@\"))\n      else break end\n     end\n     sync_result=\"Synced \".. wp_synced ..\"/\".. keys_number ..\" WP\"\n     prog_bar=(wp_synced * 500)/keys_number\n     if index_sync<=dbKeys then\n      index_sync=index_sync+1\n      delay_timer=1\n      delay_id=\"SyncData\"\n      unit.setTimer(\"delay\", 0.5)\n     end\n    end\n    HUDScreen()\n   end\n  else sync_result=\"No Emitter/Receiver\" end\n end\n\n--RECEIVING DATA\n function reqst_waypoints()\n  emitter.send(\"AviatorHUD\", \"<ShipRqst>\")\n  WP_request=true\n  sync_result=\">> Uplink << \".. msg_counter ..\"/\".. receiving_wp\n end\n\n msg_counter=0\n function receiving_data()\n  keypad_input_wpname=rcv_msg.wp_n\n  from_coordinates=rcv_msg.wp_c\n  wp_check()\n  HUDScreen()\n end\n\n fleet_msg_counter=0\n function receiving_FleetData()\n  local StoredFleetData=databank.getStringValue(\"Fleet\")\n  StoredFleetData=json.decode(StoredFleetData)\n  if StoredFleetData==nil then StoredFleetData={} end\n  local ShipName=rcv_msg.sh_n\n  local ShipID=rcv_msg.sh_id\n  local ShipExist=false\n  for i=1, #StoredFleetData do\n   if ShipName==StoredFleetData[i].n then ShipExist=true break end\n  end\n  if not ShipExist then table.insert(StoredFleetData, {[\"n\"]=ShipName,[\"id\"]=ShipID}) end\n  \n  StoredFleetData=json.encode(StoredFleetData)\n  databank.setStringValue(\"Fleet\", StoredFleetData)\n  HUDScreen()\n end\n\n--MAIN MENU INIT\n if screenState==nil then\n  MenuSelect={[0]=\"0\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"}\n  MenuTick=1 MenuSelect[1]=\"select\"\n  screenState=-1\n end\n\n function menu_from()\n  if screenState==0 then ent_from_wp(WPSelected)\n  elseif screenState==6 then ent_from_wp(ATLASSelected) end\n  FROMSelect={\"select\",\"\"}\n  screenState=2\n  HUDScreen()\n end\n\n function menu_destination()\n  if screenState==0 then ent_to_wp(WPSelected)\n  elseif screenState==6 then ent_to_wp(ATLASSelected)   \n  end\n  screenState=3\n  HUDScreen()\n end\n\n function menu_settings()\n  if (ScreenOrigin==0 or ScreenOrigin==-1) then\n   edit_wp=nil\n\n   if ScreenOrigin==-1 then\n    local WpSel=MenuTick-8\n    for i=1, #wp_list do\n     if wp_list[i].name==WpRouteList[WpSel] then edit_wp=wp_list[i].id break end\n    end\n   else\n    if wp_list[WPSelected]~=nil then edit_wp=wp_list[WPSelected].id end\n   end\n\n   if edit_wp~=nil then\n    screenState=16\n    if WPSETTINGSelect==nil then WPSETTINGSelect={[0]=\"select\",\"\",\"\"} end\n    wp_altitude_inserted=true\n    wp_speed_inserted=true\n    for x=1, #wp_list do\n     if wp_list[x].id==edit_wp then\n      local wp_id=wp_list[x].wp\n      edit_wp=databank.getStringValue(wp_id)\n      break\n     end\n    end\n    local ext=databank.getStringValue(\"wp_settings\"):gsub(\"@@@\",\"\\\"\")\n    ext=json.decode(ext)\n    if ext[edit_wp] then\n     keypad_input_wp_altitude=ext[edit_wp].alt\n     keypad_input_wp_speed=ext[edit_wp].s\n    else\n     keypad_input_wp_altitude=\"\"\n     keypad_input_wp_speed=\"\"\n    end\n    HUDScreen()\n   end\n  end\n end\n\n function menu_wp_atlas()\n  if screenState==0 then\n   wp_page_index=1\n   WPSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"}\n  elseif screenState==6 then\n   atlas_page_index=1\n   ATLASSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"}\n  end\n  HUDScreen()\n end\n\n--MENU PRELOAD\n function menu()\n  if screenState==2 then menu_from()\n  elseif screenState==3 then menu_destination()\n  elseif (screenState==0 or screenState==6) then menu_wp_atlas()\n  elseif (screenState==9 or screenState==16) then menu_settings()\n  elseif screenState==17 then\n   if shield then\n    SHIELDSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"}\n    local ResistanceTable=shield.getResistances()\n    Ran=tonumber(string.format(\"%.0f\", (ResistanceTable[1]*100)+10))\n    Rel=tonumber(string.format(\"%.0f\", (ResistanceTable[2]*100)+10))\n    Rki=tonumber(string.format(\"%.0f\", (ResistanceTable[3]*100)+10))\n    Rth=tonumber(string.format(\"%.0f\", (ResistanceTable[4]*100)+10))\n    unit.setTimer(\"shield\", 1/4)\n    shieldFunction()\n   end\n  end\n  HUDScreen()\n end\n\n if DataProcessed==nil then\n  HUD_HTML={}\n  wp_page_index=1\n  WPSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"}\n  atlas_page_index=1\n  ATLASSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"}\n  atlas_list_page()\n  stored_waypoints_1()\n  DataProcessed=true\n end\n\n--SCREEN SCRIPT BUILDIER\n function HUDScreen()\n  local ScreenHTML=css_html()\n  if screenState~=-1 then ScreenHTML=MainMenu() end\n\n  if screenState==-1 then ScreenHTML=MainMenu()\n  elseif screenState==0 then \n   if SelectionIsTrue==false then ScreenHTML=stored_waypoints_1()\n   else ScreenHTML=SelectedItem() end\n  elseif screenState==1 then ScreenHTML=su_distance_time()\n  elseif screenState==2 then ScreenHTML=from()\n  elseif screenState==3 then ScreenHTML=distance_to_wp()\n  elseif screenState==4 then ScreenHTML=target_pe_altitude()\n  elseif screenState==5 then ScreenHTML=settings1()\n  elseif screenState==6 then\n   if SelectionIsTrue==false then ScreenHTML=atlas_list_page()\n   else ScreenHTML=SelectedItem() end\n  elseif screenState==7 then ScreenHTML=settings2()\n  elseif screenState==8 then ScreenHTML=settings3()\n  elseif screenState==9 then\n   if SelectionIsTrue==false then ScreenHTML=settings_menu()\n   else ScreenHTML=SelectedItem() end\n  elseif screenState==10 then ScreenHTML=settings4()\n  elseif screenState==11 then ScreenHTML=settings5()\n  elseif screenState==12 then ScreenHTML=settings6()\n  elseif screenState==16 then ScreenHTML=wp_settings()\n  elseif screenState==17 then ScreenHTML=shieldFunction()\n  end\n\n  if RouteExist then ScreenHTML=route_page() end\n  if PVPStationIsON then ScreenHTML=PVPInfoFunction() end\n\n  if MENU_ON then system.setScreen(ScreenHTML) system.showScreen(1) else\n   if PVPStationIsON then\n    HUD_HTML={}\n    ScreenHTML=css_html()\n    ScreenHTML=PVPInfoFunction()\n    system.setScreen(ScreenHTML)\n    system.showScreen(1)\n   else system.showScreen(0) end\n  end\n end\n HUDScreen()","filter":{"args":[],"signature":"start()","slotKey":"-1"},"key":"1"},{"code":"--unit.tick(\"delay\")\n delay_timer=delay_timer-1\n if delay_timer==0 then\n  unit.stopTimer(\"delay\")\n  if delay_id==\"SyncData\" then sync_data()\n  elseif delay_id==\"ShipIDResponse\" then\n   if (sync_result==\"Ship ID Sent\" or sync_result==\"Downlink Requested\") then sync_result=\"No Response\" HUDScreen() end\n  end\n end","filter":{"args":[{"value":"delay"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"2"},{"code":"--unit.tick(\"Ship_Id\")\n ship_id_verified=false\n WP_request=false\n unit.stopTimer(\"Ship_Id\")","filter":{"args":[{"value":"Ship_Id"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"3"},{"code":"--unit.tick(\"routing\")\n if (RouteExist and InitRoute) then HUDScreen()\n else InitRoute=false RouteActivated=false unit.stopTimer(\"routing\")\n end","filter":{"args":[{"value":"routing"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"4"},{"code":"--unit.tick(\"shield\")\n if screenState==17 then shieldFunction() HUDScreen() else unit.stopTimer(\"shield\") end","filter":{"args":[{"value":"shield"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"5"},{"code":"--unit.tick(\"PVPStation\")\n if PVPStationIsON==nil then PVPStationIsON=false end\n if databank.getStringValue(\"PVPStation\")==\"ON\" then\n  PVPStationIsON=true\n  HUDScreen()\n else PVPStationIsON=false end","filter":{"args":[{"value":"PVPStation"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"6"},{"code":"--system.inputText(*)\n if MENU_ON then \n  input_text=text\n\n  if (screenState==1 and tonumber(input_text)~=nil) then\n   if (su_tick==\">\" and TimeCalcSelect[1]==\"select\") then keypad_input_su=input_text\n   elseif (speed_tick==\">\" and TimeCalcSelect[2]==\"select\") then keypad_input_speed=input_text\n   end\n   ent_button()\n  elseif screenState==2 then\n   if FROMSelect[1]==\"select\" then keypad_input_from=input_text ent_button()\n   elseif FROMSelect[2]==\"select\" then keypad_input_wpname=input_text ent_button() end\n  elseif screenState==3 then keypad_input_dest=input_text ent_button()\n  elseif (screenState==4 and tonumber(input_text)~=nil) then\n   keypad_input_pe_target_alt=input_text\n   target_pe_altitude_inserted=false\n   target_alt_warning=\"\"\n   ent_button()\n  elseif (screenState==5 and tonumber(input_text)~=nil) then\n   if SHIPSETINGSSelect[1]==\"select\" then keypad_input_MTOW=input_text\n   elseif SHIPSETINGSSelect[2]==\"select\" then keypad_input_autobrake=input_text\n   elseif SHIPSETINGSSelect[3]==\"select\" then keypad_input_wpdist=input_text\n   elseif SHIPSETINGSSelect[4]==\"select\" then keypad_input_holding=input_text\n   end\n   ent_button()\n  elseif screenState==7 then\n   local check0=string.find(input_text, \"::pos{\")\n   local check00=string.find(input_text, \"::pos{0,0,\")\n   if check0 then\n    local pos=input_text\n    local num=' *([+-]?%d+%.?%d*e?[+-]?%d*)'\n    local posPattern='::pos{0,' .. num .. ',' ..  num .. ',' .. num ..  ',' .. num .. '}'\n    local bodyId, latitude, longitude, altitude=string.match(pos, posPattern);\n    for i, v in pairs(atlas[0]) do\n     if atlas[0][i].id==tonumber(bodyId) then wp_selected_planet=atlas[0][i].name[1] break\n     elseif check00 then wp_selected_planet=\"World Coordinates\"\n     else wp_selected_planet=\"Invalid Entry\" end\n    end\n    input_text=\"\"\n    WPSTORESelect[1]=\"select\"\n    keypad_input_wp_lat=tonumber(latitude)\n    keypad_input_wp_lon=tonumber(longitude)\n    keypad_input_wp_alt=tonumber(altitude)\n   end\n   if (WPSTORESelect[1]==\"select\" and input_text~=\"\") then keypad_input_wp_name=input_text WPSTORESelect[1]=\"\" WPSTORESelect[2]=\"select\"\n   elseif (WPSTORESelect[2]==\"select\" and tonumber(input_text)~=nil) then keypad_input_wp_lat=input_text WPSTORESelect[2]=\"\" WPSTORESelect[3]=\"select\"\n   elseif (WPSTORESelect[3]==\"select\" and tonumber(input_text)~=nil) then keypad_input_wp_lon=input_text WPSTORESelect[3]=\"\" WPSTORESelect[4]=\"select\"\n   elseif (WPSTORESelect[4]==\"select\" and tonumber(input_text)~=nil) then keypad_input_wp_alt=input_text\n   end\n  elseif screenState==8 then\n   if WPSYNCSelect[1]==\"select\" then keypad_input_shipid=input_text end ent_button()\n  elseif screenState==10 then\n   if COLORSSelect[1]==\"select\" then keypad_input_color1=input_text\n   elseif COLORSSelect[2]==\"select\" then keypad_input_color2=input_text\n   elseif COLORSSelect[3]==\"select\" then keypad_input_color3=input_text\n   elseif COLORSSelect[4]==\"select\" then keypad_input_color4=input_text\n   elseif COLORSSelect[5]==\"select\" then keypad_input_color5=input_text\n   elseif (COLORSSelect[6]==\"select\" and tonumber(input_text)~=nil and tonumber(input_text)<=1) then keypad_input_color6=input_text\n   elseif (COLORSSelect[7]==\"select\" and tonumber(input_text)~=nil and tonumber(input_text)<=1) then keypad_input_color7=input_text\n   end\n   ent_button()\n  elseif (screenState==11 and tonumber(input_text)~=nil) then\n   if DMGREPSelect[1]==\"select\" then DMG_REP_TOP_VIEW_LH_RH=input_text databank.setFloatValue(\"DMG TV L/R\", DMG_REP_TOP_VIEW_LH_RH)\n   elseif DMGREPSelect[2]==\"select\" then DMG_REP_TOP_VIEW_Up_Down=input_text databank.setFloatValue(\"DMG TV U/D\", DMG_REP_TOP_VIEW_Up_Down)\n   elseif DMGREPSelect[3]==\"select\" then DMG_REP_SIDE_VIEW_LH_RH=input_text databank.setFloatValue(\"DMG SV L/R\", DMG_REP_SIDE_VIEW_LH_RH)\n   elseif DMGREPSelect[4]==\"select\" then DMG_REP_SIDE_VIEW_Up_Down=input_text databank.setFloatValue(\"DMG SV U/D\", DMG_REP_SIDE_VIEW_Up_Down)\n   elseif DMGREPSelect[5]==\"select\" then keypad_input_dmg1=input_text databank.setFloatValue(\"DMG Scale\", keypad_input_dmg1)\n   end\n  elseif (screenState==16 and tonumber(input_text)~=nil) then\n   if WPSETTINGSelect[1]==\"select\" then keypad_input_wp_altitude=input_text\n   elseif WPSETTINGSelect[2]==\"select\" then keypad_input_wp_speed=input_text\n   end\n   ent_button()\n  end\n  HUDScreen()\n end","filter":{"args":[{"variable":"*"}],"signature":"inputText(text)","slotKey":"-2"},"key":"7"},{"code":"--system.actionStart(down)\n if (L_ALT and MENU_ON) then\n  if SelectionIsTrue==nil then SelectionIsTrue=false end\n  local SelectList={}\n  local index=0\n  if screenState==-1 then\n   if RouteExist then for i=1, #WpRouteList do if #MenuSelect<(#WpRouteList+8) then table.insert(MenuSelect, ROUTESelect[i]) end end end\n   SelectList=MenuSelect\n  elseif (screenState==0 and SelectionIsTrue==false) then if WPSelected==nil then WPSelected=0 end SelectList=WPSelect\n  elseif (screenState==6 and SelectionIsTrue==false) then if ATLASSelected==nil then ATLASSelected=0 end SelectList=ATLASSelect\n  elseif ((screenState==0 or screenState==6 or screenState==9) and SelectionIsTrue==true) then SelectList=SelectionList\n  elseif screenState==5 then SelectList=SHIPSETINGSSelect\n  elseif screenState==7 then SelectList=WPSTORESelect\n  elseif screenState==8 then SelectList=WPSYNCSelect\n  elseif (screenState==9 and SelectionIsTrue==false) then SelectList=SETTINGSSelect\n  elseif screenState==10 then SelectList=COLORSSelect\n  elseif screenState==11 then SelectList=DMGREPSelect\n  elseif screenState==12 then SelectList=DBRESSelect\n  elseif screenState==16 then SelectList=WPSETTINGSelect\n  elseif screenState==17 then SelectList=SHIELDSelect\n  end\n\n  local n=1\n  if SelectList[0]~=\"0\" then n=0 end\n  for i=n, #SelectList do\n   if SelectList[i]==\"select\" then\n    if i<#SelectList then\n     SelectList[i]=\"\"\n     SelectList[i+1]=\"select\"\n     index=i+1\n     break\n    end\n   end\n  end\n\n  if screenState==-1 then\n   MenuSelect=SelectList\n   if index~=0 then MenuTick=index HUDScreen() end\n  elseif screenState==1 then ent_button() HUDScreen()\n  elseif screenState==2 then ent_button() HUDScreen()\n  elseif (screenState==0 and SelectionIsTrue==false) then\n   if index~=0 then\n    CellSelected=index\n    WPSelected=(wp_page_index*10)-10+index\n    WPSelect=SelectList\n    HUDScreen()\n   end\n  elseif (screenState==6 and SelectionIsTrue==false) then\n   if index~=0 then\n    CellSelected=index\n    ATLASSelected=(atlas_page_index*10)-10+index\n    ATLASSelect=SelectList\n    HUDScreen()\n   end\n  elseif ((screenState==0 or screenState==6 or screenState==9) and SelectionIsTrue==true) then SelectionList=SelectList HUDScreen()\n  elseif screenState==5 then if index~=0 then SHIPSETINGSSelect=SelectList HUDScreen() end\n  elseif screenState==7 then if index~=0 then WPSTORESelect=SelectList HUDScreen() end\n  elseif screenState==8 then if index~=0 then ShipIDclr=\"\" WPSYNCSelect=SelectList HUDScreen() end\n  elseif (screenState==9 and SelectionIsTrue==false) then if index~=0 then CellSelected=index SETTINGSSelect=SelectList HUDScreen() end\n  elseif screenState==10 then if index~=0 then COLORSSelect=SelectList HUDScreen() end\n  elseif screenState==11 then if index~=0 then DMGREPSelect=SelectList HUDScreen() end\n  elseif screenState==12 then if index~=0 then DBRESSelect=SelectList HUDScreen() end\n  elseif screenState==16 then if index~=0 then WPSETTINGSelect=SelectList HUDScreen() end\n  elseif screenState==17 then if index~=0 then SHIELDSelect=SelectList HUDScreen() end\n  end\n end","filter":{"args":[{"value":"down"}],"signature":"actionStart(action)","slotKey":"-2"},"key":"8"},{"code":"--system.actionStart(up)\n if (L_ALT and MENU_ON) then\n  if SelectionIsTrue==nil then SelectionIsTrue=false end\n  local SelectList={}\n  local index=0\n  if screenState==-1 then SelectList=MenuSelect\n  elseif (screenState==0 and SelectionIsTrue==false) then WPSelected=0 SelectList=WPSelect\n  elseif (screenState==6 and SelectionIsTrue==false) then ATLASSelected=0 SelectList=ATLASSelect\n  elseif ((screenState==0 or screenState==6 or screenState==9) and SelectionIsTrue==true) then SelectList=SelectionList\n  elseif screenState==5 then SelectList=SHIPSETINGSSelect\n  elseif screenState==7 then SelectList=WPSTORESelect\n  elseif screenState==8 then SelectList=WPSYNCSelect\n  elseif (screenState==9 and SelectionIsTrue==false) then SelectList=SETTINGSSelect\n  elseif screenState==10 then SelectList=COLORSSelect\n  elseif screenState==11 then SelectList=DMGREPSelect\n  elseif screenState==12 then SelectList=DBRESSelect\n  elseif screenState==16 then SelectList=WPSETTINGSelect\n  elseif screenState==17 then SelectList=SHIELDSelect\n  end\n\n  local n=1\n  if SelectList[0]~=\"0\" then n=0 end\n  for i=n, #SelectList do\n   if SelectList[i]==\"select\" then\n    if i>n then\n     SelectList[i]=\"\"\n     SelectList[i-1]=\"select\"\n     index=i-1\n     break\n    end\n   end\n  end\n\n  if screenState==-1 then\n   MenuSelect=SelectList\n   if index~=0 then MenuTick=index HUDScreen() end\n  elseif screenState==1 then clr_button() HUDScreen()\n  elseif (screenState==2 and FROMSelect[2]==\"select\") then if FROMclr==\"\" then FROMclr=\"red\" HUDScreen() else FROMclr=\"\" clr_button() HUDScreen() end\n  elseif screenState==3 then if DESTclr==\"\" then DESTclr=\"red\" HUDScreen() else DESTclr=\"\" clr_button() HUDScreen() end\n  elseif (screenState==0 and SelectionIsTrue==false) then\n   if index~=0 then\n    CellSelected=index\n    WPSelected=(wp_page_index*10)-10+index\n    WPSelect=SelectList\n   end\n   HUDScreen()\n  elseif (screenState==6 and SelectionIsTrue==false) then\n   if index~=0 then\n    CellSelected=index\n    ATLASSelected=(atlas_page_index*10)-10+index\n    ATLASSelect=SelectList\n   end\n   HUDScreen()\n  elseif ((screenState==0 or screenState==6 or screenState==9) and SelectionIsTrue==true) then SelectionList=SelectList HUDScreen()\n  elseif screenState==5 then if index~=0 then SHIPSETINGSSelect=SelectList end HUDScreen()\n  elseif screenState==7 then if index~=0 then WPSTORESelect=SelectList end HUDScreen()\n  elseif screenState==8 then if index~=0 then WPSYNCSelect=SelectList end ShipIDclr=\"\" HUDScreen()\n  elseif (screenState==9 and SelectionIsTrue==false) then if index~=0 then CellSelected=index SETTINGSSelect=SelectList end HUDScreen()\n  elseif screenState==10 then if index~=0 then COLORSSelect=SelectList end HUDScreen()\n  elseif screenState==11 then if index~=0 then DMGREPSelect=SelectList end HUDScreen()\n  elseif screenState==12 then if index~=0 then DBRESSelect=SelectList end HUDScreen()\n  elseif screenState==16 then if index~=0 then WPSETTINGSelect=SelectList end HUDScreen()\n  elseif screenState==17 then if index~=0 then SHIELDSelect=SelectList end HUDScreen()\n  end\n end","filter":{"args":[{"value":"up"}],"signature":"actionStart(action)","slotKey":"-2"},"key":"9"},{"code":"--system.actionStart(option1)\n if (L_SHIFT and MENU_ON) then MENU_ON=false else MENU_ON=true end\n HUDScreen()","filter":{"args":[{"value":"option1"}],"signature":"actionStart(action)","slotKey":"-2"},"key":"10"},{"code":"--system.actionstart(straferight)\n if (L_ALT and MENU_ON) then\n  if SelectionIsTrue==nil then SelectionIsTrue=false end\n  if screenState==-1 then\n   if MenuTick<=8 then\n    local i=MenuTick\n    local screenStateList={[1]=1,[2]=6,[3]=0,[4]=2,[5]=3,[6]=4,[7]=17,[8]=9}\n    screenState=screenStateList[i]\n    if screenState==17 and shield==nil then screenState=-1 end\n    menu()\n   elseif RouteActivated then\n    IDToNextWp=(MenuTick-8)\n    DistToNextWp=(IDToNextWp-1)\n    RouteStatus=\"Activated\"\n    FindWP()\n   end\n  elseif screenState==2 then FROMclr=\"\" add_wp() HUDScreen()\n  elseif (screenState==0 and WPSelect[0]==\"select\") then big_arrow_down() HUDScreen()\n  elseif (screenState==0 and WPSelected>0 and SelectionIsTrue==false) then SelectionIsTrue=true HUDScreen()\n  elseif (screenState==0 and SelectionIsTrue==true) then\n   if (SelectionList[1]==\"select\" and wp_list[WPSelected]~=nil) then WPclr[4]=\"\" SelectionList=nil SelectionIsTrue=false ScreenOrigin=0 menu_settings()\n   elseif SelectionList[2]==\"select\" then WPclr[4]=\"\" SelectionList=nil SelectionIsTrue=false menu_destination()\n   elseif SelectionList[3]==\"select\" then WPclr[4]=\"\" SelectionList=nil SelectionIsTrue=false menu_from()\n   elseif SelectionList[4]==\"select\" then if WPclr[4]==\"\" then WPclr[4]=\"red\" HUDScreen() else WPclr[4]=\"\" SelectionList=nil SelectionIsTrue=false clr_wp(WPSelected) end\n   elseif (SelectionList[5]==\"select\" or SelectionList[6]==\"select\" or SelectionList[7]==\"select\") then WPclr[4]=\"\" SelectionIsTrue=false AddRemoveRoute()\n   end\n  elseif (screenState==6 and ATLASSelect[0]==\"select\") then big_arrow_down() HUDScreen()\n  elseif (screenState==6 and ATLASSelected>0 and SelectionIsTrue==false) then SelectionIsTrue=true HUDScreen()\n  elseif (screenState==6 and SelectionIsTrue==true) then\n   if SelectionList[1]==\"select\" then SelectionList=nil SelectionIsTrue=false menu_destination()\n   elseif SelectionList[2]==\"select\" then SelectionList=nil SelectionIsTrue=false menu_from() end\n  elseif (screenState==7 and WPSTORESelect[1]==\"select\") then add_wp() HUDScreen()\n  elseif screenState==8 then if (WPSYNCSelect[2]==\"select\" or WPSYNCSelect[3]==\"select\") then ShipIDclr=\"\" ent_button() HUDScreen() end\n  elseif (screenState==9 and SelectionIsTrue==false) then if SETTINGSSelect[7]==\"select\" then SelectionIsTrue=true else ent_button() end HUDScreen()\n  elseif (screenState==9 and SelectionIsTrue==true) then\n   if (SelectionList[1]==\"select\" and RouteExist) then RouteCheck()\n   elseif (SelectionList[2]==\"select\" and RouteExist) then SelectionIsTrue=false AddRemoveRoute() end\n  elseif screenState==12 then\n   if (DBRESSelect[0]~=\"select\" and DBRESSelect[6]~=\"select\") then ent_button()\n   elseif DBRESSelect[6]==\"select\" then clr_button() end  HUDScreen()\n  elseif screenState==17 then\n   if SHIELDSelect[1]==\"select\" then ScreenSelection=\"ShieldToggle\"\n   elseif SHIELDSelect[2]==\"select\" then ScreenSelection=\"VENTING\"\n   elseif SHIELDSelect[3]==\"select\" then ScreenSelection=\"SET\"\n   elseif SHIELDSelect[4]==\"select\" then ScreenSelection=\"RESET\"\n   elseif SHIELDSelect[5]==\"select\" then ScreenSelection=\"A+\"\n   elseif SHIELDSelect[6]==\"select\" then ScreenSelection=\"E+\"\n   elseif SHIELDSelect[7]==\"select\" then ScreenSelection=\"K+\"\n   elseif SHIELDSelect[8]==\"select\" then ScreenSelection=\"T+\"\n   end\n  end\n end","filter":{"args":[{"value":"straferight"}],"signature":"actionStart(action)","slotKey":"-2"},"key":"11"},{"code":"--system.actionstart(strafeleft)\n if (L_ALT and MENU_ON) then\n  if screenState==1 then screenState=-1 menu()\n  elseif (screenState==-1 and RouteActivated and MenuTick>8) then ScreenOrigin=-1 menu_settings()\n  elseif screenState==2 then FROMclr=\"\" screenState=-1 menu()\n  elseif screenState==3 then DESTclr=\"\" screenState=-1 menu()\n  elseif screenState==4 then screenState=-1 menu()\n  elseif screenState==5 then screenState=9 HUDScreen() \n  elseif screenState==7 then if WPSTORESelect[0]==\"select\" then screenState=9 end HUDScreen()\n  elseif screenState==8 then\n   if WPSYNCSelect[0]==\"select\" then ShipIDclr=\"\" screenState=9\n   elseif (WPSYNCSelect[1]==\"select\" and keypad_input_shipid~=\"No ID\") then if ShipIDclr==\"\" then ShipIDclr=\"red\" else ShipIDclr=\"\" clr_button() end\n   end HUDScreen()\n  elseif (screenState==9 and SelectionIsTrue==false) then SETTINGSSelect={[0]=\"select\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"} screenState=-1 menu()\n  elseif screenState==10 then screenState=9 HUDScreen()\n  elseif screenState==11 then screenState=9 HUDScreen()\n  elseif screenState==12 then if (DBRESSelect[0]==\"select\" or DBRESSelect[6]==\"select\") then screenState=9 else clr_button() end HUDScreen()\n  elseif (screenState==0 and (WPSelect[0]~=\"select\" or wp_page_index==1) and SelectionIsTrue==false) then SelectionList=nil screenState=-1 menu()\n  elseif (screenState==0 and WPSelect[0]==\"select\") then big_arrow_up() HUDScreen()\n  elseif (screenState==6 and (ATLASSelect[0]~=\"select\" or atlas_page_index==1) and SelectionIsTrue==false) then SelectionList=nil screenState=-1 menu()\n  elseif (screenState==6 and ATLASSelect[0]==\"select\") then big_arrow_up() HUDScreen()\n  elseif ((screenState==0 or screenState==6 or screenState==9) and SelectionIsTrue==true) then WPclr[4]=\"\" SelectionList=nil SelectionIsTrue=false menu()\n  elseif screenState==16 then\n   if WPSETTINGSelect[0]==\"select\" then WPSETclr={\"\",\"\"} screenState=ScreenOrigin ScreenOrigin=\"\"\n   elseif WPSETTINGSelect[1]==\"select\" then if WPSETclr[1]==\"\" then  WPSETclr[1]=\"red\" else WPSETclr[1]=\"\" clr_button() end\n   elseif WPSETTINGSelect[2]==\"select\" then if WPSETclr[2]==\"\" then  WPSETclr[2]=\"red\" else WPSETclr[2]=\"\" clr_button() end\n   end HUDScreen()\n  elseif screenState==17 then\n   if SHIELDSelect[0]==\"select\" then screenState=-1 menu()\n   elseif SHIELDSelect[5]==\"select\" then ScreenSelection=\"A-\"\n   elseif SHIELDSelect[6]==\"select\" then ScreenSelection=\"E-\"\n   elseif SHIELDSelect[7]==\"select\" then ScreenSelection=\"K-\"\n   elseif SHIELDSelect[8]==\"select\" then ScreenSelection=\"T-\"\n   end\n  end\n end","filter":{"args":[{"value":"strafeleft"}],"signature":"actionStart(action)","slotKey":"-2"},"key":"12"},{"code":"--system.actionLoop(lshift)\n L_SHIFT=true","filter":{"args":[{"value":"lshift"}],"signature":"actionLoop(action)","slotKey":"-2"},"key":"13"},{"code":"--system.actionLoop(lalt)\n L_ALT=true","filter":{"args":[{"value":"lalt"}],"signature":"actionLoop(action)","slotKey":"-2"},"key":"14"},{"code":"--system.actionStop(lalt)\n L_ALT=false","filter":{"args":[{"value":"lalt"}],"signature":"actionStop(action)","slotKey":"-2"},"key":"15"},{"code":"--system.actionStop(lshift)\n L_SHIFT=false","filter":{"args":[{"value":"lshift"}],"signature":"actionStop(action)","slotKey":"-2"},"key":"16"},{"code":"if shield and L_SHIFT then\n if shield.isVenting()==1 then shield.stopVenting() else shield.startVenting() end\nend  ","filter":{"args":[{"value":"gear"}],"signature":"actionStart(action)","slotKey":"-2"},"key":"17"}],"methods":[],"events":[]}